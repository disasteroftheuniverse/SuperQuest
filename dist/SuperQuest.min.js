/*! For license information please see SuperQuest.min.js.LICENSE.txt */
(()=>{var t={4074:t=>{t.exports=AFRAME.registerComponent("billboard",{dependencies:["rotation"],schema:{src:{type:"selector",default:"#vr-camera"}},init:function(){this.lookAtTarget=new THREE.Vector3},tick:function(t,i){this.el.object3DMap&&(this.data.src.object3D.getWorldPosition(this.lookAtTarget),this.el.object3D.lookAt(this.lookAtTarget),this.el.object3D.rotation.x=0,this.el.object3D.rotation.z=0)}})},1905:t=>{t.exports=AFRAME.registerComponent("clamp",{dependencies:["position"],schema:{min:{type:"vec3",default:{x:-2,y:-1,z:-1}},max:{type:"vec3",default:{x:1,y:1,z:1}}},tick:function(){this.el.is("regulated")&&this.el.object3D.position.clamp(this.data.min,this.data.max)}})},560:t=>{t.exports={distribute_linear:AFRAME.registerComponent("distribute-linear",{schema:{},init:function(){var t=this.el.children;this.childEls=Array.from(t),this.numChildren=this.childEls.length,this.childComponents=[],this.childCounter=0,this.localPosition=new THREE.Vector3;for(var i=0;i<this.childEls.length;i++){var s={parent:this.el,offset:i,max:this.childEls.length,first:!1,last:!1};0==i&&(this.firstChild=this.childEls[i],s.first=!0),i==this.childEls.length-1&&(this.lastChild=this.childEls[i],s.last=!0),this.childEls[i].setAttribute("distribute",s)}},subscribe:function(t,i){this.childCounter++,this.childComponents.push(i),this.childCounter==this.numChildren&&this.updateChain()},updateChain:function(){for(this.childCounter=0;this.childCounter<this.numChildren;this.childCounter++)this.localPosition.lerpVectors(this.firstChild.object3D.position,this.lastChild.object3D.position,this.childCounter/this.numChildren),this.childComponents[this.childCounter].updateAlignment(this.localPosition)}}),distribute:AFRAME.registerComponent("distribute",{schema:{parent:{type:"selector"},offset:{type:"number"},max:{type:"number"},first:{type:"boolean",default:!1},last:{type:"boolean",default:!1}},init:function(){this.manager=this.data.parent.components["distribute-linear"],this.data.parent.components["distribute-linear"].subscribe(this.el,this)},updateAlignment:function(t){this.el.object3D.position.copy(t)}})}},2898:t=>{t.exports={system:AFRAME.registerSystem("google-poly",{schema:{type:"string"},__getAsset:function(t,i){if(null==THREE.Cache.get(t))this.__loadAsset(t,i);else{var s=THREE.Cache.get(t);this._create(s,i,t)}},_create:function(t,i){t.updateMatrixWorld(!0);var s=new THREE.Vector3,e=new THREE.Vector3,n=(new THREE.Box3).setFromObject(t);n.getSize(s);var h=Math.max.apply(Math,[s.x,s.y,s.z]);t.scale.multiplyScalar(1/h),t.scale.multiplyScalar(i.components.poly.data.size),n.setFromObject(t),n.getCenter(e),t.position.sub(e);var a=new THREE.Object3D;a.add(t),i.setObject3D("mesh",a)},__loadAsset:function(t,i){const s=this.data;var e=this,n=`https://poly.googleapis.com/v1/assets/${t}/?key=${s}`,h=new XMLHttpRequest;h.open("GET",n,!0),h.addEventListener("load",(function(s){var n,h,a,o,r,l=JSON.parse(s.target.response),u=function(t){return l.formats.find((i=>i.formatType===t))};if(null==u("GLTF2"))if(console.warn("Cannot load model as GLTF. Attempting to load OBJ"),null==u("OBJ"))console.error("Only GLTF and OBJ are supported at this time");else{var c=u("OBJ");h=(n=c).root,a=n.resources.find((t=>t.url.endsWith("mtl"))),o=h.url.slice(0,h.url.indexOf(h.relativePath)),(r=new THREE.MTLLoader).setCrossOrigin(!0),r.setMaterialOptions({ignoreZeroRGBs:!0}),r.setTexturePath(o),r.load(a.url,(function(s){var n=new THREE.OBJLoader;n.setMaterials(s),n.load(h.url,(function(s){THREE.Cache.add(t,s),e._create(s,i,t)}))}))}else!function(s){var n=s.root,h=new THREE.GLTFLoader;h.setCrossOrigin(!0),h.load(n.url,(function(s){THREE.Cache.add(t,s.scene),e._create(s.scene,i,t)}),(function(t){console.log(t.loaded/t.total*100+"% loaded")}),(function(t){console.error(t)}))}(u("GLTF2"))})),h.send(null)},init:function(){THREE.Cache.enabled=!0,this.__getAsset=this.__getAsset.bind(this),this.__loadAsset=this.__loadAsset.bind(this),this._create=this._create.bind(this)}}),component:AFRAME.registerComponent("poly",{schema:{src:{type:"string",default:"5vbJ5vildOq"},size:{type:"number",default:1}},init:function(){var t=this.el,i=this.data;this.system=this.el.sceneEl.systems["google-poly"],this.system.__getAsset(i.src,t)}}),primitive:AFRAME.registerPrimitive("a-poly",{defaultComponents:{position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},poly:{size:1,align:"center"}},mappings:{src:"poly.src",size:"poly.size"}})}},2476:t=>{t.exports={axes_helper:AFRAME.registerComponent("axes-helper",{schema:{scale:{type:"vec3",default:{x:1,y:1,z:1}},pos:{type:"vec3",default:{x:0,y:0,z:0}},rot:{type:"vec3",default:{x:0,y:0,z:0}},child:{type:"string",default:"none"}},multiple:!0,init:function(){var t=AFRAME.utils.axishelper();t.scale.copy(this.data.scale),this.el.object3D.add(t)}}),wire_display:AFRAME.registerComponent("wire-display",{schema:{color:{type:"color",default:"yellow"},opacity:{type:"number",default:.5}},create:function(){var t=this,i=[],s=[];t.el.object3D.traverse((t=>{t.isBufferGeometry?i.push(t):t.isGeometry&&s.push(t)})),i.forEach((i=>{var s=new THREE.EdgesGeometry(i.clone()),e=new THREE.LineSegments(s,new THREE.LineBasicMaterial({color:16777215}));t.el.object3D.add(e)})),t.el.removeObject3D("mesh")},tick:function(){this.el.object3DMap.mesh&&!this.pollingForMesh&&(this.pollingForMesh=!0,this.create())}}),grid_floor:AFRAME.registerComponent("grid-floor",{init:function(){this.el.setObject3D("grid1",new THREE.GridHelper(10,10)),this.el.setObject3D("grid2",new THREE.GridHelper(10,40)),this.el.object3DMap.grid2.material.linewidth=1,this.el.object3DMap.grid2.material.transparent=!0,this.el.object3DMap.grid2.material.opacity=.22,this.el.object3DMap.grid2.material.needsUpdate=!0}})}},253:(t,i,s)=>{s(4074),s(1905),s(560),s(2898),s(2476),s(8784),s(5493),s(6359),s(3750),s(2929),s(622)},8784:t=>{t.exports={xml_template:AFRAME.registerComponent("xml-template",{schema:{type:"asset"},init:function(){var t=this;t.loader=new THREE.FileLoader,t.loader.load(t.data,(t=>{}))}}),jsonmodel:AFRAME.registerComponent("json-model",{schema:{type:"asset"},init:function(){var t=this;(new THREE.ObjectLoader).load(this.data,(i=>{console.log(i),t.el.setObject3D("mesh",i),t.el.object3DMap.mesh.updateMatrixWorld(!0)}))},remove:function(){this.el.removeObject3D("mesh")}})}},5493:(t,i,s)=>{var e=s(3570);t.exports={template:AFRAME.registerComponent("template",{schema:{src:{type:"selector"},classname:{type:"string",default:"none"},insert:{type:"string",default:"afterbegin",oneOf:["afterbegin","beforebegin","beforeend","afterend"]}},init:function(){this.purgeChildren=this.purgeChildren.bind(this),"none"==this.data.classname?this.templateID="tmp-"+AFRAME.utils.makeId(5):this.templateID=this.data.classname},purgeChildren:function(){var t=this;Array.from(t.el.sceneEl.querySelectorAll(t.templateID)).forEach((i=>{t.el.removeChild(i),i.destroy()}))},update:function(t){var i=this,s=this.data.src,n=this.el.dataset;Array.from(s.content.children).forEach((t=>{t.classList.add(i.templateID)})),t&&t.src&&t.src!==this.data.src&&this.purgeChildren();var h=e(s.innerHTML,n);this.el.insertAdjacentHTML(this.data.insert,h)},remove:function(){this.purgeChildren()}}),template_file:AFRAME.registerComponent("template-file",{schema:{src:{type:"asset"}},init:function(){var t=this.el.dataset,i=this.data.src;(new THREE.FileLoader).load(i,(i=>{var s=e(i,t);console.log(s),this.el.insertAdjacentHTML("afterbegin",s)}))}})}},6359:t=>{t.exports={portal:AFRAME.registerComponent("portal",{schema:{camera:{type:"selector"},interval:{type:"number",default:40},enabled:{type:"boolean",default:!0},canvas:{type:"selector"},useOffscreen:{type:"boolean",default:!0}},init:function(){this.create=this.create.bind(this),this.preStart=this.preStart.bind(this),this.camera=null,this.mesh=null,this.material=new THREE.MeshBasicMaterial},create:function(){var t=this,i=t.data.canvas;1==t.data.useOffscreen&&OffscreenCanvas&&(console.log("offscreen canvas is supported"),i=new OffscreenCanvas(256,256)),i.style={width:256,height:256},t.material.map=new THREE.CanvasTexture(i),t.material.map.needsUpdate=!0,t.el.object3D.traverse((i=>{i.material&&(i.material=t.material,t.material.needsUpdate=!0)})),t.renderer=new THREE.WebGLRenderer({canvas:i,antialias:!1}),this.rendering=!0},preStart:function(t){t&&("camera"==t&&(this.camera=this.data.camera.object3DMap.camera),"mesh"==t&&(this.mesh=this.el.object3DMap.mesh)),this.mesh&&this.camera&&(this.el.sceneEl.renderStarted?this.create():this.el.sceneEl.addEventListener("renderstart",this.create,{once:!0}))},update:function(){AFRAME.utils.entity.onObject3DAdded(this.el,"mesh",this.preStart,this,"mesh"),AFRAME.utils.entity.onObject3DAdded(this.data.camera,"camera",this.preStart,this,"camera"),this.tock=AFRAME.utils.throttleTick(this.tock,this.data.interval,this)},tock:function(){this.rendering&&0!=this.data.enabled&&(this.renderer.render(this.el.sceneEl.object3D,this.camera),this.material.map.needsUpdate=!0,this.material.needsUpdate=!0)},remove:function(){}}),layer:AFRAME.registerComponent("layer",{schema:{type:"number",default:0},init:function(){this.addToLayer=this.addToLayer.bind(this),this.el.addEventListener("object3dset",this.addToLayer)},multiple:!0,addToLayer:function(){var t=this.el,i=this.data;t.object3D.traverse((t=>{t.layers&&t.layers.enable(i)}))},update:function(){this.addToLayer()}}),layer_set:AFRAME.registerComponent("layer-set",{schema:{type:"number",default:0},init:function(){this.addToLayer=this.addToLayer.bind(this),this.el.addEventListener("object3dset",this.addToLayer)},addToLayer:function(){var t=this.el,i=this.data;t.object3D.traverse((t=>{t.layers&&t.layers.set(i)}))},update:function(){this.addToLayer()}}),foo:AFRAME.registerShader("superfoo",{schema:{image:{type:"map",is:"uniform"},size:{type:"number",is:"uniform",default:.001}},raw:!0,vertexShader:"precision highp float;\nprecision highp int;\n\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\n\nattribute vec3 position;\n\nvoid main() {\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}",fragmentShader:"precision highp float;\nprecision highp int;\n\nuniform sampler2D image;\nuniform float size;\n\nvoid main() {\n    \n    gl_FragColor =  texture2D( image, vec2(gl_FragCoord.x* size, gl_FragCoord.y* size) );\n\n}"})}},3750:t=>{t.exports={rounded:AFRAME.registerComponent("rounded",{dependencies:["position","rotation"],schema:{color:{type:"color",default:"black"},radius:{type:"number",default:.1},width:{type:"number",default:1},height:{type:"number",default:1}},init:function(){var t=new THREE.Shape;this.savedColors=[],t.lineTo(0,this.data.height/2),t.quadraticCurveTo(0,this.data.height/2+this.data.radius,this.data.radius,this.data.height/2+this.data.radius),t.lineTo(this.data.width+this.data.radius,this.data.height/2+this.data.radius),t.quadraticCurveTo(this.data.width+this.data.radius+this.data.radius,this.data.height/2+this.data.radius,this.data.width+this.data.radius+this.data.radius,this.data.height/2),t.lineTo(this.data.width+this.data.radius+this.data.radius,this.data.height/2*-1),t.quadraticCurveTo(this.data.width+this.data.radius+this.data.radius,-1*(this.data.height/2+this.data.radius),this.data.width+this.data.radius,-1*(this.data.height/2+this.data.radius)),t.lineTo(this.data.radius,-1*(this.data.height/2+this.data.radius)),t.quadraticCurveTo(0,-1*(this.data.height/2+this.data.radius),0,this.data.height/2*-1),t.lineTo(0,0),t.closePath();var i=t.getPoints();i.forEach.bind(this),i.forEach((t=>{t.add({x:-1*(this.data.width/2+this.data.radius),y:0})}));var s=new THREE.ShapeGeometry(new THREE.Shape(i));s.verticesNeedUpdate=!0,s.mergeVertices(),s.verticesNeedUpdate=!0;var e=this.el.components.material;e||((e={}).material=new THREE.MeshBasicMaterial({color:new THREE.Color(this.data.color).convertSRGBToLinear()}));var n=new THREE.Mesh(s,e.material);this.resize=function(t,i){var s;for(s=1;s<14;s++)n.geometry.vertices[s].y=n.geometry.vertices[s].y+i/2,n.geometry.vertices[s].x=n.geometry.vertices[s].x-t/2;for(s=14;s<27;s++)n.geometry.vertices[s].y=n.geometry.vertices[s].y+i/2,n.geometry.vertices[s].x=n.geometry.vertices[s].x+t/2;for(s=27;s<40;s++)n.geometry.vertices[s].y=n.geometry.vertices[s].y-i/2,n.geometry.vertices[s].x=n.geometry.vertices[s].x+t/2;for(s=40;s<53;s++)n.geometry.vertices[s].y=n.geometry.vertices[s].y-i/2,n.geometry.vertices[s].x=n.geometry.vertices[s].x-t/2;n.geometry.vertices[0].y=n.geometry.vertices[0].y-i/2,n.geometry.vertices[0].x=n.geometry.vertices[0].x-t/2,n.geometry.verticesNeedUpdate=!0},this.el.setObject3D("mesh",n)},update:function(t){t.width&&t.height&&t.color&&(t.width===this.data.width&&t.height===this.data.height||this.resize(this.data.width-t.width,this.data.height-t.height),t.color!==this.data.color&&(this.el.object3DMap.mesh.material.color=new THREE.Color(this.data.color).convertSRGBToLinear(),this.el.object3DMap.mesh.material.needsUpdate=!0))}})}},2929:t=>{t.exports={grid:AFRAME.registerShader("grid",{schema:{FGColor:{type:"color",is:"uniform",default:"#FFF"},BGColor:{type:"color",is:"uniform",default:"#000"},Thickness:{type:"number",is:"uniform",default:.025},GridSize:{type:"number",is:"uniform",default:1},time:{type:"time",is:"uniform"},cameraPosition:{type:"vec3",is:"uniform",default:{x:0,y:0,z:0}}},raw:!0,fragmentShader:"/**\n* Example Fragment Shader\n* Sets the color and alpha of the pixel by setting gl_FragColor\n*/\n\n// Set the precision for data types used in this shader\nprecision highp float;\nprecision highp int;\n\n// Default THREE.js uniforms available to both fragment and vertex shader\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\n\n// Default uniforms provided by ShaderFrog.\nuniform vec3 cameraPosition;\nuniform float time;\n\n// A uniform unique to this shader. You can modify it to the using the form\n// below the shader preview. Any uniform you add is automatically given a form\n\n\n// Example varyings passed from the vertex shader\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec2 vUv2;\n\nuniform float GridSize;\nuniform float Thickness;\nuniform vec3 BGColor;\nuniform vec3 FGColor;\n\nvoid main() {\n\n    // Calculate the real position of this pixel in 3d space, taking into account\n    // the rotation and scale of the model. It's a useful formula for some effects.\n    // This could also be done in the vertex shader\n    vec3 worldPosition = ( modelMatrix * vec4( vPosition, 1.0 )).xyz;\n\n    // Calculate the normal including the model rotation and scale\n    vec3 worldNormal = normalize( vec3( modelMatrix * vec4( vNormal, 0.0 ) ) );\n    \n    vec3 fr=fract(worldPosition/exp(GridSize-4.0));\n    float xf=abs(fr.x-0.5)*2.0;\n    float yf=abs(fr.y-0.5)*2.0;\n    float zf=abs(fr.z-0.5)*2.0;\n    float sqr=min(xf,yf);\n    sqr=min(sqr,zf);\n    vec3 col=BGColor;\n    if (sqr<=Thickness) {\n        col=FGColor;\n    }\n\n    // Fragment shaders set the gl_FragColor, which is a vector4 of\n    // ( red, green, blue, alpha ).\n    gl_FragColor = vec4( col, 1.0 );\n\n}",vertexShader:"/**\n* Example Vertex Shader\n* Sets the position of the vertex by setting gl_Position\n*/\n\n// Set the precision for data types used in this shader\nprecision highp float;\nprecision highp int;\n\n// Default THREE.js uniforms available to both fragment and vertex shader\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\n\n// Default uniforms provided by ShaderFrog.\nuniform vec3 cameraPosition;\nuniform float time;\n\n// Default attributes provided by THREE.js. Attributes are only available in the\n// vertex shader. You can pass them to the fragment shader using varyings\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n\n// Examples of variables passed from vertex to fragment shader\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec2 vUv2;\n\nvoid main() {\n\n    // To pass variables to the fragment shader, you assign them here in the\n    // main function. Traditionally you name the varying with vAttributeName\n    vNormal = normal;\n    vUv = uv;\n    vUv2 = uv2;\n    vPosition = position;\n\n    // This sets the position of the vertex in 3d space. The correct math is\n    // provided below to take into account camera and object data.\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}"}),blend_images:AFRAME.registerShader("blend-images",{schema:{textureA:{type:"map",is:"uniform"},textureB:{type:"map",is:"uniform"},mask:{type:"number",is:"uniform",default:.5}},raw:!0,fragmentShader:"precision highp float;\nprecision highp int;\n\nuniform float mask;\nuniform sampler2D textureA;\nuniform sampler2D textureB;\n\nvarying vec2 vUv;\n \nvoid main() {\n    vec4 image1 = vec4( texture2D(textureA, vUv).rgb, 1.0 );\n    vec4 image2 = vec4( texture2D(textureB, vUv).rgb, 1.0 );\n    \n    vec4 color = ( image1 * mask) + (image2* (1.0 - mask));\n    \n    gl_FragColor = vec4( color);\n\n}",vertexShader:"precision highp float;\nprecision highp int;\n\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"}),fresnel_glow:AFRAME.registerShader("fresnel-glow",{schema:{color:{type:"color",is:"uniform",default:"#FFF"},start:{type:"number",is:"uniform",default:0},end:{type:"number",is:"uniform",default:0},alpha:{type:"number",is:"uniform",default:0}},raw:!0,fragmentShader:"#extension GL_OES_standard_derivatives : enable\n\nprecision highp float;\n\nuniform vec3 color;\nuniform float start;\nuniform float end;\nuniform float alpha;\n\nvarying vec3 fPosition;\nvarying vec3 fNormal;\n\nvoid main()\n{\n  vec3 normal = normalize(fNormal);\n  vec3 eye = normalize(-fPosition.xyz);\n  float rim = smoothstep(start, end, 1.0 - dot(normal, eye));\n  gl_FragColor = vec4( clamp(rim, 0.0, 1.0) * alpha * color, 1.0 );\n}",vertexShader:"precision highp float;\nattribute vec3 position;\nattribute vec3 normal;\nuniform mat3 normalMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nvarying vec3 fNormal;\nvarying vec3 fPosition;\n\nvoid main()\n{\n  fNormal = normalize(normalMatrix * normal);\n  vec4 pos = modelViewMatrix * vec4(position, 1.0);\n  fPosition = pos.xyz;\n  gl_Position = projectionMatrix * pos;\n}"}),solid_fill:AFRAME.registerShader("solid-fill",{schema:{colorA:{type:"color",is:"uniform",default:"#FFF"},colorB:{type:"color",is:"uniform",default:"#000"},mask:{type:"number",is:"uniform",default:0}},raw:!0,fragmentShader:"precision highp float;\nprecision highp int;\n\n#define PI 3.141592653589793238462643383279\n\nuniform vec3 colorA;\nuniform vec3 colorB;\nuniform float mask;\n\nvarying vec2 vUv;\n \nvoid main() {\n\n    float uvOffset = vUv.t;\n    float uvGradient = uvOffset ;\n    \n    vec3 color = colorB;\n    \n    if( uvGradient < mask ) {\n        color = colorA;\n    }\n    \n    gl_FragColor = vec4( color, 1.0 );\n\n}",vertexShader:"precision highp float;\nprecision highp int;\n\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"}),spinner:AFRAME.registerShader("spinner",{schema:{time:{type:"time",is:"uniform"},cameraPosition:{type:"vec3",is:"uniform",default:{x:0,y:0,z:0}},antialias:{type:"number",is:"uniform",default:400},color:{type:"color",is:"uniform",default:"#FFF"},width:{type:"number",is:"uniform",default:.04},radius:{type:"number",is:"uniform",default:.3},fadePercent:{type:"number",is:"uniform",default:.75}},raw:!0,fragmentShader:"precision highp float;\n\n#define PI 3.14159265358979323\n\nuniform float time;\nuniform float fadePerecent;\nuniform vec3 color;\n\n// Mostly relative to UV coords\nuniform float width;\nuniform float radius;\nuniform float antialias;\n\nvarying vec2 vUv;\n\nvoid main(void) {\n\t// needs to be constant (can't be a uniform)\n\tconst int antialiasing = 4;\n\tfloat invResolution = 1.0 / antialias;\n\tvec2 pos = (vUv - 0.5) * antialias;\n\t\n\tvec4 sumColor = vec4(0.0);\n\tfloat total = 0.0;\n\n\tfloat offset = 1.0 / (float(antialiasing) + 2.0);\n\tfor (int j = -antialiasing; j <= antialiasing; j++) {\n\t\tfor (int i = -antialiasing; i <= antialiasing; i++) {\n\t\t\tvec2 adjustedPos = (pos + vec2(float(i) * offset, float(j) * offset)) / antialias;\n\t\t\tfloat dist = length(adjustedPos);\n\t\t\tif ( ( radius - width ) < dist && dist < ( radius + width ) ) {\n\t\t\t\tfloat ang = atan( adjustedPos.y, adjustedPos.x );\n\t\t\t\tsumColor += vec4(\n\t\t\t\t\t( color / fadePerecent ) * ( fadePerecent - mod( ang / PI + time, 2.0 ) / 2.0 ),\n\t\t\t\t\t0.0\n\t\t\t\t);\n\t\t\t}\n\t\t\ttotal += 1.0;\n\t\t}\n\t}\n\tgl_FragColor = vec4( ( sumColor / total ).xyz, 1.0 );\n\n}\n",vertexShader:"/**\n* Example Vertex Shader\n* Sets the position of the vertex by setting gl_Position\n*/\n\n// Set the precision for data types used in this shader\nprecision highp float;\nprecision highp int;\n\n// Default THREE.js uniforms available to both fragment and vertex shader\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\n\n// Default uniforms provided by ShaderFrog.\nuniform vec3 cameraPosition;\nuniform float time;\n\n// Default attributes provided by THREE.js. Attributes are only available in the\n// vertex shader. You can pass them to the fragment shader using varyings\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n\n// Examples of variables passed from vertex to fragment shader\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec2 vUv2;\n\nvoid main() {\n\n    // To pass variables to the fragment shader, you assign them here in the\n    // main function. Traditionally you name the varying with vAttributeName\n    vNormal = normal;\n    vUv = uv;\n    vUv2 = uv2;\n    vPosition = position;\n\n    // This sets the position of the vertex in 3d space. The correct math is\n    // provided below to take into account camera and object data.\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}"}),ramp:AFRAME.registerShader("ramp",{fragmentShader:"precision mediump float;\n\nvarying vec2 vUv;\n\nuniform vec3 color1;\nuniform vec3 color2;\n\nvoid main( void ) {\n    vec3 mixCol = mix( color2, color1, vUv.y );\n\tgl_FragColor = vec4(mixCol, 1.);\n}",vertexShader:"precision highp float;\r\nprecision highp int;\r\n\r\nuniform mat4 modelMatrix;\r\nuniform mat4 modelViewMatrix;\r\nuniform mat4 projectionMatrix;\r\nuniform mat4 viewMatrix;\r\nuniform mat3 normalMatrix;\r\n\r\nattribute vec3 position;\r\nattribute vec3 normal;\r\nattribute vec2 uv;\r\nattribute vec2 uv2;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n  vUv = uv;\r\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n}",schema:{color1:{type:"color",glslType:"vec3",default:"#000000",is:"uniform"},color2:{is:"uniform",type:"color",glslType:"vec3",default:"#FFFFFF"}},raw:!0})}},622:t=>{t.exports={clickable:AFRAME.registerComponent("clickable",{schema:{type:"boolean",default:!0},init:function(){this.el.classList.add("interactive")},update:function(){1==this.data?(this.el.classList.toggle("clickable",!0),this.el.emit("canclick",{detail:this.el},!1)):0==this.data&&(this.el.classList.toggle("clickable",!1),this.el.emit("noclick",{detail:this.el},!1))}}),signal:AFRAME.registerComponent("signal",{schema:{on:{type:"string",default:"signal"},emit:{type:"string",default:"signal"},data:{type:"string"},target:{type:"selectorAll"},bubbles:{type:"boolean",default:!0}},multiple:!0,__handleRegisteredEvents:function(){var t={};this.el.dataset&&this.el.dataset[this.data.data]&&(t=AFRAME.utils.styleParser.parse(this.el.dataset[this.data.data])),t.srcEl=this.el;for(var i=this.__targets.length,s=0;s<i;s++)this.__targets[s].emit(this.data.emit,t,this.data.bubbles)},__registerEventHandler:function(t){this.el.addEventListener(t,this.__handleRegisteredEvents)},__deRegisterEventHandler:function(t){this.el.removeEventListener(t,this.__handleRegisteredEvents)},init:function(){this.__targets=this.data.target,this.__handleRegisteredEvents=this.__handleRegisteredEvents.bind(this),this.__registerEventHandler(this.data.on)},update:function(t){t.on&&this.data.on&&t.on!==this.data.on&&(this.__deRegisterEventHandler(t.on),this.__handleRegisteredEvents=this.__handleRegisteredEvents.bind(this),this.__registerEventHandler(this.data.on)),t.target&&this.data.target&&t.target!==this.data.target&&(this.__targets=this.data.target)},remove:function(){this.__deRegisterEventHandler()}}),signal_set:AFRAME.registerComponent("signal-set",{schema:{on:{type:"string"},attr:{type:"string"},target:{type:"string",default:"none"}},multiple:!0,__handleRegisteredEvents:function(){var t;t=AFRAME.utils.entity.getComponentProperty(this.el,"set__"+this.id),"none"!==this.data.target?this._targets=Array.from(document.querySelectorAll(this.data.target)):this._targets=[this.el];for(var i,s=this._targets.length,e=0;e<s;e++)i=this._targets[e],AFRAME.utils.entity.setComponentProperty(i,this.data.attr,t)},__registerEventHandler:function(t){this.el.addEventListener(t,this.__handleRegisteredEvents)},__deRegisterEventHandler:function(t){this.el.removeEventListener(t,this.__handleRegisteredEvents)},init:function(){this.id?(this._targets=[],this.__registerEventHandler=this.__registerEventHandler.bind(this),this.__handleRegisteredEvents=this.__handleRegisteredEvents.bind(this),this.__deRegisterEventHandler=this.__deRegisterEventHandler.bind(this),this.isSuspended=!1):console.error("Component id is required. Use signal-set__* to set an id.")},play:function(){this.isSuspended=!1},pause:function(){this.isSuspended=!0},update:function(t){!t.on&&this.data.on&&this.__registerEventHandler(this.data.on),t.on&&this.data.on&&t.on!==this.data.on&&(this.__deRegisterEventHandler(t.on),this.__registerEventHandler(this.data.on))},remove:function(){this.__deRegisterEventHandler()}}),attr_set:AFRAME.registerComponent("set",{schema:{type:"string"},multiple:!0,init:function(){this.id?this.__data=AFRAME.utils.styleParser.parse(this.data):console.error("Component id is required. Use attr-set__* to set an id.")},getProperties:function(){return this}}),signal_remove:AFRAME.registerComponent("signal-remove",{schema:{on:{type:"string"},target:{type:"selector"},attr:{type:"string"}},init:function(){this.onPrescribedEvent=this.onPrescribedEvent.bind(this)},onPrescribedEvent:function(){this.data.target.removeAttribute(this.data.attr)},update:function(t){t.on?(this.el.removeEventListener(t.on,this.onPrescribedEvent),this.el.addEventListener(this.data.on,this.onPrescribedEvent)):this.el.addEventListener(this.data.on,this.onPrescribedEvent)},remove:function(){this.el.removeEventListener(this.data.on,this.onPrescribedEvent),this.onPrescribedEvent=null}})}},9466:(t,i,s)=>{const e=s(7622);var n=function(){this.is="dynamic",this.position={x:0,y:0,z:0},this.quaternion={x:0,y:0,z:0,w:0}};t.exports={system:AFRAME.registerSystem("physics",{schema:{gravity:{type:"vec3",default:{x:0,y:-9.8,z:0}},timestep:{type:"number",default:.03333333},broadphase:{default:3,oneOf:[1,2,3]},iterations:{type:"number",default:1},poolsize:{type:"number",default:16},enabled:{type:"boolean",default:!0}},init:async function(){this.skipper=0,this.Bodies=new Map,this.bodyDataToPage=new Map,this.copyPagePosition=function(t,i){return i.x=t.x,i.y=t.y,i.z=t.z,i},this.copyPageQuaternion=function(t,i){return i.x=t.x,i.y=t.y,i.z=t.z,i.w=t.w,i},this.__physics=new e,this.signals={},this.signal=async function(t,i){this.signals[t]&&this.signals[t](i)},this.signal=this.signal.bind(this),this.on=async function(t,i){this.signals[t]=i},this.on=this.on.bind(this),this.emit=async function(t,i){this.__physics.postMessage({type:t,detail:i})},this.emit=this.emit.bind(this),this.onMessageReceived=async function(t){this.signal(t.data.type,{detail:t.data.detail})},this.onMessageReceived=this.onMessageReceived.bind(this),this.__physics.addEventListener("message",this.onMessageReceived),this.subscribe=async function(t,i){this.hasBodies||(this.hasBodies=!0),this.Bodies.set(t,i),this.bodyDataToPage.set(t,i.pageBody),this.emit("add-body",{BODY_ID:t,BODY_CONFIG:i.BODY_CONFIG,PAGE_BODY:i.pageBody})},this.subscribe=this.subscribe.bind(this),this.worldConfig={gravity:[this.data.gravity.x,this.data.gravity.y,this.data.gravity.z],iterations:this.data.iterations,timestep:1/48,broadphase:this.data.broadphase},this.on("physics-started",(()=>{this.engineActive=!0})),this.on("post-step",(t=>{this.workerData=t.detail.bodies,this.Bodies.forEach((t=>{t.setDirty()}))})),this.emit("init",{WORLD_CONFIG:this.worldConfig})},tick:function(){this.engineActive&&this.hasBodies&&this.emit("step",{pageBodies:this.bodyDataToPage,next:!0})}}),body:AFRAME.registerComponent("body",{dependencies:["position","rotation","scale"],schema:{owner:{type:"string",default:"worker",oneOf:["worker","page"]},move:{type:"boolean",default:!0},density:{type:"number",default:1},belongsTo:{type:"number",default:1},collidesWith:{type:"number",default:1},friction:{type:"number",default:.2},restitution:{type:"number",default:.2},type:{type:"string",default:"box",oneOf:["box","cylinder","sphere"]},sleepOn:{type:"string",default:"sleep"},wakeOn:{type:"string",default:"up"},constrainOn:{type:"string",default:"grab"},releaseOn:{type:"string",default:"released"},forceOn:{type:"string",default:"applyforce"}},multiple:!1,init:function(){this.system=this.el.sceneEl.systems.physics,this.pageBody=new n,this.pageBody.is=!0===this.data.move?"dynamic":"kinematic",this.BODY_ID="body-"+AFRAME.utils.makeId(8),this.initBody=this.initBody.bind(this),this.syncToSystem=this.syncToSystem.bind(this),this.syncFromSystem=this.syncFromSystem.bind(this),this.createShapes=this.createShapes.bind(this),this.__createDefaultShape=this.__createDefaultShape.bind(this),this.registerEventListeners=this.registerEventListeners.bind(this),this.worldPosition=new THREE.Vector3,this.worldQuaternion=new THREE.Quaternion,this.dirty=null,this.setDirty=async function(){this.dirty||(this.dirty=!0)},this.setDirty=this.setDirty.bind(this),this.el.oimo={},AFRAME.utils.entity.onSceneLoaded(this.el,this.initBody,this)},initBody:function(){this.el.oimo.shapes?this.createShapes():AFRAME.utils.entity.onModel(this.el,this.__createDefaultShape,this)},createShapes:function(){this.el.object3D.updateWorldMatrix(!0,!0),this.el.object3D.updateMatrixWorld(!0);var t,i=0,s=this.el.oimo.shapes.length;if(0!=s){var e=new THREE.Vector3,n=new THREE.Vector3;this.el.object3D.getWorldPosition(e);var h=[],a=[],o=[],r=[];for(i=0;i<s;i++)t=this.el.oimo.shapes[i].buildShape(),h[i]=t.type,a[3*i]=t.size[0],a[3*i+1]=t.size[1],a[3*i+2]=t.size[2],o[3*i]=t.pos[0],o[3*i+1]=t.pos[1],o[3*i+2]=t.pos[2],r[3*i]=t.rot[0],r[3*i+1]=t.rot[1],r[3*i+2]=t.rot[2];this.BODY_CONFIG={type:h,pos:e.toArray(),rot:n.copy(this.el.getAttribute("rotation")).toArray(),move:this.data.move,size:a,posShape:o,rotShape:r,density:this.data.density,restitution:this.data.restitution,friction:this.data.friction,collidesWith:this.data.collidesWith,belongsTo:this.data.belongsTo,name:this.BODY_ID},this.registerEventListeners()}else this.__createDefaultShape()},__createDefaultShape:function(){this.el.object3D.updateWorldMatrix(!0,!0),this.el.object3D.updateMatrixWorld(!0);var t=new THREE.Vector3,i=new THREE.Vector3,s=new THREE.Vector3;this.el.object3D.getWorldPosition(t);var e=new THREE.Box3;e.setFromObject(this.el.object3DMap.mesh),e.getSize(i),this.BODY_CONFIG={type:this.data.type,move:this.data.move,size:i.toArray(),pos:t.toArray(),rot:s.copy(this.el.getAttribute("rotation")).toArray(),density:this.data.density,restitution:this.data.restitution,friction:this.data.friction,collidesWith:this.data.collidesWith,belongsTo:this.data.belongsTo,name:this.BODY_ID,allowSleep:!0},this.registerEventListeners()},registerEventListeners:function(){this.kinemize=async function(){this.sync=this.syncToSystem,this.pageBody.is="kinematic",this.system.emit("kinemize-body",{BODY_ID:this.BODY_ID})},this.kinemize=this.kinemize.bind(this),this.dynamize=async function(){this.sync=this.syncFromSystem,this.pageBody.is="dynamic",this.system.emit("dynamize-body",{BODY_ID:this.BODY_ID})},this.dynamize=this.dynamize.bind(this),this.el.addEventListener("constraintadded",this.kinemize),this.el.addEventListener("constraintremoved",this.dynamize),this.system.subscribe(this.BODY_ID,this),this.sync=!0===this.data.move?this.syncFromSystem:this.syncToSystem},syncFromSystem:function(){this.dirty&&(this.dirty=null,this.workerBody=this.system.workerData.get(this.BODY_ID),this.workerBody&&(this.el.object3D.position.copy(this.workerBody.position),this.el.object3D.quaternion.copy(this.workerBody.quaternion)))},syncToSystem:function(){this.el.object3D.getWorldPosition(this.worldPosition),this.el.object3D.getWorldQuaternion(this.worldQuaternion),this.system.copyPagePosition(this.worldPosition,this.pageBody.position),this.system.copyPageQuaternion(this.worldQuaternion,this.pageBody.quaternion)},tick:function(){this.sync&&this.sync()}}),shape:AFRAME.registerComponent("shape",{schema:{type:{type:"string",default:"box",oneOf:["box","cylinder","sphere"]},offset:{type:"vec3",default:{x:0,y:0,z:0}},orient:{type:"vec3",default:{x:0,y:0,z:0}},size:{type:"vec3",default:{x:0,y:0,z:0}},debug:{type:"boolean",default:!0}},multiple:!0,init:function(){this.el.oimo||(this.el.oimo={}),this.el.oimo.shapes||(this.el.oimo.shapes=[]),this.el.oimo.shapes.push(this)},buildShape:function(){var t=this.data,i=(new THREE.Vector3).copy(this.data.orient),s=(new THREE.Vector3).copy(this.data.offset),e=(new THREE.Vector3).copy(this.data.size);if(1==this.data.debug){var n,h,a,o=new THREE.Object3D;switch(t.type){case"cylinder":n=new THREE.CylinderBufferGeometry(t.size.x,t.size.x,t.size.y,16,1),h=new THREE.EdgesGeometry(n),a=new THREE.LineSegments(h,new THREE.LineBasicMaterial({color:16777215})),o.add(a);break;case"sphere":n=new THREE.SphereBufferGeometry(t.size.x,12,8),h=new THREE.EdgesGeometry(n),a=new THREE.LineSegments(h,new THREE.LineBasicMaterial({color:16777215})),o.add(a);break;case"box":default:n=new THREE.BoxBufferGeometry(t.size.x,t.size.y,t.size.z),h=new THREE.EdgesGeometry(n),a=new THREE.LineSegments(h,new THREE.LineBasicMaterial({color:16777215})),o.add(a)}this.el.object3D.updateMatrixWorld(!0),this.el.object3D.add(o),o.updateMatrixWorld(!0),o.translateX(s.x),o.translateY(s.y),o.translateZ(s.z),o.rotateX(i.x),o.rotateY(i.y),o.rotateZ(i.z),o.updateMatrixWorld(!0)}return{type:t.type,pos:s.toArray(),rot:i.toArray(),size:e.toArray()}}})}},3454:(t,i,s)=>{s(1441),s(9114)},1441:t=>{t.exports={"group-system":AFRAME.registerSystem("grp",{init:async function(){var t=[],i=new Map;i.set("hands",[]).set("grabbable",[]).set("hoverable",[]).set("droppable",[]).set("draggable",[]).set("empty",[]).set("all",[]),this.subscribe=async function(s){var e;-1===t.indexOf(s.el)&&t.push(s.el),i.has(s.id)||i.set(s.id,[]),-1===(e=i.get(s.id)).indexOf(s.el)&&e.push(s.el)},this.subscribe=this.subscribe.bind(this),this.unsubscribe=async function(s){var e,n;-1!==(e=t.indexOf(s.el))?i.has(s.id)?-1!==(e=(n=i.get(s.id)).indexOf(s.el))?n.splice(e,1):console.log("not a member of group"):console.log("group does not exist"):console.log("not a member")},this.unsubscribe=this.unsubscribe.bind(this),this.getGroup=function(t){return i.has(t)?i.get(t):i.get("empty")},this.getGroup=this.getGroup.bind(this),this.hasGroup=function(t){return 1==i.has(t)||null},this.hasGroup=this.hasGroup.bind(this)}}),group:AFRAME.registerComponent("grp",{multiple:!0,init:async function(){this.id&&this.system.subscribe(this)},remove:async function(){this.id&&this.system.unsubscribe(this)}}),"hand-alignments":AFRAME.registerComponent("hand-aligns",{schema:{src:{type:"asset"},hand:{type:"string",oneOf:["left","right"]},debug:{type:"boolean",default:!1}},multiple:!0,init:function(){var t=this.el,i=this.data.hand,s=this.data.debug;(new THREE.ObjectLoader).load(this.data.src,(e=>{e.children.forEach((e=>{var n=e.position,h=AFRAME.utils.math.vectorRadToDeg(e.rotation.toVector3(new THREE.Vector3));if("left"===i&&(n.x=-1*n.x,h.y=-1*h.y),t.setAttribute(e.name,{offset:n,orient:h,debug:s}),!0===s){var a=`<a-text position="${e.position.x} ${e.position.y} ${e.position.z}"  \n\t\t\t\t\t\tscale="0.1 0.1 0.1" look-at="#vr-camera" value="${e.name}" text="align: center; width: 1;"></a-text>`;t.insertAdjacentHTML("afterbegin",a)}}))}))},remove:function(){}}),hand:AFRAME.registerComponent("oculus-quest-hands",{schema:{camera:{type:"selector",default:"#vr-camera"},src:{type:"asset"},hand:{type:"string",default:"right",oneOf:["right","left"]},alignSrc:{type:"asset"},pointControls:{type:"boolean",default:!0},debug:{type:"boolean",default:!1}},init:function(){this.el.setAttribute("grp__hands",""),this.el.setAttribute("grp__hand"+this.data.hand,""),this.setOtherHand=function(t){this.otherHandEl=t},this.eventHandlers={},this.el.setAttribute("tracked-controls",{hand:this.data.hand,headElement:this.data.camera,armModel:!0,autoHide:!1}),this.el.setAttribute("oculus-touch-controls",{hand:this.data.hand,model:!1,orientationOffset:{x:0,y:0,z:0}}),this.bindMethods=this.bindMethods.bind(this),this.bindMethods()},bindMethods:function(){this.onEntityLoaded=this.onEntityLoaded.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.addAnimationClip=this.addAnimationClip.bind(this),this.animateHand=this.animateHand.bind(this),this.registerEventListeners=this.registerEventListeners.bind(this),this.deregisterEventListeners=this.deregisterEventListeners.bind(this),this.dirty=null,this.getDirty=function(){return this.dirty},this.setDirty=async function(){this.dirty||(this.dirty=!0)},this.setDirty=this.setDirty.bind(this),this.getDirty=this.getDirty.bind(this),this.on=this.on.bind(this),this.determineHandGesture=this.determineHandGesture.bind(this),this.determineFingerGesture=this.determineFingerGesture.bind(this),AFRAME.utils.entity.onLoad(this.el,this.onEntityLoaded,this)},addAnimationClip:function(t){this.el.object3DMap.mesh.clips[t.name]=t,this.el.object3DMap.mesh.actions[t.name]=this.handMesh.mixer.clipAction(this.el.object3DMap.mesh.clips[t.name]),Object.assign(this.el.object3DMap.mesh.actions[t.name],this.animationConfig)},onEntityLoaded:function(){var t=new THREE.GLTFLoader,i=this.data,s=this;t.load(i.src,(function(t){s.hand=t.scene,s.handMesh=t.scene.getObjectByName("glove_"+i.hand),s.handMesh.mixer=new THREE.AnimationMixer(s.handMesh),s.el.setObject3D("mesh",s.hand),AFRAME.utils.entity.onObject3DAdded(s.el,"mesh",s.onModelLoaded,s,t.animations)}),(function(t){i.debug&&1==i.debug&&console.log(`Model is ${t.loaded/t.total*100} % loaded`)}),(function(t){console.error(t)}))},onModelLoaded:function(t){this.el.object3DMap.mesh.clips={},this.el.object3DMap.mesh.actions={},this.animationConfig={repetitions:0,time:0,weight:0,loop:THREE.LoopRepeat,clampWhenFinished:!0},t.forEach(this.addAnimationClip),this.hasAnimations=!0,this.el.setAttribute("proxy",{debug:this.data.debug,shape:"oct",size:{x:.045,y:.085,z:.125},offset:{x:"right"==this.data.hand?-.007:.007,y:-.036,z:.002}}),this.el.setAttribute("collider",{bounds:"proxy",debug:this.data.debug,autoRefresh:!0,static:!1,interval:10}),this.collider=this.el.components.collider,this.el.setAttribute("hand-aligns",{hand:this.data.hand,src:this.data.alignSrc,debug:!1}),1==this.data.pointControls&&this.el.setAttribute("point-controls",{enabled:!0,debug:this.data.debug,hand:this.data.hand}),this.registerEventListeners()},on:function(t,i){i=i.bind(this),this.eventHandlers[t]=i,this.el.addEventListener(t,this.eventHandlers[t])},registerEventListeners:function(){var t=null,i=this;i.onTriggerTouchStart=async function(){i.el.is("holding-something")||(i.el.removeState("pointing"),i.el.emit("pointend",{handEl:i.el,hand:i.data.hand})),i.setDirty()},i.onTriggerTouchEnd=async function(){i.el.is("holding-something")||(i.el.addState("pointing"),i.el.emit("pointstart",{handEl:i.el,hand:i.data.hand})),i.setDirty()},i.onGripDown=async function(){i.el.removeState("open"),(t=i.collider.getIntersections("grabbable",!0))?(i.holdingEl=t.nearestEl,i.holdingEl.setAttribute("constraint",{parent:i.el}),i.el.is("holding-something")||(i.el.addState("holding-something"),i.holdingEl.emit("grabbed",{handEl:i.el,hand:i.data.hand}),i.el.emit("grab",{holdingEl:i.holdingEl})),i.holdingEl.components.grabbable&&(i.holdingEl.components.grabbable.grab(i),i.holdPose=i.holdingEl.components.grabbable.data.pose,"none"===i.holdPose?(i.el.addState("fist"),i.el.object3DMap.mesh.visible=!1):i.el.addState("pose"))):i.el.addState("fist"),i.setDirty()},i.onGripUp=async function(){i.el.object3DMap.mesh.visible=!0,i.el.addState("open"),i.el.removeState("fist"),i.el.removeState("gripping"),i.el.removeState("pose"),i.el.is("holding-something")&&(i.holdingEl.components.grabbable&&i.holdingEl.components.grabbable.release(i),i.holdingEl&&(i.holdingEl.removeAttribute("constraint"),i.holdingEl.emit("released",{handEl:i.el,hand:i.data.hand}),i.el.emit("release",{holdingEl:i.holdingEl})),i.el.removeState("holding-something"),i.holdingEl=null),i.holdPose=null,i.setDirty()},i.onConstraintChanged=async function(){i.el.removeState("fist"),i.el.removeState("pose"),i.el.addState("open"),i.el.is("holding-something")&&(i.holdingEl.components.grabbable&&i.holdingEl.components.grabbable.release(i),i.el.removeState("holding-something"),i.holdingEl=null,i.holdPose=null,"none"===i.holdPose&&(i.el.object3DMap.mesh.visible=!0)),i.setDirty()},i.onThumbTouchStart=async function(){i.el.is("holding-something")||i.el.removeState("thumbsup"),i.setDirty()},i.onThumbTouchEnd=async function(){i.el.is("holding-something")||i.el.addState("thumbsup"),i.setDirty()},i.el.addEventListener("gripdown",i.onGripDown),i.el.addEventListener("gripup",i.onGripUp),i.el.addEventListener("constraintchanged",i.onConstraintChanged),i.el.addEventListener("triggertouchend",i.onTriggerTouchEnd),i.el.addEventListener("triggertouchstart",i.onTriggerTouchStart),i.el.addEventListener("thumbsticktouchstart",i.onThumbTouchStart),i.el.addEventListener("xbuttontouchstart",i.onThumbTouchStart),i.el.addEventListener("ybuttontouchstart",i.onThumbTouchStart),i.el.addEventListener("abuttontouchstart",i.onThumbTouchStart),i.el.addEventListener("bbuttontouchstart",i.onThumbTouchStart),i.el.addEventListener("thumbsticktouchend",i.onThumbTouchEnd),i.el.addEventListener("xbuttontouchend",i.onThumbTouchEnd),i.el.addEventListener("ybuttontouchend",i.onThumbTouchEnd),i.el.addEventListener("abuttontouchend",i.onThumbTouchEnd),i.el.addEventListener("bbuttontouchend",i.onThumbTouchEnd)},determineFingerGesture:function(t){return"fist"!=t&&"open"!=t||(this.el.is("pointing")&&(t+="_point"),this.el.is("thumbsup")&&(t+="_thumb")),t},determineHandGesture:function(){this.el.is("fist")?this.animateHand(this.determineFingerGesture("fist")):this.el.is("open")?this.animateHand(this.determineFingerGesture("open")):this.el.is("pose")&&this.animateHand(this.holdPose)},deregisterEventListeners:function(){},animateHand:function(t){if(this.lastPose||(this.lastPose="open"),this.handMesh.mixer.stopAllAction(),this.lastPose==t)return this.handMesh.mixer.stopAllAction(),void this.el.object3DMap.mesh.actions[t].play();this.el.object3DMap.mesh.actions[t]&&(this.el.object3DMap.mesh.actions[t].time=0,this.el.object3DMap.mesh.actions[t].weight=1,this.el.object3DMap.mesh.actions[t].play(),this.el.object3DMap.mesh.actions[t].time=0,this.el.object3DMap.mesh.actions[this.lastPose].weight=0,this.el.object3DMap.mesh.actions[this.lastPose].play(),this.el.object3DMap.mesh.actions[this.lastPose].crossFadeTo(this.el.object3DMap.mesh.actions[t],.075,!0),this.lastPose=t)},tick:function(t,i){this.getDirty()&&(this.dirty=null,this.determineHandGesture()),this.hasAnimations&&this.handMesh.mixer.update(i/1e3)}}),grabbable:AFRAME.registerComponent("grabbable",{dependencies:["collider"],schema:{enabled:{type:"boolean",default:!0},handAlign:{type:"string",default:"none"},pose:{type:"string",default:"none"},centerAlign:{type:"string",default:"none"},debug:{type:"boolean",default:!1}},init:function(){this.collider=this.el.components.collider,this.grab=this.grab.bind(this),this.release=this.release.bind(this),this.align=this.align.bind(this),this.el.setAttribute("grp__grabbable",""),this.originalColliderProperties=JSON.parse(JSON.stringify(AFRAME.utils.entity.getComponentProperty(this.el,"collider"))),this.originalColliderProperties.bounds&&delete this.originalColliderProperties.bounds,this.targetPosition=new THREE.Vector3,this.targetQuaternion=new THREE.Quaternion,this.intermediatePos=new THREE.Vector3,this.intermediateQuat=new THREE.Quaternion,this.startPos=new THREE.Vector3,this.startQuat=new THREE.Quaternion},grab:function(t){if(this.el.is("grabbed")||this.el.addState("grabbed"),this.el.components.droppable){var i=this.el.components.droppable.data.group;this.el.components["grp__"+i]&&this.el.removeAttribute("grp__"+i)}this.el.setAttribute("collider",{autoRefresh:!1,static:!1,interval:20}),"none"!==this.handAlign&&t.el.components["aligner__"+this.data.handAlign]&&this.align(t.el.object3DMap["aligner__"+this.data.handAlign])},align:function(t){this.targetPosition.copy(t.position),this.targetQuaternion.copy(t.quaternion),this.startPos.copy(this.el.object3D.position),this.startQuat.copy(this.el.object3D.quaternion),this.el.object3D.position.copy(this.targetPosition),this.el.object3D.quaternion.copy(this.targetQuaternion)},animateAlignment:function(){},release:function(t){var i=null;if(this.el.is("grabbed")&&this.el.removeState("grabbed"),this.el.components.droppable){var s=this.el.components.droppable.data.group;this.el.components["grp__"+s]||this.el.setAttribute("grp__"+s,""),(i=this.collider.getIntersections("droptarget",!0))&&i.nearestEl.components["drop-target"].snap(this.el)}this.el.setAttribute("collider",this.originalColliderProperties)}}),"collider-component":AFRAME.registerComponent("collider",{dependencies:["position","rotation","scale"],schema:{interval:{type:"number",default:40},collidesWith:{type:"string",default:"none"},bounds:{type:"string",default:"auto",oneOf:["auto","proxy","box","mesh","computed"]},size:{type:"vec3",default:{x:0,y:0,z:0}},static:{type:"boolean",default:!1},enabled:{type:"boolean",default:!0},autoRefresh:{type:"boolean",default:!1},debug:{type:"boolean",default:!1}},init:function(){if(this.groupManager=this.el.sceneEl.systems.grp,this.__testA=new THREE.Vector3,this.__testB=new THREE.Vector3,this.AABB=new THREE.Box3,!0===this.data.debug){var t=new THREE.Box3Helper(this.AABB);this.el.sceneEl.object3D.add(t)}this.createAABBFromAuto=this.createAABBFromAuto.bind(this),this.createAABBFromMesh=this.createAABBFromMesh.bind(this),this.createAABBFromProxy=this.createAABBFromProxy.bind(this),this.createAABBFromBox=this.createAABBFromBox.bind(this),this.createAABBFromComputed=this.createAABBFromComputed.bind(this),this.getIntersections=this.getIntersections.bind(this),this.updateIntersections=this.updateIntersections.bind(this),this.addIntersection=this.addIntersection.bind(this),this.removeIntersection=this.removeIntersection.bind(this),this.subscribe=this.subscribe.bind(this),this.clearedEls=[],this.intersectedEls=[],this.nearestEl=null,this.__distanceTest=1/0,this.__distanceNearest=1/0,this.__intersections=[],this.__intersectionsCleared=[],this.__elapsed=0},subscribe:function(){this.subscribed||(this.subscribed=!0,this.el.emit("colliderready",{el:this.el,collider:this},!1))},update:function(t){if(!t.bounds||t.bounds&&t.bounds!==this.data.bounds)switch(this.data.bounds){case"box":this.createAABBFromBox();break;case"proxy":AFRAME.utils.entity.onObject3DAdded(this.el,"proxy",this.createAABBFromProxy,this);break;case"computed":AFRAME.utils.entity.onObject3DAdded(this.el,"proxy",this.createAABBFromComputed,this);break;case"mesh":AFRAME.utils.entity.onModel(this.el,this.createAABBFromMesh,this);break;case"auto":default:AFRAME.utils.entity.onModel(this.el,this.createAABBFromAuto,this)}},createAABBFromAuto:function(){this.el.object3D.updateWorldMatrix(!0,!0),this.el.object3D.updateMatrixWorld(!0),this.AABB.setFromObject(this.el.object3DMap.mesh);var t=new THREE.Vector3,i=new THREE.Vector3,s=new THREE.Vector3;this.AABB.getSize(t),this.AABB.getCenter(i),this.el.object3D.getWorldPosition(s),i.sub(s),t.divide(this.el.object3D.scale),this.el.setAttribute("proxy",{size:t}),this.AABB.setFromObject(this.el.object3DMap.proxy),this.updateAABB=function(){this.AABB.setFromObject(this.el.object3DMap.proxy)},this.updateAABB=this.updateAABB.bind(this),this.subscribe()},createAABBFromComputed:function(){this.el.object3DMap.proxy.geometry.computeBoundingBox(),this.AABB=this.el.object3DMap.proxy.geometry.boundingBox.clone(),this.updateAABB=function(){this.el.object3DMap.proxy.geometry.computeBoundingBox(),this.el.object3DMap.proxy.updateMatrixWorld(!0),this.AABB.copy(this.el.object3DMap.proxy.geometry.boundingBox).applyMatrix4(this.el.object3DMap.proxy.matrixWorld)},this.updateAABB=this.updateAABB.bind(this),this.subscribe()},createAABBFromBox:function(){this.el.object3D.updateWorldMatrix(!0,!0),this.el.object3D.updateMatrixWorld(!0);var t=new THREE.Vector3;this.el.object3D.getWorldPosition(t),this.AABB.setFromCenterAndSize(t,this.data.size),this.updateAABB=function(){this.el.object3D.getWorldPosition(t),this.AABB.setFromCenterAndSize(t,this.data.size)},this.updateAABB=this.updateAABB.bind(this),this.subscribe()},createAABBFromProxy:function(){this.el.object3D.updateWorldMatrix(!0,!0),this.el.object3D.updateMatrixWorld(!0),this.AABB.setFromObject(this.el.object3DMap.proxy),this.updateAABB=function(){this.AABB.setFromObject(this.el.object3DMap.proxy)},this.updateAABB=this.updateAABB.bind(this),this.subscribe()},createAABBFromMesh:function(){this.el.object3D.updateWorldMatrix(!0,!0),this.el.object3D.updateMatrixWorld(!0),this.AABB.setFromObject(this.el.object3DMap.mesh);var t=new THREE.Vector3,i=new THREE.Vector3,s=new THREE.Vector3;this.AABB.getSize(t),this.AABB.getCenter(i),this.el.object3D.getWorldPosition(s),i.sub(s),t.divide(this.el.object3D.scale),this.updateAABB=function(){this.AABB.setFromObject(this.el.object3DMap.mesh)},this.updateAABB=this.updateAABB.bind(this),this.subscribe()},getIntersections:function(t,i){var s=this.groupManager.getGroup(t),e=s.length;if(e<1)return null;i&&1==i&&this.updateAABB();for(var n,h=1/0,a=1/0,o=[],r=null,l=0;l<e;l++)n=s[l].components.collider,i&&1==i&&n.updateAABB(),1==this.AABB.intersectsBox(n.AABB)&&1==n.data.enabled&&(o.push(n.el),this.el.object3D.getWorldPosition(this.__testA),n.el.object3D.getWorldPosition(this.__testB),(h=this.__testA.distanceToSquared(this.__testB))<a&&(a=h,r=n.el));return r?{intersectedEls:o,nearestEl:r}:null},addIntersection:function(t){-1===this.intersectedEls.indexOf(t)&&(0!==this.intersectedEls.length||this.el.is("colliding")||this.el.addState("colliding"),this.intersectedEls.push(t),this.el.emit("hitstart",{el:t,intersectedEls:this.intersectedEls,nearestEl:this.nearestEl},!1),t.emit("hitstart",{el:t},!1))},removeIntersection:function(t){if(-1!==this.intersectedEls.indexOf(t)){var i=this.intersectedEls.indexOf(t);this.intersectedEls.splice(i,1),this.el.emit("hitend",{clearedEl:t,intersectedEls:this.intersectedEls},!1),t.emit("hitend",{clearedEl:t,intersectedEls:this.intersectedEls},!1)}0===this.intersectedEls.length&&this.el.is("colliding")&&this.el.removeState("colliding")},updateIntersections:function(){var t=this.groupManager.getGroup(this.data.collidesWith);if(this.__stepMax=t.length,!(this.__stepMax<1)&&!1!==this.data.enabled){var i;for(this.__distanceNearest=1/0,this.__distanceTest=0,this.__intersections.splice(0,this.__intersections.length),this.__intersectionsCleared.splice(0,this.__intersectionsCleared.length),this.__nearestEl=null,this.__step=0,this.__step=0;this.__step<this.__stepMax;this.__step++)1==(i=t[this.__step].components.collider).data.enabled&&(1==this.AABB.intersectsBox(i.AABB)?(this.el.object3D.getWorldPosition(this.__testA),i.el.object3D.getWorldPosition(this.__testB),this.__distanceTest=this.__testA.distanceToSquared(this.__testB),this.__distanceTest<this.__distanceNearest&&(this.__distanceNearest=this.__distanceTest,this.__nearestEl=i.el),this.__intersections.push(i.el)):this.__intersectionsCleared.push(i.el));for(this.nearestEl=this.__nearestEl,this.__stepMax=this.__intersections.length,this.__step=0;this.__step<this.__stepMax;this.__step++)this.addIntersection(this.__intersections[this.__step]);for(this.__stepMax=this.__intersectionsCleared.length,this.__step=0;this.__step<this.__stepMax;this.__step++)this.removeIntersection(this.__intersectionsCleared[this.__step])}},tick:function(t,i){this.subscribed&&0!=this.data.enabled&&(this.firstTick||(this.firstTick=!0,this.updateAABB()),this.__elapsed=this.__elapsed+i,this.__elapsed<this.data.interval||(this.__elapsed=0,!0!==this.data.static&&this.updateAABB(),!0===this.data.autoRefresh&&this.updateIntersections()))},remove:function(){"auto"==this.data.bounds&&this.el.object3DMap.proxy&&this.el.removeAttribute("proxy")}}),"collider-proxy-system":AFRAME.registerSystem("proxy",{schema:{debug:{type:"boolean",default:!1}},init:function(){this.material=new THREE.MeshBasicMaterial({wireframe:!0,color:"cyan",visible:this.data.debug})}}),"collider-proxy-component":AFRAME.registerComponent("proxy",{schema:{shape:{type:"string",default:"box",oneOf:["box","oct","sphere"]},orient:{type:"vec3",default:{x:0,y:0,z:0}},offset:{type:"vec3",default:{x:0,y:0,z:0}},size:{type:"vec3",default:{x:1,y:1,z:1}},debug:{type:"boolean",default:!1}},init:function(){switch(this.data.shape){case"sphere":this.geometry=new THREE.SphereBufferGeometry(this.data.size.x,this.data.size.y,this.data.size.z);break;case"oct":this.geometry=new THREE.OctahedronBufferGeometry(this.data.size.x,0);break;case"box":default:this.geometry=new THREE.BoxBufferGeometry(this.data.size.x,this.data.size.y,this.data.size.z)}this.proxy=new THREE.Mesh(this.geometry,this.system.material),this.setRotation=this.setRotation.bind(this),this.setPosition=this.setPosition.bind(this),this.el.setObject3D("proxy",this.proxy),this.el.object3DMap.proxy.updateWorldMatrix(!0,!0),this.el.object3DMap.proxy.updateMatrixWorld(!0),this.proxy.visible=this.data.debug},setPosition:function(t){this.proxy.position.set(t.x,t.y,t.z)},setRotation:function(t){this.proxy.rotation.set(THREE.Math.degToRad(t.x),THREE.Math.degToRad(t.y),THREE.Math.degToRad(t.z))},remove:function(){this.el.object3DMap.proxy&&this.el.removeObject3D("proxy")},update:function(t){if(this.setRotation(this.data.orient),this.setPosition(this.data.offset),t.size&&t.shape)return 0==AFRAME.utils.deepEqual(t.size,this.data.size)||t.shape!==this.data.shape?(this.remove(),void this.init()):void 0}}),constraint:AFRAME.registerComponent("constraint",{schema:{parent:{type:"selector"}},init:function(){this.originalParent=this.el.object3D.parent},update:function(t){this.data.parent.object3DMap.constraint||this.data.parent.setObject3D("constraint",new THREE.Group),this.data.parent.object3DMap.constraint.attach(this.el.object3D),this.el.addState("constrained"),t.parent&&t.parent!==this.data.parent&&(this.el.emit("constraintchanged",{parent:this.data.parent,el:this.el},!0),t.parent.emit("constraintchanged",{parent:this.data.parent,el:this.el},!0)),t.parent||(this.el.emit("constraintadded",{parent:this.data.parent,el:this.el},!0),this.data.parent.emit("constraintadded",{parent:this.data.parent,el:this.el},!0))},remove:function(){this.originalParent.attach(this.el.object3D),this.el.removeState("constrained"),this.el.emit("constraintremoved",{parent:this.data.parent,el:this.el},!1),this.data.parent.emit("constraintremoved",{parent:this.data.parent,el:this.el},!1)}}),aligner:AFRAME.registerComponent("aligner",{schema:{orient:{type:"vec3",default:{x:0,y:0,z:0}},offset:{type:"vec3",default:{x:0,y:0,z:0}},debug:{type:"boolean",default:!1}},multiple:!0,init:function(){this.id&&(this.origin=new THREE.Group,1==this.data.debug&&(this.helper=AFRAME.utils.axishelper(),this.origin.add(this.helper),this.helper.scale.multiplyScalar(.01)),this.setRotation=this.setRotation.bind(this),this.setPosition=this.setPosition.bind(this),this.origin.name=this.id,this.el.setObject3D("aligner__"+this.id,this.origin))},setPosition:function(t){this.origin.position.set(t.x,t.y,t.z)},setRotation:function(t){this.origin.rotation.set(THREE.Math.degToRad(t.x),THREE.Math.degToRad(t.y),THREE.Math.degToRad(t.z))},remove:function(){this.el.object3DMap["aligner__"+this.id]&&this.el.removeObject3D("aligner__"+this.id)},update:function(){this.id&&(this.setRotation(this.data.orient),this.setPosition(this.data.offset),this.origin.visible=this.data.debug)}}),"point-controls":AFRAME.registerComponent("point-controls",{schema:{offset:{type:"vec3",default:{x:0,y:0,z:0}},hand:{type:"string",default:"right",oneOf:["right","left"]},enabled:{type:"boolean",default:!0},debug:{type:"boolean",default:!1}},init:function(){this.fingerID=`finger-${this.data.hand}-${AFRAME.utils.makeId(5)}`,this.onLoad=this.onLoad.bind(this),this.onPoint=this.onPoint.bind(this),this.offPoint=this.offPoint.bind(this),this.fingerEl=document.createElement("a-entity"),this.fingerEl.setAttribute("grp__fingers",""),this.fingerEl.setAttribute("grp__finger-"+this.data.hand,""),this.fingerEl.setAttribute("proxy",{shape:"box",offset:{x:"right"===this.data.hand?.039:-.036,y:-.008,z:-.064},size:{x:.013,y:.013,z:.016},debug:this.data.debug}),this.fingerEl.setAttribute("collider",{enabled:this.data.enabled,bounds:"proxy",interval:10,static:!1,autoRefresh:!0,collidesWith:"pokeable",debug:this.data.debug}),this.onLoad=this.onLoad.bind(this),AFRAME.utils.entity.onLoad(this.el,this.onLoad,this)},onPoint:function(){AFRAME.utils.entity.setComponentProperty(this.fingerEl,"collider",{enabled:!0,autoRefresh:!0,static:!1})},offPoint:function(){AFRAME.utils.entity.setComponentProperty(this.fingerEl,"collider",{enabled:!1,autoRefresh:!1,static:!1})},onLoad:function(){this.el.appendChild(this.fingerEl),this.el.addEventListener("pointstart",this.onPoint),this.el.addEventListener("pointend",this.offPoint)},update:function(){this.fingerEl&&AFRAME.utils.entity.setComponentProperty(this.fingerEl,"collider",{enabled:this.data.enabled})},remove:function(){this.el.removeEventListener("pointstart",this.onPoint),this.el.removeEventListener("pointend",this.offPoint),this.fingerEl&&(this.fingerEl.removeAttribute("proxy"),this.fingerEl.removeAttribute("collider"),this.el.removeChild(this.fingerEl))}}),pokeable:AFRAME.registerComponent("pokeable",{schema:{enabled:{type:"boolean",default:!0},debug:{type:"boolean",default:!1}},onHit:function(t){this.el.is("poked")||(this.el.emit("pokestart",{el:t.detail.el}),this.el.addState("poked"))},offHit:function(t){this.el.is("poked")&&(this.el.emit("pokeend",{el:t.detail.el}),this.el.removeState("poked"))},init:function(){this.el.setAttribute("grp__pokeable",""),AFRAME.utils.entity.setComponentProperty(this.el,"collider",{debug:this.data.debug}),this.onHit=this.onHit.bind(this),this.offHit=this.offHit.bind(this),this.el.addEventListener("hitstart",this.onHit),this.el.addEventListener("hitend",this.offHit)},update:function(){AFRAME.utils.entity.setComponentProperty(this.el,"collider","enabled",this.data.enabled)},remove:function(){this.el.removeAttribute("grp__pokeable"),this.el.removeAttribute("collider"),this.el.removeAttribute("proxy")}}),droppable:AFRAME.registerComponent("droppable",{schema:{group:{type:"string",default:"droppable"},enabled:{type:"boolean",default:!0}},init:function(){},update:function(){},onGrab:function(){},onRelease:function(){},remove:function(){}}),"drop-target":AFRAME.registerComponent("drop-target",{schema:{enabled:{type:"boolean",default:!0},group:{type:"string",default:"droppable"}},snap:function(t){this.holdingEl=t,this.holdingEl.setAttribute("constraint",{parent:this.el}),this.el.addState("holding-something"),this.holdingEl.emit("dropped",{el:t}),this.el.emit("dropped",{el:t})},onHit:function(t){var i=t.detail.el;i.is("grabbed")||this.snap(i)},offHit:function(t){console.log(t)},init:function(){this.el.setAttribute("grp__droptarget",""),this.snap=this.snap.bind(this),AFRAME.utils.entity.setComponentProperty(this.el,"collider",{autoRefresh:!0,collidesWith:this.data.group,debug:!0}),this.collider=this.el.components.collider,this.onHit=this.onHit.bind(this),this.offHit=this.offHit.bind(this),this.el.addEventListener("hitstart",this.onHit),this.el.addEventListener("hitend",this.offHit)},update:function(){AFRAME.utils.entity.setComponentProperty(this.el,"collider","enabled",this.data.enabled)},remove:function(){}}),timer:AFRAME.registerComponent("timer",{schema:{startOn:{type:"string",default:"hitstart"},enabled:{type:"boolean",default:!0}},init:function(){}}),"velocity-system":AFRAME.registerSystem("velocityx",{schema:{interval:{type:"number",default:30},debug:{type:"boolean",default:!1}}}),velocity:AFRAME.registerComponent("velocityx",{dependencies:["position","rotation","scale"],schema:{type:"vec3",default:new THREE.Vector3(0,0,0)},init:function(){if(this.interval=Math.ceil(1e3/this.system.data.interval),this.__elapsed=0,this.WorldPosition=new THREE.Vector3,this.WorldPositionLast=new THREE.Vector3,this.step=new THREE.Vector3,this.stepDelta=new THREE.Vector3,this.stepNext=new THREE.Vector3,1==this.system.data.debug){var t=this;this.speedometer=document.createElement("a-entity");t.el.appendChild(this.speedometer),t.speedometer.setAttribute("text",{align:"center",width:"0.25",anchor:"align",baseline:"center",wrapCount:20}),t.speedometer.updateText=function(i){i=String(i),t.speedometer.setAttribute("text",{value:i})},AFRAME.utils.entity.onModel(this.el,(function(){var t=(new THREE.Box3).setFromObject(this.el.object3DMap.mesh),i=new THREE.Vector3;t.getSize(i),this.speedometer.object3D.translateY(i.y/2+.1)}),this)}},tick:function(t,i){this.__elapsed+=i,this.__elapsed<this.interval||(this.__elapsed=0,this.el.object3D.getWorldPosition(this.WorldPosition),this.stepDelta.copy(this.WorldPosition).sub(this.WorldPositionLast),this.data.copy(this.stepDelta),this.speedometer&&this.speedometer.updateText(`x: ${this.data.x.toFixed(2)}, \ny: ${this.data.y.toFixed(2)},\nz: ${this.data.z.toFixed(2)}`),this.WorldPositionLast.copy(this.WorldPosition))}}),speed:AFRAME.registerComponent("speedx",{dependencies:["position","rotation","scale","velocity"],schema:{type:"vec3",default:new THREE.Vector3(0,0,0)},init:function(){}})}},9114:t=>{t.exports={teleporter_system:AFRAME.registerSystem("teleporter-controls",{schema:{noSwap:{type:"boolean",default:!1},marker:{type:"selector"},markerRadius:{type:"number",default:.33},markerHeight:{type:"number",default:.25},markerDivisions:{type:"number",default:24},playerHeightOffset:{type:"number",default:1.5}},init:function(){this.components=[],this.subscribe=this.subscribe.bind(this),this.unsubscribe=this.unsubscribe.bind(this),this.marker=null},subscribe:function(t){if(this.components.length>=2)return t.el.removeAttribute("teleporter-controls"),console.log("player may not have more than two arms");this.components.push(t);var i=this.components.indexOf(t);t.locomoteID=i;var s=new THREE.Color(0).convertSRGBToLinear();if(this.data.marker||this.marker)!this.marker&&this.data.marker&&(this.marker=this.data.marker);else{this.marker=document.createElement("a-entity"),this.marker.setAttribute("id","teleport-marker-"+AFRAME.utils.makeId(5)),this.marker.classList.add("teleport-marker"),this.el.appendChild(this.marker);var e=new THREE.Mesh(new THREE.CylinderBufferGeometry(this.data.markerRadius,this.data.markerRadius,this.data.markerHeight,this.data.markerDivisions,1,!0),AFRAME.utils.getGradientShader("teleportDestination",s,t.yesColor));this.marker.setObject3D("mesh",e),e.updateMatrixWorld(!0),this.marker.object3DMap.mesh.position.setY(this.data.markerHeight/2)}this.components.length>1&&(this.hasTwoHands=!0),t.destObject=this.marker.object3D,t._create()},unsubscribe:function(t){let i=this.components.indexOf(t);this.components.splice(i,1),this.components.length<2&&(this.hasTwoHands=!1)},toggleOtherHand:function(t){1!=this.data.noSwap&&this.hasTwoHands&&(this.otherHandIndex=1==t.locomoteID?0:1,this.components[this.otherHandIndex]._hideTeleportUI(!0))}}),teleporter_controls:AFRAME.registerComponent("teleporter-controls",{dependencies:["position","rotation","scale"],schema:{objects:{type:"string",default:".telepad"},startOn:{type:"array",default:["ybuttondown","bbuttondown","trackpaddown"]},cancelOn:{type:"array",default:["ybuttonup","bbuttonup","trackpadup"]},moveOn:{type:"array",default:["ybuttonup","bbuttonup","trackpadup"]},toggleOn:{type:"array",default:[]},player:{type:"selector",default:"#vr-player"},camera:{type:"selector",default:"#vr-camera"},length:{type:"number",default:4},yesColor:{type:"color",default:"#8FE388"},noColor:{type:"color",default:"#E7556A"},style:{type:"string",default:"tube",oneOf:["tube","line"]},enabled:{type:"boolean",default:!0},signal:{type:"boolean",default:!0}},init:function(){this.playerTeleportDestination=new THREE.Vector3,this.playerTeleportOffset=new THREE.Vector3,this.orientDestNormalVec=new THREE.Vector3,this.orientDestQuat=new THREE.Quaternion,this.tick=AFRAME.utils.throttleTick(this.tick,24,this),this.noEulerHelper=new THREE.Euler(0,0,0),this.__startHandler=this.__startHandler.bind(this),this.__moveHandler=this.__moveHandler.bind(this),this.__cancelHandler=this.__cancelHandler.bind(this),this.__toggleHandler=this.__toggleHandler.bind(this),this.registerListeners=this.registerListeners.bind(this),this.deregisterListeners=this.deregisterListeners.bind(this),this.createTube=this.createTube.bind(this),this.refreshTube=this.refreshTube.bind(this),this.createLine=this.createLine.bind(this),this.refreshLine=this.refreshLine.bind(this),this.toggled=!1,this.onIntersection=this.onIntersection.bind(this),this.offIntersection=this.offIntersection.bind(this),this.__cancelHandler=this.__cancelHandler.bind(this),this._hideTeleportUI=this._hideTeleportUI.bind(this),this._create=this._create.bind(this),this.rayOrigin=new THREE.Vector3(0,0,0),this.rayAim=new THREE.Vector3(0,-1,-.5).normalize(),this.yesColor=new THREE.Color(this.data.yesColor).convertSRGBToLinear(),this.noColor=new THREE.Color(this.data.noColor).convertSRGBToLinear(),this.__angleSolve.bind(this),this.offsetScalar=this.__angleSolve(this.rayAim.z,this.rayAim.y,this.data.length),this.seekTeleportDestination=this.seekTeleportDestination.bind(this),this.system.subscribe(this)},update:function(t){this.registeredListeners||(this.deregisterListeners(),this.registerListeners())},registerListeners:function(){this.registeredListeners||(this.registeredListeners={startOn:null,cancelOn:null,moveOn:null,toggleOn:null}),null===this.registeredListeners.startOn&&(this.registeredListeners.startOn=[],this.data.startOn.forEach((t=>{this.registeredListeners.startOn.push(t),this.el.addEventListener(t,this.__startHandler)}),this)),null===this.registeredListeners.cancelOn&&(this.registeredListeners.cancelOn=[],this.data.cancelOn.forEach((t=>{this.registeredListeners.cancelOn.push(t),this.el.addEventListener(t,this.__cancelHandler)}),this)),null===this.registeredListeners.moveOn&&(this.registeredListeners.moveOn=[],this.data.moveOn.forEach((t=>{this.registeredListeners.moveOn.push(t),this.el.addEventListener(t,this.__moveHandler)}),this)),null===this.registeredListeners.toggleOn&&(this.registeredListeners.toggleOn=[],this.data.toggleOn.forEach((t=>{this.registeredListeners.toggleOn.push(t),this.el.addEventListener(t,this.__toggleHandler)}),this))},deregisterListeners:function(){this.registeredListeners&&(null!==this.registeredListeners.startOn&&(this.registeredListeners.startOn.forEach((t=>{this.el.removeEventListener(t,this.__startHandler)}),this),this.registeredListeners.startOn=null),null!==this.registeredListeners.moveOn&&(this.registeredListeners.moveOn.forEach((t=>{this.el.removeEventListener(t,this.__moveHandler)}),this),this.registeredListeners.moveOn=null),null!==this.registeredListeners.cancelOn&&(this.registeredListeners.cancelOn.forEach((t=>{this.el.removeEventListener(t,this.__cancelHandler)}),this),this.registeredListeners.cancelOn=null),null!==this.registeredListeners.toggleOn&&(this.registeredListeners.toggleOn.forEach((t=>{this.el.removeEventListener(t,this.__toggleHandler)}),this),this.registeredListeners.toggleOn=null))},_create:function(){var t=this.el,i=this.data,s=this;s.rayOrigin=new THREE.Vector3(0,0,0),s.rayAim=new THREE.Vector3(0,-.125,-.5).normalize(),this.beamEl=document.createElement("a-entity"),this.el.appendChild(this.beamEl),this.beamEl.setAttribute("raycaster",{origin:s.rayOrigin,direction:s.rayAim,objects:i.objects,showLine:!1,near:0,far:i.length,autoRefresh:!1}),s.raycaster=this.beamEl.components.raycaster,s.v0=new THREE.Vector3(0,0,0),s.v1=new THREE.Vector3(0,0,-1),s.v2=new THREE.Vector3(0,-1,-3),s.v3=new THREE.Vector3(0,0,0);var e=new THREE.CubicBezierCurve3(s.v0,s.v3,s.v1,s.v2);switch(i.style){case"tube":s.curveGeometry=new THREE.TubeBufferGeometry(e,24,.0075,2,!1),s.lineMaterial=new THREE.MeshBasicMaterial({color:s.noColor,transparent:!0,opacity:.6,depthTest:!0,depthWrite:!1}),s.curveObject=new THREE.Mesh(s.curveGeometry,s.lineMaterial),s.refreshCurveGeo=function(t,i,n){s.v0.copy(t),s.v3.copy(t),s.v1.copy(i),s.v2.copy(n),s.curveObject.geometry.dispose(),s.curveObject.geometry=new THREE.TubeBufferGeometry(e,24,.0075,2,!1)};break;case"line":default:s.points=e.getPoints(60),s.curveGeometry=(new THREE.BufferGeometry).setFromPoints(s.points),s.lineMaterial=new THREE.LineBasicMaterial({color:s.noColor,transparent:!0,opacity:.45,blending:THREE.AdditiveBlending}),s.curveObject=new THREE.Line(s.curveGeometry,s.lineMaterial),s.refreshCurveGeo=function(t,i,n){s.v0.copy(t),s.v1.copy(i),s.v2.copy(n),s.points=e.getPoints(60),s.curveObject.geometry.setFromPoints(s.points)}}t.setObject3D("curve",s.curveObject),t.object3DMap.curve.updateMatrixWorld(!0),AFRAME.utils.getGradientShader("teleportDestination").setValues({depthTest:!1,depthWrite:!1,opacity:.65,transparent:!0,side:THREE.DoubleSide,blending:THREE.AdditiveBlending}),s.destObject.visible=!1,s.curveObject.visible=!1,s.intersection=null,s.testEl=null,s.step=0,s.destinationPoint=new THREE.Vector3,s.midpoint=new THREE.Vector3,s.startPoint=new THREE.Vector3,s.humpOffset=new THREE.Vector3(0,.01,0)},createTube:function(){},refreshLine:function(){},createLine:function(){},refreshTube:function(t,i,s){this.v0.copy(t),this.v3.copy(t),this.v1.copy(i),this.v2.copy(s),this.curveObject.geometry.dispose(),this.curveObject.geometry=new THREE.TubeBufferGeometry(curve,24,.0075,2,!1)},__startHandler:function(){if(0!=this.data.enabled){if(this.system.toggleOtherHand(this),this.beamEl.setAttribute("raycaster",{enabled:!0}),this.raycaster.refreshObjects(),this.collisionObjects=Array.from(document.querySelectorAll(this.data.objects)),this.numObjects=this.collisionObjects.length,1==this.data.signal)for(var t=0;t<this.numObjects;t++)this.collisionObjects[t].emit("teleportready",{el:this.el},!0);this.numObjects=this.collisionObjects.length,this.isTesting=!0,this.lineMaterial.color=this.yesColor,this.lineMaterial.needsUpdate=!0,this.curveObject.visible=!0}},_hideTeleportUI:function(t){if(t&&1==t&&(this.hasDestination=null),this.isTesting=null,this.beamEl.setAttribute("raycaster",{enabled:!1}),1==this.data.signal)for(var i=0;i<this.numObjects;i++)this.collisionObjects[i].emit("teleportcancel",{el:this.el},!0);this.curveObject.visible=!1,this.destObject.visible=!1},__cancelHandler:function(t){return t&&1==t?this._hideTeleportUI(!1):this._hideTeleportUI(!AFRAME.utils.deepEqual(this.data.moveOn,this.data.cancelOn))},__moveHandler:function(){if(0!=this.data.enabled&&this.hasDestination&&(this.playerTeleportOffset.copy(this.data.camera.object3D.position),this.playerTeleportDestination.sub(this.playerTeleportOffset),this.playerTeleportDestination.setY(this.playerTeleportDestination.y+this.system.data.playerHeightOffset),this.data.player.object3D.parent.worldToLocal(this.playerTeleportDestination),this.data.player.object3D.position.copy(this.playerTeleportDestination),this.raycaster.refreshObjects(),this.seekTeleportDestination(),1==this.data.signal))for(var t=0;t<this.numObjects;t++)this.collisionObjects[t].emit("teleported",{el:this.el},!0)},__toggleHandler:function(){this.toggled=!this.toggled,1==this.toggled?(this.hasDestination=!0,this.__startHandler()):(this.hasDestination=null,this.__cancelHandler())},__angleSolve:function(t,i,s){return Number(Math.sqrt(Math.pow(s,2)/(Math.pow(t,2)+Math.pow(i,2))))},offIntersection:function(){this.hasDestination=null,this.destObject.visible=!1,this.lineMaterial.color=this.noColor,this.destinationPoint.set(0,this.rayAim.y*this.offsetScalar,Number(-1*this.data.length)),this.midpoint.lerpVectors(this.v0,this.destinationPoint,.5),this.humpOffset.setY(this.data.length/4),this.midpoint.add(this.humpOffset),this.refreshCurveGeo(this.v0,this.midpoint,this.destinationPoint)},onIntersection:function(){this.playerTeleportDestination.copy(this.intersection.point),this.hasDestination=!0,this.el.object3D.getWorldPosition(this.startPoint),this.destObject.position.copy(this.intersection.point),this.orientDestNormalVec.copy(this.intersection.face.normal),AFRAME.utils.math.setDirection(this.orientDestNormalVec,this.orientDestQuat),this.destObject.quaternion.copy(this.orientDestQuat),this.destinationPoint.copy(this.intersection.point),this.midpoint.lerpVectors(this.startPoint,this.intersection.point,.5),this.humpOffset.setY(this.intersection.distance/5),this.midpoint.add(this.humpOffset),this.refreshCurveGeo(this.v0,this.el.object3DMap.curve.worldToLocal(this.midpoint),this.el.object3DMap.curve.worldToLocal(this.destinationPoint)),this.destObject.visible=!0,this.lineMaterial.color=this.yesColor},seekTeleportDestination:function(){for(this.intersection=this.raycaster.getIntersection(this.testEl),this.step=0;this.step<this.numObjects;this.step++)this.testEl=this.collisionObjects[this.step],this.intersection=this.raycaster.getIntersection(this.testEl),this.intersection?this.onIntersection():this.offIntersection()},tick:function(){0!=this.data.enabled&&this.isTesting&&this.seekTeleportDestination()},remove:function(){this.deregisterListeners(),this.el&&this.el.object3DMap&&this.el.object3DMap.curve&&this.el.removeObject3D("curve"),this.beamEl&&(this.beamEl.removeAttribute("raycaster"),this.el.removeChild(this.beamEl),this.beamEl.dispose()),this.system.unsubscribe(this)}}),locomote:AFRAME.registerComponent("locomote",{schema:{camera:{type:"string",default:"#vr-camera"},player:{type:"selector",default:"#vr-player"}},init:function(){this.data;this.el.addEventListener("axismove",(t=>{}))}})}},8314:(t,i,s)=>{AFRAME.utils.entity.onModel=function(t,i,s){s&&(i=i.bind(s));var e=t.getObject3D("mesh"),n=function(s){s&&s.detail&&"mesh"===s.detail.type&&(i(),t.removeEventListener("object3dset",n))};e?i():t.addEventListener("object3dset",n)},AFRAME.utils.entity.onObject3DAdded=function(t,i,s,e,n){e&&(s=s.bind(e));var h=t.getObject3D(i),a=function(e){e&&e.detail&&e.detail.type===i&&(n?s(n):s(),t.removeEventListener("object3dset",a))};h?n?s(n):s():t.addEventListener("object3dset",a)},AFRAME.utils.entity.onLoad=function(t,i,s){s&&(i=i.bind(s));var e=function(){i(),t.removeEventListener("loaded",e)};t.hasLoaded?i():t.addEventListener("loaded",e,{once:!0})},AFRAME.utils.entity.onSceneLoaded=function(t,i,s){s&&(i=i.bind(s));var e=function(){t.sceneEl.hasLoaded?i():setTimeout(e,100)};t.sceneEl.hasLoaded?i():e()},AFRAME.utils.device.hasControllers=function(){if(navigator){if(console.log("has navigator!"),navigator.getGamepads){console.log("has gamepad support!");var t=navigator.getGamepads(),i=0;return t?(Object.values(t).forEach((t=>{t&&i++})),i>0||null):null}return null}return null},AFRAME.utils.randomColor=function(){for(var t="#",i=0;i<6;i++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t},AFRAME.utils.makeId=function(t){for(var i="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=s.length,n=0;n<t;n++)i+=s.charAt(Math.floor(Math.random()*e));return i},AFRAME.utils.__helper__pool={__setDirection:{__axis:new THREE.Vector3,__quaternion:new THREE.Quaternion}},AFRAME.utils.math={normalize:function(t,i,s){return(t-s)/(i-s)},setDirection:function(t,i){if(i=i||AFRAME.utils.__helper__pool.__setDirection.__quaternion,t.y>.99999)i.set(0,0,0,1);else if(t.y<-.99999)i.set(1,0,0,0);else{AFRAME.utils.__helper__pool.__setDirection.__axis.set(t.z,0,-t.x).normalize();var s=Math.acos(t.y);i.setFromAxisAngle(AFRAME.utils.__helper__pool.__setDirection.__axis,s)}return i},vectorRadToDeg:function(t){return t.set(THREE.Math.radToDeg(t.x),THREE.Math.radToDeg(t.y),THREE.Math.radToDeg(t.z)),t},vectorRadToDegCopy:function(t){return t.x=THREE.Math.radToDeg(t.x),t.y=THREE.Math.radToDeg(t.y),t.z=THREE.Math.radToDeg(t.z),t},vectorDegToRad:function(t){return t.set(THREE.Math.degToRad(t.x),THREE.Math.degToRad(t.y),THREE.Math.degToRad(t.z)),t}},AFRAME.utils.getWhiteEnvironment=function(){if(!AFRAME.utils.whiteEnvironment){var t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAMAAABFaP0WAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRF/v7+////G/xoHAAAABBJREFUeNpiYGRkYGQECDAAABIABaUzXMUAAAAASUVORK5CYII=";AFRAME.utils.whiteEnvironment=(new THREE.CubeTextureLoader).load([t,t,t,t,t,t])}return AFRAME.utils.whiteEnvironment},AFRAME.utils.shaders={},AFRAME.utils.getGradientShader=function(t,i,s){var e,n;AFRAME.utils.shaders[t]||(e=i&&!i.isColor?new THREE.Color(i):(new THREE.Color).copy(i),n=s&&!s.isColor?new THREE.Color(s):(new THREE.Color).copy(s),AFRAME.utils.shaders[t]=new THREE.RawShaderMaterial({fragmentShader:"precision mediump float;\n\nvarying vec2 vUv;\n\nuniform vec3 color1;\nuniform vec3 color2;\n\nvoid main( void ) {\n    vec3 mixCol = mix( color2, color1, vUv.y );\n\tgl_FragColor = vec4(mixCol, 1.);\n}",vertexShader:"precision highp float;\r\nprecision highp int;\r\n\r\nuniform mat4 modelMatrix;\r\nuniform mat4 modelViewMatrix;\r\nuniform mat4 projectionMatrix;\r\nuniform mat4 viewMatrix;\r\nuniform mat3 normalMatrix;\r\n\r\nattribute vec3 position;\r\nattribute vec3 normal;\r\nattribute vec2 uv;\r\nattribute vec2 uv2;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n  vUv = uv;\r\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n}",uniforms:{color1:{type:"c",glslType:"vec3",value:{r:e.r,g:e.g,b:e.b},description:"",textureId:null,runtime:{texture:null}},color2:{type:"c",glslType:"vec3",value:{r:n.r,g:n.g,b:n.b},description:"",textureId:null,runtime:{texture:null}}}}));return AFRAME.utils.shaders[t]},AFRAME.registerComponent("log-object3d",{init:function(){AFRAME.utils.entity.onModel(this.el,this.log,this)},log:function(){console.log(this.el.object3D)}}),AFRAME.utils.axishelper=function(){var t=new THREE.Vector3(0,0,0),i=new THREE.Group,s=new THREE.Geometry,e=new THREE.Geometry,n=new THREE.Geometry;s.vertices.push(t,new THREE.Vector3(0,1,0)),e.vertices.push(t,new THREE.Vector3(1,0,0)),n.vertices.push(t,new THREE.Vector3(0,0,1));var h=new THREE.Line(s,new THREE.LineBasicMaterial({color:"green"})),a=new THREE.Line(e,new THREE.LineBasicMaterial({color:"red"})),o=new THREE.Line(n,new THREE.LineBasicMaterial({color:"blue"}));return i.add(h),i.add(a),i.add(o),i},AFRAME.utils.bindAll=s(9872)},1804:(t,i,s)=>{var e=s(5618),n=s(7205),h=s(7191),a=s(5516),o=s(9981);(t.exports=function(t,i){var s,n,r,l,u;return arguments.length<2||"string"!=typeof t?(l=i,i=t,t=null):l=arguments[2],e(t)?(s=o.call(t,"c"),n=o.call(t,"e"),r=o.call(t,"w")):(s=r=!0,n=!1),u={value:i,configurable:s,enumerable:n,writable:r},l?h(a(l),u):u}).gs=function(t,i,s){var r,l,u,c;return"string"!=typeof t?(u=s,s=i,i=t,t=null):u=arguments[3],e(i)?n(i)?e(s)?n(s)||(u=s,s=void 0):s=void 0:(u=i,i=s=void 0):i=void 0,e(t)?(r=o.call(t,"c"),l=o.call(t,"e")):(r=!0,l=!1),c={get:i,set:s,configurable:r,enumerable:l},u?h(a(u),c):c}},4616:(t,i,s)=>{t.exports=s(7379)()?Array.from:s(2669)},7379:t=>{t.exports=function(){var t,i,s=Array.from;return"function"==typeof s&&(i=s(t=["raz","dwa"]),Boolean(i&&i!==t&&"dwa"===i[1]))}},2669:(t,i,s)=>{var e=s(8641).iterator,n=s(6766),h=s(1216),a=s(3902),o=s(1290),r=s(2745),l=s(6914),u=s(4349),c=Array.isArray,p=Function.prototype.call,d={configurable:!0,enumerable:!0,writable:!0,value:null},m=Object.defineProperty;t.exports=function(t){var i,s,y,f,b,x,v,D,g,E,A=arguments[1],C=arguments[2];if(t=Object(r(t)),l(A)&&o(A),this&&this!==Array&&h(this))i=this;else{if(!A){if(n(t))return 1!==(b=t.length)?Array.apply(null,t):((f=new Array(1))[0]=t[0],f);if(c(t)){for(f=new Array(b=t.length),s=0;s<b;++s)f[s]=t[s];return f}}f=[]}if(!c(t))if(void 0!==(g=t[e])){for(v=o(g).call(t),i&&(f=new i),D=v.next(),s=0;!D.done;)E=A?p.call(A,C,D.value,s):D.value,i?(d.value=E,m(f,s,d)):f[s]=E,D=v.next(),++s;b=s}else if(u(t)){for(b=t.length,i&&(f=new i),s=0,y=0;s<b;++s)E=t[s],s+1<b&&(x=E.charCodeAt(0))>=55296&&x<=56319&&(E+=t[++s]),E=A?p.call(A,C,E,y):E,i?(d.value=E,m(f,y,d)):f[y]=E,++y;b=y}if(void 0===b)for(b=a(t.length),i&&(f=new i(b)),s=0;s<b;++s)E=A?p.call(A,C,t[s],s):t[s],i?(d.value=E,m(f,s,d)):f[s]=E;return i&&(d.value=null,f.length=b),f}},6766:t=>{var i=Object.prototype.toString,s=i.call(function(){return arguments}());t.exports=function(t){return i.call(t)===s}},1216:t=>{var i=Object.prototype.toString,s=RegExp.prototype.test.bind(/^[object [A-Za-z0-9]*Function]$/);t.exports=function(t){return"function"==typeof t&&s(i.call(t))}},430:t=>{t.exports=function(){}},5875:(t,i,s)=>{t.exports=s(5448)()?Math.sign:s(4592)},5448:t=>{t.exports=function(){var t=Math.sign;return"function"==typeof t&&(1===t(10)&&-1===t(-20))}},4592:t=>{t.exports=function(t){return t=Number(t),isNaN(t)||0===t?t:t>0?1:-1}},3478:(t,i,s)=>{var e=s(5875),n=Math.abs,h=Math.floor;t.exports=function(t){return isNaN(t)?0:0!==(t=Number(t))&&isFinite(t)?e(t)*h(n(t)):t}},3902:(t,i,s)=>{var e=s(3478),n=Math.max;t.exports=function(t){return n(0,e(t))}},7191:(t,i,s)=>{t.exports=s(6560)()?Object.assign:s(7346)},6560:t=>{t.exports=function(){var t,i=Object.assign;return"function"==typeof i&&(i(t={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")}},7346:(t,i,s)=>{var e=s(5103),n=s(2745),h=Math.max;t.exports=function(t,i){var s,a,o,r=h(arguments.length,2);for(t=Object(n(t)),o=function(e){try{t[e]=i[e]}catch(t){s||(s=t)}},a=1;a<r;++a)e(i=arguments[a]).forEach(o);if(void 0!==s)throw s;return t}},6914:(t,i,s)=>{var e=s(430)();t.exports=function(t){return t!==e&&null!==t}},5103:(t,i,s)=>{t.exports=s(7446)()?Object.keys:s(6137)},7446:t=>{t.exports=function(){try{return Object.keys("primitive"),!0}catch(t){return!1}}},6137:(t,i,s)=>{var e=s(6914),n=Object.keys;t.exports=function(t){return n(e(t)?Object(t):t)}},5516:(t,i,s)=>{var e=s(6914),n=Array.prototype.forEach,h=Object.create,a=function(t,i){var s;for(s in t)i[s]=t[s]};t.exports=function(t){var i=h(null);return n.call(arguments,(function(t){e(t)&&a(Object(t),i)})),i}},9474:t=>{var i=Array.prototype.forEach,s=Object.create;t.exports=function(t){var e=s(null);return i.call(arguments,(function(t){e[t]=!0})),e}},1290:t=>{t.exports=function(t){if("function"!=typeof t)throw new TypeError(t+" is not a function");return t}},2745:(t,i,s)=>{var e=s(6914);t.exports=function(t){if(!e(t))throw new TypeError("Cannot use null or undefined");return t}},9981:(t,i,s)=>{t.exports=s(3591)()?String.prototype.contains:s(6042)},3591:t=>{var i="razdwatrzy";t.exports=function(){return"function"==typeof i.contains&&(!0===i.contains("dwa")&&!1===i.contains("foo"))}},6042:t=>{var i=String.prototype.indexOf;t.exports=function(t){return i.call(this,t,arguments[1])>-1}},4349:t=>{var i=Object.prototype.toString,s=i.call("");t.exports=function(t){return"string"==typeof t||t&&"object"==typeof t&&(t instanceof String||i.call(t)===s)||!1}},8641:(t,i,s)=>{t.exports=s(8821)()?s(7933).Symbol:s(5127)},8821:(t,i,s)=>{var e=s(7933),n={object:!0,symbol:!0};t.exports=function(){var t,i=e.Symbol;if("function"!=typeof i)return!1;t=i("test symbol");try{String(t)}catch(t){return!1}return!!n[typeof i.iterator]&&(!!n[typeof i.toPrimitive]&&!!n[typeof i.toStringTag])}},5386:t=>{t.exports=function(t){return!!t&&("symbol"==typeof t||!!t.constructor&&("Symbol"===t.constructor.name&&"Symbol"===t[t.constructor.toStringTag]))}},7451:(t,i,s)=>{var e=s(1804),n=Object.create,h=Object.defineProperty,a=Object.prototype,o=n(null);t.exports=function(t){for(var i,s,n=0;o[t+(n||"")];)++n;return o[t+=n||""]=!0,h(a,i="@@"+t,e.gs(null,(function(t){s||(s=!0,h(this,i,e(t)),s=!1)}))),i}},7628:(t,i,s)=>{var e=s(1804),n=s(7933).Symbol;t.exports=function(t){return Object.defineProperties(t,{hasInstance:e("",n&&n.hasInstance||t("hasInstance")),isConcatSpreadable:e("",n&&n.isConcatSpreadable||t("isConcatSpreadable")),iterator:e("",n&&n.iterator||t("iterator")),match:e("",n&&n.match||t("match")),replace:e("",n&&n.replace||t("replace")),search:e("",n&&n.search||t("search")),species:e("",n&&n.species||t("species")),split:e("",n&&n.split||t("split")),toPrimitive:e("",n&&n.toPrimitive||t("toPrimitive")),toStringTag:e("",n&&n.toStringTag||t("toStringTag")),unscopables:e("",n&&n.unscopables||t("unscopables"))})}},277:(t,i,s)=>{var e=s(1804),n=s(8541),h=Object.create(null);t.exports=function(t){return Object.defineProperties(t,{for:e((function(i){return h[i]?h[i]:h[i]=t(String(i))})),keyFor:e((function(t){var i;for(i in n(t),h)if(h[i]===t)return i}))})}},5127:(t,i,s)=>{var e,n,h,a=s(1804),o=s(8541),r=s(7933).Symbol,l=s(7451),u=s(7628),c=s(277),p=Object.create,d=Object.defineProperties,m=Object.defineProperty;if("function"==typeof r)try{String(r()),h=!0}catch(t){}else r=null;n=function(t){if(this instanceof n)throw new TypeError("Symbol is not a constructor");return e(t)},t.exports=e=function t(i){var s;if(this instanceof t)throw new TypeError("Symbol is not a constructor");return h?r(i):(s=p(n.prototype),i=void 0===i?"":String(i),d(s,{__description__:a("",i),__name__:a("",l(i))}))},u(e),c(e),d(n.prototype,{constructor:a(e),toString:a("",(function(){return this.__name__}))}),d(e.prototype,{toString:a((function(){return"Symbol ("+o(this).__description__+")"})),valueOf:a((function(){return o(this)}))}),m(e.prototype,e.toPrimitive,a("",(function(){var t=o(this);return"symbol"==typeof t?t:t.toString()}))),m(e.prototype,e.toStringTag,a("c","Symbol")),m(n.prototype,e.toStringTag,a("c",e.prototype[e.toStringTag])),m(n.prototype,e.toPrimitive,a("c",e.prototype[e.toPrimitive]))},8541:(t,i,s)=>{var e=s(5386);t.exports=function(t){if(!e(t))throw new TypeError(t+" is not a symbol");return t}},342:(t,i,s)=>{var e,n,h,a,o,r,l,u,c,p,d=s(7994);o=function(t){return"\\"===t?r:"$"===t?l:(n+=t,o)},r=function(t){return"\\"!==t&&"$"!==t&&(n+="\\"),n+=t,o},l=function(t){return"{"===t?(h.push(n),n="",u):"$"===t?(n+="$",l):(n+="$"+t,o)},u=function(t){var i,s=p.slice(e);return d(s,"}",(function(t){if(d.nest>=0)return d.next();i=t})),null!=i?(a.push(p.slice(e,e+i)),e+=i,n="",o):(i=s.length,e+=i,n+=s,u)},c=function(t){return"\\"!==t&&"}"!==t&&(n+="\\"),n+=t,u},t.exports=function(t){var i,s,d;for(n="",h=[],a=[],i=(p=String(t)).length,s=o,e=0;e<i;++e)s=s(p[e]);return s===o?h.push(n):s===r?h.push(n+"\\"):s===l?h.push(n+"$"):s===u?h[h.length-1]+="${"+n:s===c&&(h[h.length-1]+="${"+n+"\\"),d={literals:h,substitutions:a},h=a=null,d}},3570:(t,i,s)=>{var e=s(342),n=s(7146);t.exports=function(t,i){return n(e(t),i,arguments[2])}},5730:t=>{var i=Array.prototype.reduce;t.exports=function(t){var s=arguments;return i.call(t,(function(t,i,e){return t+(void 0===s[e]?"":String(s[e]))+i}))}},7146:(t,i,s)=>{var e=s(1258),n=s(5730);t.exports=function(t,i){return n.apply(null,e(t,i,arguments[2]))}},1258:(t,i,s)=>{var e=s(2745),n=s(5516),h=s(3422),a=Array.prototype.map,o=Object.keys,r=JSON.stringify;t.exports=function(t,i){var s,l,u,c=Object(arguments[2]);return e(t)&&e(t.literals)&&e(t.substitutions),i=n(i),s=o(i).filter(h),l=s.join(", "),u=s.map((function(t){return i[t]})),[t.literals].concat(a.call(t.substitutions,(function(t){var i;if(t){try{i=new Function(l,"return ("+t+")")}catch(i){throw new TypeError("Unable to compile expression:\n\targs: "+r(l)+"\n\tbody: "+r(t)+"\n\terror: "+i.stack)}try{return i.apply(null,u)}catch(i){if(c.partial)return"${"+t+"}";throw new TypeError("Unable to resolve expression:\n\targs: "+r(l)+"\n\tbody: "+r(t)+"\n\terror: "+i.stack)}}})))}},7994:(t,i,s)=>{var e,n,h,a,o,r,l,u,c,p,d,m,y,f,b,x,v,D,g,E,A,C,F,z,w,N,M,B=s(4616),k=s(9474),S=s(2745),T=s(1290),L=s(1804),P=s(262),I=s(2726),V=Object.prototype.hasOwnProperty,R=k.apply(null,B(";{=([,<>+-*/%&|^!~?:}")),_=k.apply(null,B(";{=([,<>+-*/%&|^!~?:})]."));e=function(t){if(m&&!(d>=t))for(;d!==t;){if(!m)return;V.call(I,m)?V.call(P,m)&&(f=d,++y):x=m,m=E[++d]}},n=function(t){null!=w&&D.push([N,w,t]),N={point:d+1,line:y,column:d+1-f},w=d},h=function(){var t;if(N.raw=E.slice(w,d),g.push(N),D.length)return t=D.pop(),N=t[0],w=t[1],void(M=t[2]);N=null,w=null,M=null},a=function(){var t=M;return M=v,++v,e(d+1),n(t),o},r=function(){if("'"===m||'"'===m)return z=m,m=E[++d],l;if("("===m||"{"===m||"["===m)++v;else if(")"===m||"}"===m||"]"===m)M===--v&&h();else if("/"===m&&V.call(R,x))return m=E[++d],p;return m!==A||!C&&x&&!b&&!V.call(_,x)?(x=m,m=E[++d],o):F(d,x,v)},u=function(){for(;;){if(!m)return;if(V.call(P,m))return f=d+1,void++y;m=E[++d]}},c=function(){for(;;){if(!m)return;if("*"!==m)V.call(P,m)&&(f=d+1,++y),m=E[++d];else if("/"===(m=E[++d]))return}},o=function(){var t;for(b=!1;;){if(!m)return;if(V.call(I,m))b=!0,V.call(P,m)&&(f=d+1,++y);else{if("/"!==m)break;if("/"===(t=E[d+1]))m=E[d+=2],b=!0,u();else{if("*"!==t)break;m=E[d+=2],b=!0,c()}}m=E[++d]}return r},l=function(){for(;;){if(!m)return;if(m===z)return m=E[++d],x=z,o;"\\"===m&&V.call(P,E[++d])&&(f=d+1,++y),m=E[++d]}},p=function(){for(;;){if(!m)return;if("/"===m)return x="/",m=E[++d],o;"\\"===m&&++d,m=E[++d]}},t.exports=i=function(t,s,e){var n;if(E=String(S(t)),1!==(A=String(S(s))).length)throw new TypeError(A+" should be one character long string");for(F=T(e),C=V.call(_,A),m=E[d=0],y=1,f=0,b=!1,x=null,v=0,D=[],g=[],i.forceStop=!1,n=o;n;)n=n();return g},Object.defineProperties(i,{$ws:L(o),$common:L(r),collectNest:L(a),move:L(e),index:L.gs((function(){return d})),line:L.gs((function(){return y})),nest:L.gs((function(){return v})),columnIndex:L.gs((function(){return f})),next:L((function(t){if(m)return e(d+(t||1)),o()})),resume:L((function(){return r}))})},3422:t=>{t.exports=RegExp.prototype.test.bind(/^(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|null|this|true|void|with|await|break|catch|class|const|false|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)(?:[\$A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D])(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF])*$/)},262:(t,i,s)=>{var e=s(4616),n=s(9474);t.exports=n.apply(null,e("\n\r\u2028\u2029"))},1858:(t,i,s)=>{var e=s(4616),n=s(9474);t.exports=n.apply(null,e(" \f\t\v​  ​᠎ ​  ​  ​  ​  ​  ​​​  ​　"))},2726:(t,i,s)=>{var e=s(9474),n=s(262),h=s(1858);t.exports=e.apply(null,Object.keys(n).concat(Object.keys(h)))},7145:t=>{var i=function(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw new Error("Unable to resolve global `this`")};t.exports=function(){if(this)return this;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(t){return i()}try{return __global__||i()}finally{delete Object.prototype.__global__}}()},7933:(t,i,s)=>{t.exports=s(6344)()?globalThis:s(7145)},6344:t=>{t.exports=function(){return"object"==typeof globalThis&&(!!globalThis&&globalThis.Array===Array)}},7786:(t,i,s)=>{s.r(i),s.d(i,{default:()=>e});const e=s.p+"hand_left.glb"},5218:(t,i,s)=>{s.r(i),s.d(i,{default:()=>e});const e=s.p+"hand_right.glb"},9872:(t,i,s)=>{var e="__lodash_placeholder__",n=32,h=1/0,a=9007199254740991,o=NaN,r=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",n],["partialRight",64],["rearg",256]],l="[object Arguments]",u=/^\s+|\s+$/g,c=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,p=/\{\n\/\* \[wrapped with (.+)\] \*/,d=/,? & /,m=/^[-+]0x[0-9a-f]+$/i,y=/^0b[01]+$/i,f=/^\[object .+?Constructor\]$/,b=/^0o[0-7]+$/i,x=/^(?:0|[1-9]\d*)$/,v=parseInt,D="object"==typeof s.g&&s.g&&s.g.Object===Object&&s.g,g="object"==typeof self&&self&&self.Object===Object&&self,E=D||g||Function("return this")();function A(t,i,s){switch(s.length){case 0:return t.call(i);case 1:return t.call(i,s[0]);case 2:return t.call(i,s[0],s[1]);case 3:return t.call(i,s[0],s[1],s[2])}return t.apply(i,s)}function C(t,i){for(var s=-1,e=t?t.length:0;++s<e&&!1!==i(t[s],s,t););return t}function F(t,i){return!!(t?t.length:0)&&function(t,i,s){if(i!=i)return function(t,i,s,e){var n=t.length,h=s+(e?1:-1);for(;e?h--:++h<n;)if(i(t[h],h,t))return h;return-1}(t,w,s);var e=s-1,n=t.length;for(;++e<n;)if(t[e]===i)return e;return-1}(t,i,0)>-1}function z(t,i){for(var s=-1,e=i.length,n=t.length;++s<e;)t[n+s]=i[s];return t}function w(t){return t!=t}function N(t,i){for(var s=t.length,e=0;s--;)t[s]===i&&e++;return e}function M(t,i){for(var s=-1,n=t.length,h=0,a=[];++s<n;){var o=t[s];o!==i&&o!==e||(t[s]=e,a[h++]=s)}return a}var B,k,S,T=Function.prototype,L=Object.prototype,P=E["__core-js_shared__"],I=(B=/[^.]+$/.exec(P&&P.keys&&P.keys.IE_PROTO||""))?"Symbol(src)_1."+B:"",V=T.toString,R=L.hasOwnProperty,_=L.toString,O=RegExp("^"+V.call(R).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),j=E.Symbol,H=Object.create,U=L.propertyIsEnumerable,q=j?j.isConcatSpreadable:void 0,Q=Math.max,W=Math.min,G=(k=ht(Object,"defineProperty"),(S=ht.name)&&S.length>2?k:void 0);function Y(t){return ft(t)?H(t):{}}function X(t,i,s,e,n){var h=-1,a=t.length;for(s||(s=rt),n||(n=[]);++h<a;){var o=t[h];i>0&&s(o)?i>1?X(o,i-1,s,e,n):z(n,o):e||(n[n.length]=o)}return n}function J(t){return!(!ft(t)||function(t){return!!I&&I in t}(t))&&(yt(t)||function(t){var i=!1;if(null!=t&&"function"!=typeof t.toString)try{i=!!(t+"")}catch(t){}return i}(t)?O:f).test(function(t){if(null!=t){try{return V.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t))}function K(t,i){return i=Q(void 0===i?t.length-1:i,0),function(){for(var s=arguments,e=-1,n=Q(s.length-i,0),h=Array(n);++e<n;)h[e]=s[i+e];e=-1;for(var a=Array(i+1);++e<i;)a[e]=s[e];return a[i]=h,A(t,this,a)}}function $(t,i,s,e){for(var n=-1,h=t.length,a=s.length,o=-1,r=i.length,l=Q(h-a,0),u=Array(r+l),c=!e;++o<r;)u[o]=i[o];for(;++n<a;)(c||n<h)&&(u[s[n]]=t[n]);for(;l--;)u[o++]=t[n++];return u}function Z(t,i,s,e){for(var n=-1,h=t.length,a=-1,o=s.length,r=-1,l=i.length,u=Q(h-o,0),c=Array(u+l),p=!e;++n<u;)c[n]=t[n];for(var d=n;++r<l;)c[d+r]=i[r];for(;++a<o;)(p||n<h)&&(c[d+s[a]]=t[n++]);return c}function tt(t){return function(){var i=arguments;switch(i.length){case 0:return new t;case 1:return new t(i[0]);case 2:return new t(i[0],i[1]);case 3:return new t(i[0],i[1],i[2]);case 4:return new t(i[0],i[1],i[2],i[3]);case 5:return new t(i[0],i[1],i[2],i[3],i[4]);case 6:return new t(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new t(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var s=Y(t.prototype),e=t.apply(s,i);return ft(e)?e:s}}function it(t,i,s,e,n,h,a,o,r,l){var u=128&i,c=1&i,p=2&i,d=24&i,m=512&i,y=p?void 0:tt(t);return function f(){for(var b=arguments.length,x=Array(b),v=b;v--;)x[v]=arguments[v];if(d)var D=nt(f),g=N(x,D);if(e&&(x=$(x,e,n,d)),h&&(x=Z(x,h,a,d)),b-=g,d&&b<l){var A=M(x,D);return st(t,i,it,f.placeholder,s,x,A,o,r,l-b)}var C=c?s:this,F=p?C[t]:t;return b=x.length,o?x=ut(x,o):m&&b>1&&x.reverse(),u&&r<b&&(x.length=r),this&&this!==E&&this instanceof f&&(F=y||tt(F)),F.apply(C,x)}}function st(t,i,s,e,h,a,o,r,l,u){var c=8&i;i|=c?n:64,4&(i&=~(c?64:n))||(i&=-4);var p=s(t,i,h,c?a:void 0,c?o:void 0,c?void 0:a,c?void 0:o,r,l,u);return p.placeholder=e,ct(p,t,i)}function et(t,i,s,e,h,a,o,r){var l=2&i;if(!l&&"function"!=typeof t)throw new TypeError("Expected a function");var u=e?e.length:0;if(u||(i&=-97,e=h=void 0),o=void 0===o?o:Q(Dt(o),0),r=void 0===r?r:Dt(r),u-=h?h.length:0,64&i){var c=e,p=h;e=h=void 0}var d=[t,i,s,e,h,c,p,a,o,r];if(t=d[0],i=d[1],s=d[2],e=d[3],h=d[4],!(r=d[9]=null==d[9]?l?0:t.length:Q(d[9]-u,0))&&24&i&&(i&=-25),i&&1!=i)m=8==i||16==i?function(t,i,s){var e=tt(t);return function n(){for(var h=arguments.length,a=Array(h),o=h,r=nt(n);o--;)a[o]=arguments[o];var l=h<3&&a[0]!==r&&a[h-1]!==r?[]:M(a,r);return(h-=l.length)<s?st(t,i,it,n.placeholder,void 0,a,l,void 0,void 0,s-h):A(this&&this!==E&&this instanceof n?e:t,this,a)}}(t,i,r):i!=n&&33!=i||h.length?it.apply(void 0,d):function(t,i,s,e){var n=1&i,h=tt(t);return function i(){for(var a=-1,o=arguments.length,r=-1,l=e.length,u=Array(l+o),c=this&&this!==E&&this instanceof i?h:t;++r<l;)u[r]=e[r];for(;o--;)u[r++]=arguments[++a];return A(c,n?s:this,u)}}(t,i,s,e);else var m=function(t,i,s){var e=1&i,n=tt(t);return function i(){return(this&&this!==E&&this instanceof i?n:t).apply(e?s:this,arguments)}}(t,i,s);return ct(m,t,i)}function nt(t){return t.placeholder}function ht(t,i){var s=function(t,i){return null==t?void 0:t[i]}(t,i);return J(s)?s:void 0}function at(t){var i=t.match(p);return i?i[1].split(d):[]}function ot(t,i){var s=i.length,e=s-1;return i[e]=(s>1?"& ":"")+i[e],i=i.join(s>2?", ":" "),t.replace(c,"{\n/* [wrapped with "+i+"] */\n")}function rt(t){return mt(t)||function(t){return function(t){return bt(t)&&function(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=a}(t.length)&&!yt(t)}(t)}(t)&&R.call(t,"callee")&&(!U.call(t,"callee")||_.call(t)==l)}(t)||!!(q&&t&&t[q])}function lt(t,i){return!!(i=null==i?a:i)&&("number"==typeof t||x.test(t))&&t>-1&&t%1==0&&t<i}function ut(t,i){for(var s=t.length,e=W(i.length,s),n=function(t,i){var s=-1,e=t.length;for(i||(i=Array(e));++s<e;)i[s]=t[s];return i}(t);e--;){var h=i[e];t[e]=lt(h,s)?n[h]:void 0}return t}var ct=G?function(t,i,s){var e,n=i+"";return G(t,"toString",{configurable:!0,enumerable:!1,value:(e=ot(n,pt(at(n),s)),function(){return e})})}:function(t){return t};function pt(t,i){return C(r,(function(s){var e="_."+s[0];i&s[1]&&!F(t,e)&&t.push(e)})),t.sort()}var dt=K((function(t,i,s){var e=1;if(s.length){var h=M(s,nt(dt));e|=n}return et(t,e,i,s,h)}));var mt=Array.isArray;function yt(t){var i=ft(t)?_.call(t):"";return"[object Function]"==i||"[object GeneratorFunction]"==i}function ft(t){var i=typeof t;return!!t&&("object"==i||"function"==i)}function bt(t){return!!t&&"object"==typeof t}function xt(t){return"symbol"==typeof t||bt(t)&&"[object Symbol]"==_.call(t)}function vt(t){return t?(t=function(t){if("number"==typeof t)return t;if(xt(t))return o;if(ft(t)){var i="function"==typeof t.valueOf?t.valueOf():t;t=ft(i)?i+"":i}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(u,"");var s=y.test(t);return s||b.test(t)?v(t.slice(2),s?2:8):m.test(t)?o:+t}(t))===h||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function Dt(t){var i=vt(t),s=i%1;return i==i?s?i-s:i:0}var gt=K((function(t,i){return C(X(i,1),(function(i){i=function(t){if("string"==typeof t||xt(t))return t;var i=t+"";return"0"==i&&1/t==-1/0?"-0":i}(i),t[i]=dt(t[i],t)})),t}));dt.placeholder={},t.exports=gt},372:(t,i,s)=>{var e=s(6060);t.exports=function(t){if("function"!=typeof t)return!1;if(!hasOwnProperty.call(t,"length"))return!1;try{if("number"!=typeof t.length)return!1;if("function"!=typeof t.call)return!1;if("function"!=typeof t.apply)return!1}catch(t){return!1}return!e(t)}},3940:(t,i,s)=>{var e=s(5618),n={object:!0,function:!0,undefined:!0};t.exports=function(t){return!!e(t)&&hasOwnProperty.call(n,typeof t)}},7205:(t,i,s)=>{var e=s(372),n=/^\s*class[\s{/}]/,h=Function.prototype.toString;t.exports=function(t){return!!e(t)&&!n.test(h.call(t))}},6060:(t,i,s)=>{var e=s(3940);t.exports=function(t){if(!e(t))return!1;try{return!!t.constructor&&t.constructor.prototype===t}catch(t){return!1}}},5618:t=>{t.exports=function(t){return null!=t}},7622:(t,i,s)=>{s.r(i),s.d(i,{default:()=>h});var e=s(477),n=s.n(e);function h(){return n()('/*! For license information please see superquest-physics-lite.worker.min.js.LICENSE.txt */\n(()=>{var t={480:(t,s,h)=>{h.r(s),h.d(s,{Math:()=>O,Vec3:()=>C,Quat:()=>E,Mat33:()=>B,Shape:()=>U,Box:()=>R,Sphere:()=>_,Cylinder:()=>J,Plane:()=>W,Particle:()=>H,ShapeConfig:()=>Y,LimitMotor:()=>Q,HingeJoint:()=>tt,BallAndSocketJoint:()=>it,DistanceJoint:()=>ht,PrismaticJoint:()=>ot,SliderJoint:()=>nt,WheelJoint:()=>rt,JointConfig:()=>lt,RigidBody:()=>bt,World:()=>Rt,REVISION:()=>r,BR_NULL:()=>l,BR_BRUTE_FORCE:()=>c,BR_SWEEP_AND_PRUNE:()=>m,BR_BOUNDING_VOLUME_TREE:()=>p,BODY_NULL:()=>u,BODY_DYNAMIC:()=>y,BODY_STATIC:()=>x,BODY_KINEMATIC:()=>d,BODY_GHOST:()=>f,SHAPE_NULL:()=>b,SHAPE_SPHERE:()=>v,SHAPE_BOX:()=>z,SHAPE_CYLINDER:()=>N,SHAPE_PLANE:()=>k,SHAPE_PARTICLE:()=>w,SHAPE_TETRA:()=>g,JOINT_NULL:()=>M,JOINT_DISTANCE:()=>I,JOINT_BALL_AND_SOCKET:()=>V,JOINT_HINGE:()=>S,JOINT_WHEEL:()=>L,JOINT_SLIDER:()=>P,JOINT_PRISMATIC:()=>T,AABB_PROX:()=>A,printError:()=>j,InfoDisplay:()=>D}),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\\s*function\\s*([^\\(\\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),s=1;s<arguments.length;s++){var h=arguments[s];if(null!=h)for(var e in h)Object.prototype.hasOwnProperty.call(h,e)&&(i[e]=h[e])}return i});var e,a,o,n,r="1.0.9",l=0,c=1,m=2,p=3,u=0,y=1,x=2,d=3,f=4,b=0,v=1,z=2,N=3,k=4,w=5,g=6,M=0,I=1,V=2,S=3,L=4,P=5,T=6,A=.005,O={sqrt:Math.sqrt,abs:Math.abs,floor:Math.floor,cos:Math.cos,sin:Math.sin,acos:Math.acos,asin:Math.asin,atan2:Math.atan2,round:Math.round,pow:Math.pow,max:Math.max,min:Math.min,random:Math.random,degtorad:.017453292519943295,radtodeg:57.29577951308232,PI:3.141592653589793,TwoPI:6.283185307179586,PI90:1.570796326794896,PI270:4.712388980384689,INF:1/0,EPZ:1e-5,EPZ2:1e-6,lerp:function(t,i,s){return(1-s)*t+s*i},randInt:function(t,i){return t+O.floor(O.random()*(i-t+1))},rand:function(t,i){return t+O.random()*(i-t)},generateUUID:(a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),o=new Array(36),n=0,function(){for(var t=0;t<36;t++)8===t||13===t||18===t||23===t?o[t]="-":14===t?o[t]="4":(n<=2&&(n=33554432+16777216*Math.random()|0),e=15&n,n>>=4,o[t]=a[19===t?3&e|8:e]);return o.join("")}),int:function(t){return O.floor(t)},fix:function(t,i){return t.toFixed(i||3,10)},clamp:function(t,i,s){return O.max(i,O.min(s,t))},distance:function(t,i){var s=i[0]-t[0],h=i[1]-t[1],e=i[2]-t[2];return O.sqrt(s*s+h*h+e*e)},acosClamp:function(t){return t>1?0:t<-1?O.PI:O.acos(t)},distanceVector:function(t,i){var s=t.x-i.x,h=t.y-i.y,e=t.z-i.z;return s*s+h*h+e*e},dotVectors:function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z}};function j(t,i){console.error("[OIMO] "+t+": "+i)}function D(t){this.parent=t,this.infos=new Float32Array(13),this.f=[0,0,0],this.times=[0,0,0,0],this.broadPhase=this.parent.broadPhaseType,this.version=r,this.fps=0,this.tt=0,this.broadPhaseTime=0,this.narrowPhaseTime=0,this.solvingTime=0,this.totalTime=0,this.updateTime=0,this.MaxBroadPhaseTime=0,this.MaxNarrowPhaseTime=0,this.MaxSolvingTime=0,this.MaxTotalTime=0,this.MaxUpdateTime=0}function C(t,i,s){this.x=t||0,this.y=i||0,this.z=s||0}function E(t,i,s,h){this.x=t||0,this.y=i||0,this.z=s||0,this.w=void 0!==h?h:1}function B(t,i,s,h,e,a,o,n,r){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("OIMO.Mat33: the constructor no longer reads arguments. use .set() instead.")}function F(t,i,s,h,e,a){this.elements=new Float32Array(6);var o=this.elements;o[0]=t||0,o[1]=s||0,o[2]=e||0,o[3]=i||0,o[4]=h||0,o[5]=a||0}Object.assign(D.prototype,{setTime:function(t){this.times[t||0]=performance.now()},resetMax:function(){this.MaxBroadPhaseTime=0,this.MaxNarrowPhaseTime=0,this.MaxSolvingTime=0,this.MaxTotalTime=0,this.MaxUpdateTime=0},calcBroadPhase:function(){this.setTime(2),this.broadPhaseTime=this.times[2]-this.times[1]},calcNarrowPhase:function(){this.setTime(3),this.narrowPhaseTime=this.times[3]-this.times[2]},calcEnd:function(){this.setTime(2),this.solvingTime=this.times[2]-this.times[1],this.totalTime=this.times[2]-this.times[0],this.updateTime=this.totalTime-(this.broadPhaseTime+this.narrowPhaseTime+this.solvingTime),100===this.tt&&this.resetMax(),this.tt>100&&(this.broadPhaseTime>this.MaxBroadPhaseTime&&(this.MaxBroadPhaseTime=this.broadPhaseTime),this.narrowPhaseTime>this.MaxNarrowPhaseTime&&(this.MaxNarrowPhaseTime=this.narrowPhaseTime),this.solvingTime>this.MaxSolvingTime&&(this.MaxSolvingTime=this.solvingTime),this.totalTime>this.MaxTotalTime&&(this.MaxTotalTime=this.totalTime),this.updateTime>this.MaxUpdateTime&&(this.MaxUpdateTime=this.updateTime)),this.upfps(),this.tt++,this.tt>500&&(this.tt=0)},upfps:function(){this.f[1]=Date.now(),this.f[1]-1e3>this.f[0]&&(this.f[0]=this.f[1],this.fps=this.f[2],this.f[2]=0),this.f[2]++},show:function(){return["Oimo.js "+this.version+"<br>",this.broadPhase+"<br><br>","FPS: "+this.fps+" fps<br><br>","rigidbody "+this.parent.numRigidBodies+"<br>","contact &nbsp;&nbsp;"+this.parent.numContacts+"<br>","ct-point &nbsp;"+this.parent.numContactPoints+"<br>","paircheck "+this.parent.broadPhase.numPairChecks+"<br>","island &nbsp;&nbsp;&nbsp;"+this.parent.numIslands+"<br><br>","Time in milliseconds<br><br>","broadphase &nbsp;"+O.fix(this.broadPhaseTime)+" | "+O.fix(this.MaxBroadPhaseTime)+"<br>","narrowphase "+O.fix(this.narrowPhaseTime)+" | "+O.fix(this.MaxNarrowPhaseTime)+"<br>","solving &nbsp;&nbsp;&nbsp;&nbsp;"+O.fix(this.solvingTime)+" | "+O.fix(this.MaxSolvingTime)+"<br>","total &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+O.fix(this.totalTime)+" | "+O.fix(this.MaxTotalTime)+"<br>","updating &nbsp;&nbsp;&nbsp;"+O.fix(this.updateTime)+" | "+O.fix(this.MaxUpdateTime)+"<br>"].join("\\n")},toArray:function(){return this.infos[0]=this.parent.broadPhase.types,this.infos[1]=this.parent.numRigidBodies,this.infos[2]=this.parent.numContacts,this.infos[3]=this.parent.broadPhase.numPairChecks,this.infos[4]=this.parent.numContactPoints,this.infos[5]=this.parent.numIslands,this.infos[6]=this.broadPhaseTime,this.infos[7]=this.narrowPhaseTime,this.infos[8]=this.solvingTime,this.infos[9]=this.updateTime,this.infos[10]=this.totalTime,this.infos[11]=this.fps,this.infos}}),Object.assign(C.prototype,{Vec3:!0,set:function(t,i,s){return this.x=t,this.y=i,this.z=s,this},add:function(t,i){return void 0!==i?this.addVectors(t,i):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},addEqual:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},sub:function(t,i){return void 0!==i?this.subVectors(t,i):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},subEqual:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},scale:function(t,i){return this.x=t.x*i,this.y=t.y*i,this.z=t.z*i,this},scaleEqual:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this},subScaledVector:function(t,i){return this.x-=t.x*i,this.y-=t.y*i,this.z-=t.z*i,this},cross:function(t,i){if(void 0!==i)return this.crossVectors(t,i);var s=this.x,h=this.y,e=this.z;return this.x=h*t.z-e*t.y,this.y=e*t.x-s*t.z,this.z=s*t.y-h*t.x,this},crossVectors:function(t,i){var s=t.x,h=t.y,e=t.z,a=i.x,o=i.y,n=i.z;return this.x=h*n-e*o,this.y=e*a-s*n,this.z=s*o-h*a,this},tangent:function(t){var i=t.x,s=t.y,h=t.z;return this.x=s*i-h*h,this.y=-h*s-i*i,this.z=i*h+s*s,this},invert:function(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},addition:function(){return this.x+this.y+this.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return O.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},applyMatrix3:function(t,i){var s=this.x,h=this.y,e=this.z,a=t.elements;return i?(this.x=a[0]*s+a[1]*h+a[2]*e,this.y=a[3]*s+a[4]*h+a[5]*e,this.z=a[6]*s+a[7]*h+a[8]*e):(this.x=a[0]*s+a[3]*h+a[6]*e,this.y=a[1]*s+a[4]*h+a[7]*e,this.z=a[2]*s+a[5]*h+a[8]*e),this},applyQuaternion:function(t){var i=this.x,s=this.y,h=this.z,e=t.x,a=t.y,o=t.z,n=t.w,r=n*i+a*h-o*s,l=n*s+o*i-e*h,c=n*h+e*s-a*i,m=-e*i-a*s-o*h;return this.x=r*n+m*-e+l*-o-c*-a,this.y=l*n+m*-a+c*-e-r*-o,this.z=c*n+m*-o+r*-a-l*-e,this},testZero:function(){return 0!==this.x||0!==this.y||0!==this.z},testDiff:function(t){return!this.equals(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},clone:function(){return new this.constructor(this.x,this.y,this.z)},toString:function(){return"Vec3["+this.x.toFixed(4)+", "+this.y.toFixed(4)+", "+this.z.toFixed(4)+"]"},multiplyScalar:function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t):(this.x=0,this.y=0,this.z=0),this},divideScalar:function(t){return this.multiplyScalar(1/t)},normalize:function(){return this.divideScalar(this.length())},toArray:function(t,i){void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z},fromArray:function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}}),Object.assign(E.prototype,{Quat:!0,set:function(t,i,s,h){return this.x=t,this.y=i,this.z=s,this.w=h,this},addTime:function(t,i){var s=t.x,h=t.y,e=t.z,a=this.w,o=this.x,n=this.y,r=this.z;return i*=.5,this.x+=i*(s*a+h*r-e*n),this.y+=i*(h*a+e*o-s*r),this.z+=i*(e*a+s*n-h*o),this.w+=i*(-s*o-h*n-e*r),this.normalize(),this},multiply:function(t,i){return void 0!==i?this.multiplyQuaternions(t,i):this.multiplyQuaternions(this,t)},multiplyQuaternions:function(t,i){var s=t.x,h=t.y,e=t.z,a=t.w,o=i.x,n=i.y,r=i.z,l=i.w;return this.x=s*l+a*o+h*r-e*n,this.y=h*l+a*n+e*o-s*r,this.z=e*l+a*r+s*n-h*o,this.w=a*l-s*o-h*n-e*r,this},setFromUnitVectors:function(t,i){var s=new C,h=t.dot(i)+1;return h<O.EPS2?(h=0,O.abs(t.x)>O.abs(t.z)?s.set(-t.y,t.x,0):s.set(0,-t.z,t.y)):s.crossVectors(t,i),this._x=s.x,this._y=s.y,this._z=s.z,this._w=h,this.normalize()},arc:function(t,i){var s=t.x,h=t.y,e=t.z,a=i.x,o=i.y,n=i.z,r=s*a+h*o+e*n;if(-1==r)return a=h*s-e*e,o=-e*h-s*s,n=s*e+h*h,r=1/O.sqrt(a*a+o*o+n*n),this.w=0,this.x=a*r,this.y=o*r,this.z=n*r,this;var l=h*n-e*o,c=e*a-s*n,m=s*o-h*a;return this.w=O.sqrt(.5*(1+r)),r=.5/this.w,this.x=l*r,this.y=c*r,this.z=m*r,this},normalize:function(){var t=this.length();return 0===t?this.set(0,0,0,1):(t=1/t,this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t),this},inverse:function(){return this.conjugate().normalize()},invert:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this.conjugate().normalize(),this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},length:function(){return O.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},clone:function(t){return new E(this.x,this.y,this.z,this.w)},testDiff:function(t){return!this.equals(t)},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},toString:function(){return"Quat["+this.x.toFixed(4)+", ("+this.y.toFixed(4)+", "+this.z.toFixed(4)+", "+this.w.toFixed(4)+")]"},setFromEuler:function(t,i,s){var h=Math.cos(.5*t),e=Math.cos(.5*i),a=Math.cos(.5*s),o=Math.sin(.5*t),n=Math.sin(.5*i),r=Math.sin(.5*s);return this.x=o*e*a+h*n*r,this.y=h*n*a-o*e*r,this.z=h*e*r+o*n*a,this.w=h*e*a-o*n*r,this},setFromAxis:function(t,i){t.normalize(),i*=.5;var s=O.sin(i);return this.x=s*t.x,this.y=s*t.y,this.z=s*t.z,this.w=O.cos(i),this},setFromMat33:function(t){var i,s=t[0]+t[4]+t[8];if(s>0)i=O.sqrt(s+1),this.w=.5/i,i=.5/i,this.x=(t[5]-t[7])*i,this.y=(t[6]-t[2])*i,this.z=(t[1]-t[3])*i;else{var h=[],e=0;t[4]>t[0]&&(e=1),t[8]>t[3*e+e]&&(e=2);var a=(e+1)%3,o=(e+2)%3;i=O.sqrt(t[3*e+e]-t[3*a+a]-t[3*o+o]+1),h[e]=.5*fRoot,i=.5/fRoot,this.w=(t[3*a+o]-t[3*o+a])*i,h[a]=(t[3*a+e]+t[3*e+a])*i,h[o]=(t[3*o+e]+t[3*e+o])*i,this.x=h[1],this.y=h[2],this.z=h[3]}return this},toArray:function(t,i){t[i=i||0]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w},fromArray:function(t,i){return i=i||0,this.set(t[i],t[i+1],t[i+2],t[i+3]),this}}),Object.assign(B.prototype,{Mat33:!0,set:function(t,i,s,h,e,a,o,n,r){var l=this.elements;return l[0]=t,l[1]=i,l[2]=s,l[3]=h,l[4]=e,l[5]=a,l[6]=o,l[7]=n,l[8]=r,this},add:function(t,i){if(void 0!==i)return this.addMatrixs(t,i);var s=this.elements,h=t.elements;return s[0]+=h[0],s[1]+=h[1],s[2]+=h[2],s[3]+=h[3],s[4]+=h[4],s[5]+=h[5],s[6]+=h[6],s[7]+=h[7],s[8]+=h[8],this},addMatrixs:function(t,i){var s=this.elements,h=t.elements,e=i.elements;return s[0]=h[0]+e[0],s[1]=h[1]+e[1],s[2]=h[2]+e[2],s[3]=h[3]+e[3],s[4]=h[4]+e[4],s[5]=h[5]+e[5],s[6]=h[6]+e[6],s[7]=h[7]+e[7],s[8]=h[8]+e[8],this},addEqual:function(t){var i=this.elements,s=t.elements;return i[0]+=s[0],i[1]+=s[1],i[2]+=s[2],i[3]+=s[3],i[4]+=s[4],i[5]+=s[5],i[6]+=s[6],i[7]+=s[7],i[8]+=s[8],this},sub:function(t,i){if(void 0!==i)return this.subMatrixs(t,i);var s=this.elements,h=t.elements;return s[0]-=h[0],s[1]-=h[1],s[2]-=h[2],s[3]-=h[3],s[4]-=h[4],s[5]-=h[5],s[6]-=h[6],s[7]-=h[7],s[8]-=h[8],this},subMatrixs:function(t,i){var s=this.elements,h=t.elements,e=i.elements;return s[0]=h[0]-e[0],s[1]=h[1]-e[1],s[2]=h[2]-e[2],s[3]=h[3]-e[3],s[4]=h[4]-e[4],s[5]=h[5]-e[5],s[6]=h[6]-e[6],s[7]=h[7]-e[7],s[8]=h[8]-e[8],this},subEqual:function(t){var i=this.elements,s=t.elements;return i[0]-=s[0],i[1]-=s[1],i[2]-=s[2],i[3]-=s[3],i[4]-=s[4],i[5]-=s[5],i[6]-=s[6],i[7]-=s[7],i[8]-=s[8],this},scale:function(t,i){var s=this.elements,h=t.elements;return s[0]=h[0]*i,s[1]=h[1]*i,s[2]=h[2]*i,s[3]=h[3]*i,s[4]=h[4]*i,s[5]=h[5]*i,s[6]=h[6]*i,s[7]=h[7]*i,s[8]=h[8]*i,this},scaleEqual:function(t){var i=this.elements;return i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=t,i[4]*=t,i[5]*=t,i[6]*=t,i[7]*=t,i[8]*=t,this},multiplyMatrices:function(t,i,s){s&&(i=i.clone().transpose());var h=this.elements,e=t.elements,a=i.elements,o=e[0],n=e[3],r=e[6],l=e[1],c=e[4],m=e[7],p=e[2],u=e[5],y=e[8],x=a[0],d=a[3],f=a[6],b=a[1],v=a[4],z=a[7],N=a[2],k=a[5],w=a[8];return h[0]=o*x+l*d+p*f,h[1]=o*b+l*v+p*z,h[2]=o*N+l*k+p*w,h[3]=n*x+c*d+u*f,h[4]=n*b+c*v+u*z,h[5]=n*N+c*k+u*w,h[6]=r*x+m*d+y*f,h[7]=r*b+m*v+y*z,h[8]=r*N+m*k+y*w,this},transpose:function(t){if(void 0!==t){var i=t.elements;return this.set(i[0],i[3],i[6],i[1],i[4],i[7],i[2],i[5],i[8]),this}var s=this.elements,h=s[1],e=s[2],a=s[5];return s[1]=s[3],s[2]=s[6],s[3]=h,s[5]=s[7],s[6]=e,s[7]=a,this},setQuat:function(t){var i=this.elements,s=t.x,h=t.y,e=t.z,a=t.w,o=s+s,n=h+h,r=e+e,l=s*o,c=s*n,m=s*r,p=h*n,u=h*r,y=e*r,x=a*o,d=a*n,f=a*r;return i[0]=1-(p+y),i[1]=c-f,i[2]=m+d,i[3]=c+f,i[4]=1-(l+y),i[5]=u-x,i[6]=m-d,i[7]=u+x,i[8]=1-(l+p),this},invert:function(t){var i=this.elements,s=t.elements,h=s[0],e=s[3],a=s[6],o=s[1],n=s[4],r=s[7],l=s[2],c=s[5],m=s[8],p=m*n-c*r,u=-m*e+c*a,y=r*e-n*a,x=h*p+o*u+l*y;return 0===x?(console.log("can\'t invert matrix, determinant is 0"),this.identity()):(x=1/x,i[0]=p*x,i[1]=(-m*o+l*r)*x,i[2]=(c*o-l*n)*x,i[3]=u*x,i[4]=(m*h-l*a)*x,i[5]=(-c*h+l*e)*x,i[6]=y*x,i[7]=(-r*h+o*a)*x,i[8]=(n*h-o*e)*x,this)},addOffset:function(t,i){var s=i.x,h=i.y,e=i.z,a=this.elements;a[0]+=t*(h*h+e*e),a[4]+=t*(s*s+e*e),a[8]+=t*(s*s+h*h);var o=t*s*h,n=t*h*e,r=t*e*s;return a[1]-=o,a[3]-=o,a[2]-=n,a[6]-=n,a[5]-=r,a[7]-=r,this},subOffset:function(t,i){var s=i.x,h=i.y,e=i.z,a=this.elements;a[0]-=t*(h*h+e*e),a[4]-=t*(s*s+e*e),a[8]-=t*(s*s+h*h);var o=t*s*h,n=t*h*e,r=t*e*s;return a[1]+=o,a[3]+=o,a[2]+=n,a[6]+=n,a[5]+=r,a[7]+=r,this},multiplyScalar:function(t){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new B).fromArray(this.elements)},copy:function(t){for(var i=0;i<9;i++)this.elements[i]=t.elements[i];return this},determinant:function(){var t=this.elements,i=t[0],s=t[1],h=t[2],e=t[3],a=t[4],o=t[5],n=t[6],r=t[7],l=t[8];return i*a*l-i*o*r-s*e*l+s*o*n+h*e*r-h*a*n},fromArray:function(t,i){void 0===i&&(i=0);for(var s=0;s<9;s++)this.elements[s]=t[s+i];return this},toArray:function(t,i){void 0===t&&(t=[]),void 0===i&&(i=0);var s=this.elements;return t[i]=s[0],t[i+1]=s[1],t[i+2]=s[2],t[i+3]=s[3],t[i+4]=s[4],t[i+5]=s[5],t[i+6]=s[6],t[i+7]=s[7],t[i+8]=s[8],t}}),Object.assign(F.prototype,{AABB:!0,set:function(t,i,s,h,e,a){var o=this.elements;return o[0]=t,o[3]=i,o[1]=s,o[4]=h,o[2]=e,o[5]=a,this},intersectTest:function(t){var i=this.elements,s=t.elements;return i[0]>s[3]||i[1]>s[4]||i[2]>s[5]||i[3]<s[0]||i[4]<s[1]||i[5]<s[2]},intersectTestTwo:function(t){var i=this.elements,s=t.elements;return i[0]<s[0]||i[1]<s[1]||i[2]<s[2]||i[3]>s[3]||i[4]>s[4]||i[5]>s[5]},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t,i){var s=i||0,h=t.elements;return this.set(h[0]-s,h[3]+s,h[1]-s,h[4]+s,h[2]-s,h[5]+s),this},fromArray:function(t){return this.elements.set(t),this},combine:function(t,i){var s=t.elements,h=i.elements,e=this.elements;return e[0]=s[0]<h[0]?s[0]:h[0],e[1]=s[1]<h[1]?s[1]:h[1],e[2]=s[2]<h[2]?s[2]:h[2],e[3]=s[3]>h[3]?s[3]:h[3],e[4]=s[4]>h[4]?s[4]:h[4],e[5]=s[5]>h[5]?s[5]:h[5],this},surfaceArea:function(){var t=this.elements,i=t[3]-t[0],s=t[4]-t[1],h=t[5]-t[2];return 2*(i*(s+h)+s*h)},intersectsWithPoint:function(t,i,s){var h=this.elements;return t>=h[0]&&t<=h[3]&&i>=h[1]&&i<=h[4]&&s>=h[2]&&s<=h[5]},setFromPoints:function(t){this.makeEmpty();for(var i=0;i<t.length;i++)this.expandByPoint(t[i])},makeEmpty:function(){this.set(-1/0,-1/0,-1/0,1/0,1/0,1/0)},expandByPoint:function(t){var i=this.elements;this.set(O.min(i[0],t.x),O.min(i[1],t.y),O.min(i[2],t.z),O.max(i[3],t.x),O.max(i[4],t.y),O.max(i[5],t.z))},expandByScalar:function(t){var i=this.elements;i[0]+=-t,i[1]+=-t,i[2]+=-t,i[3]+=t,i[4]+=t,i[5]+=t}});var q=0;function U(t){this.type=b,this.id=q++,this.prev=null,this.next=null,this.proxy=null,this.parent=null,this.contactLink=null,this.numContacts=0,this.position=new C,this.rotation=new B,this.relativePosition=(new C).copy(t.relativePosition),this.relativeRotation=(new B).copy(t.relativeRotation),this.aabb=new F,this.density=t.density,this.friction=t.friction,this.restitution=t.restitution,this.belongsTo=t.belongsTo,this.collidesWith=t.collidesWith}function R(t,i,s,h){U.call(this,t),this.type=z,this.width=i,this.height=s,this.depth=h,this.halfWidth=.5*i,this.halfHeight=.5*s,this.halfDepth=.5*h,this.dimentions=new Float32Array(18),this.elements=new Float32Array(24)}function _(t,i){U.call(this,t),this.type=v,this.radius=i}function J(t,i,s){U.call(this,t),this.type=N,this.radius=i,this.height=s,this.halfHeight=.5*s,this.normalDirection=new C,this.halfDirection=new C}function W(t,i){U.call(this,t),this.type=k,this.normal=new C(0,1,0)}function H(t,i){U.call(this,t),this.type=w}function Y(){this.relativePosition=new C,this.relativeRotation=new B,this.friction=.2,this.restitution=.2,this.density=1,this.belongsTo=1,this.collidesWith=4294967295}function Q(t,i){i=i||!1,this.axis=t,this.angle=0,this.lowerLimit=i?0:1,this.upperLimit=0,this.motorSpeed=0,this.maxMotorForce=0,this.frequency=0,this.dampingRatio=0}function X(){this.parent=null,this.body1=null,this.body2=null,this.addedToIsland=!1}function K(t){this.prev=null,this.next=null,this.body=null,this.joint=t}function Z(t){X.call(this),this.scale=1,this.invScale=1,this.name="",this.id=NaN,this.type=M,this.prev=null,this.next=null,this.body1=t.body1,this.body2=t.body2,this.localAnchorPoint1=(new C).copy(t.localAnchorPoint1),this.localAnchorPoint2=(new C).copy(t.localAnchorPoint2),this.relativeAnchorPoint1=new C,this.relativeAnchorPoint2=new C,this.anchorPoint1=new C,this.anchorPoint2=new C,this.allowCollision=t.allowCollision,this.b1Link=new K(this),this.b2Link=new K(this)}function G(t){this.m1=NaN,this.m2=NaN,this.ii1=null,this.ii2=null,this.dd=null,this.r1x=NaN,this.r1y=NaN,this.r1z=NaN,this.r2x=NaN,this.r2y=NaN,this.r2z=NaN,this.ax1x=NaN,this.ax1y=NaN,this.ax1z=NaN,this.ay1x=NaN,this.ay1y=NaN,this.ay1z=NaN,this.az1x=NaN,this.az1y=NaN,this.az1z=NaN,this.ax2x=NaN,this.ax2y=NaN,this.ax2z=NaN,this.ay2x=NaN,this.ay2y=NaN,this.ay2z=NaN,this.az2x=NaN,this.az2y=NaN,this.az2z=NaN,this.vel=NaN,this.velx=NaN,this.vely=NaN,this.velz=NaN,this.joint=t,this.r1=t.relativeAnchorPoint1,this.r2=t.relativeAnchorPoint2,this.p1=t.anchorPoint1,this.p2=t.anchorPoint2,this.b1=t.body1,this.b2=t.body2,this.l1=this.b1.linearVelocity,this.l2=this.b2.linearVelocity,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.impx=0,this.impy=0,this.impz=0}function $(t,i,s,h){this.cfm1=NaN,this.cfm2=NaN,this.cfm3=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.ax1=NaN,this.ay1=NaN,this.az1=NaN,this.ax2=NaN,this.ay2=NaN,this.az2=NaN,this.ax3=NaN,this.ay3=NaN,this.az3=NaN,this.a1x1=NaN,this.a1y1=NaN,this.a1z1=NaN,this.a2x1=NaN,this.a2y1=NaN,this.a2z1=NaN,this.a1x2=NaN,this.a1y2=NaN,this.a1z2=NaN,this.a2x2=NaN,this.a2y2=NaN,this.a2z2=NaN,this.a1x3=NaN,this.a1y3=NaN,this.a1z3=NaN,this.a2x3=NaN,this.a2y3=NaN,this.a2z3=NaN,this.lowerLimit1=NaN,this.upperLimit1=NaN,this.limitVelocity1=NaN,this.limitState1=0,this.enableMotor1=!1,this.motorSpeed1=NaN,this.maxMotorForce1=NaN,this.maxMotorImpulse1=NaN,this.lowerLimit2=NaN,this.upperLimit2=NaN,this.limitVelocity2=NaN,this.limitState2=0,this.enableMotor2=!1,this.motorSpeed2=NaN,this.maxMotorForce2=NaN,this.maxMotorImpulse2=NaN,this.lowerLimit3=NaN,this.upperLimit3=NaN,this.limitVelocity3=NaN,this.limitState3=0,this.enableMotor3=!1,this.motorSpeed3=NaN,this.maxMotorForce3=NaN,this.maxMotorImpulse3=NaN,this.k00=NaN,this.k01=NaN,this.k02=NaN,this.k10=NaN,this.k11=NaN,this.k12=NaN,this.k20=NaN,this.k21=NaN,this.k22=NaN,this.kv00=NaN,this.kv11=NaN,this.kv22=NaN,this.dv00=NaN,this.dv11=NaN,this.dv22=NaN,this.d00=NaN,this.d01=NaN,this.d02=NaN,this.d10=NaN,this.d11=NaN,this.d12=NaN,this.d20=NaN,this.d21=NaN,this.d22=NaN,this.limitMotor1=i,this.limitMotor2=s,this.limitMotor3=h,this.b1=t.body1,this.b2=t.body2,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse1=0,this.motorImpulse1=0,this.limitImpulse2=0,this.motorImpulse2=0,this.limitImpulse3=0,this.motorImpulse3=0}function tt(t,i,s){Z.call(this,t),this.type=S,this.localAxis1=t.localAxis1.clone().normalize(),this.localAxis2=t.localAxis2.clone().normalize();var h=(new B).setQuat((new E).setFromUnitVectors(this.localAxis1,this.localAxis2));this.localAngle1=(new C).tangent(this.localAxis1).normalize(),this.localAngle2=this.localAngle1.clone().applyMatrix3(h,!0),this.ax1=new C,this.ax2=new C,this.an1=new C,this.an2=new C,this.tmp=new C,this.nor=new C,this.tan=new C,this.bin=new C,this.limitMotor=new Q(this.nor,!1),this.limitMotor.lowerLimit=i,this.limitMotor.upperLimit=s,this.lc=new G(this),this.r3=new $(this,this.limitMotor,new Q(this.tan,!0),new Q(this.bin,!0))}function it(t){Z.call(this,t),this.type=V,this.lc=new G(this)}function st(t,i){this.cfm=NaN,this.m1=NaN,this.m2=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.motorDenom=NaN,this.invMotorDenom=NaN,this.invDenom=NaN,this.ax=NaN,this.ay=NaN,this.az=NaN,this.r1x=NaN,this.r1y=NaN,this.r1z=NaN,this.r2x=NaN,this.r2y=NaN,this.r2z=NaN,this.t1x=NaN,this.t1y=NaN,this.t1z=NaN,this.t2x=NaN,this.t2y=NaN,this.t2z=NaN,this.l1x=NaN,this.l1y=NaN,this.l1z=NaN,this.l2x=NaN,this.l2y=NaN,this.l2z=NaN,this.a1x=NaN,this.a1y=NaN,this.a1z=NaN,this.a2x=NaN,this.a2y=NaN,this.a2z=NaN,this.lowerLimit=NaN,this.upperLimit=NaN,this.limitVelocity=NaN,this.limitState=0,this.enableMotor=!1,this.motorSpeed=NaN,this.maxMotorForce=NaN,this.maxMotorImpulse=NaN,this.limitMotor=i,this.b1=t.body1,this.b2=t.body2,this.p1=t.anchorPoint1,this.p2=t.anchorPoint2,this.r1=t.relativeAnchorPoint1,this.r2=t.relativeAnchorPoint2,this.l1=this.b1.linearVelocity,this.l2=this.b2.linearVelocity,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse=0,this.motorImpulse=0}function ht(t,i,s){Z.call(this,t),this.type=I,this.nor=new C,this.limitMotor=new Q(this.nor,!0),this.limitMotor.lowerLimit=i,this.limitMotor.upperLimit=s,this.t=new st(this,this.limitMotor)}function et(t,i){this.joint=t,this.targetOrientation=(new E).invert(i),this.relativeOrientation=new E,this.ii1=null,this.ii2=null,this.dd=null,this.vel=new C,this.imp=new C,this.rn0=new C,this.rn1=new C,this.rn2=new C,this.b1=t.body1,this.b2=t.body2,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia}function at(t,i,s,h){this.m1=NaN,this.m2=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.ax1=NaN,this.ay1=NaN,this.az1=NaN,this.ax2=NaN,this.ay2=NaN,this.az2=NaN,this.ax3=NaN,this.ay3=NaN,this.az3=NaN,this.r1x=NaN,this.r1y=NaN,this.r1z=NaN,this.r2x=NaN,this.r2y=NaN,this.r2z=NaN,this.t1x1=NaN,this.t1y1=NaN,this.t1z1=NaN,this.t2x1=NaN,this.t2y1=NaN,this.t2z1=NaN,this.l1x1=NaN,this.l1y1=NaN,this.l1z1=NaN,this.l2x1=NaN,this.l2y1=NaN,this.l2z1=NaN,this.a1x1=NaN,this.a1y1=NaN,this.a1z1=NaN,this.a2x1=NaN,this.a2y1=NaN,this.a2z1=NaN,this.t1x2=NaN,this.t1y2=NaN,this.t1z2=NaN,this.t2x2=NaN,this.t2y2=NaN,this.t2z2=NaN,this.l1x2=NaN,this.l1y2=NaN,this.l1z2=NaN,this.l2x2=NaN,this.l2y2=NaN,this.l2z2=NaN,this.a1x2=NaN,this.a1y2=NaN,this.a1z2=NaN,this.a2x2=NaN,this.a2y2=NaN,this.a2z2=NaN,this.t1x3=NaN,this.t1y3=NaN,this.t1z3=NaN,this.t2x3=NaN,this.t2y3=NaN,this.t2z3=NaN,this.l1x3=NaN,this.l1y3=NaN,this.l1z3=NaN,this.l2x3=NaN,this.l2y3=NaN,this.l2z3=NaN,this.a1x3=NaN,this.a1y3=NaN,this.a1z3=NaN,this.a2x3=NaN,this.a2y3=NaN,this.a2z3=NaN,this.lowerLimit1=NaN,this.upperLimit1=NaN,this.limitVelocity1=NaN,this.limitState1=0,this.enableMotor1=!1,this.motorSpeed1=NaN,this.maxMotorForce1=NaN,this.maxMotorImpulse1=NaN,this.lowerLimit2=NaN,this.upperLimit2=NaN,this.limitVelocity2=NaN,this.limitState2=0,this.enableMotor2=!1,this.motorSpeed2=NaN,this.maxMotorForce2=NaN,this.maxMotorImpulse2=NaN,this.lowerLimit3=NaN,this.upperLimit3=NaN,this.limitVelocity3=NaN,this.limitState3=0,this.enableMotor3=!1,this.motorSpeed3=NaN,this.maxMotorForce3=NaN,this.maxMotorImpulse3=NaN,this.k00=NaN,this.k01=NaN,this.k02=NaN,this.k10=NaN,this.k11=NaN,this.k12=NaN,this.k20=NaN,this.k21=NaN,this.k22=NaN,this.kv00=NaN,this.kv11=NaN,this.kv22=NaN,this.dv00=NaN,this.dv11=NaN,this.dv22=NaN,this.d00=NaN,this.d01=NaN,this.d02=NaN,this.d10=NaN,this.d11=NaN,this.d12=NaN,this.d20=NaN,this.d21=NaN,this.d22=NaN,this.limitMotor1=i,this.limitMotor2=s,this.limitMotor3=h,this.b1=t.body1,this.b2=t.body2,this.p1=t.anchorPoint1,this.p2=t.anchorPoint2,this.r1=t.relativeAnchorPoint1,this.r2=t.relativeAnchorPoint2,this.l1=this.b1.linearVelocity,this.l2=this.b2.linearVelocity,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse1=0,this.motorImpulse1=0,this.limitImpulse2=0,this.motorImpulse2=0,this.limitImpulse3=0,this.motorImpulse3=0,this.cfm1=0,this.cfm2=0,this.cfm3=0,this.weight=-1}function ot(t,i,s){Z.call(this,t),this.type=T,this.localAxis1=t.localAxis1.clone().normalize(),this.localAxis2=t.localAxis2.clone().normalize(),this.ax1=new C,this.ax2=new C,this.nor=new C,this.tan=new C,this.bin=new C,this.ac=new et(this,(new E).setFromUnitVectors(this.localAxis1,this.localAxis2)),this.limitMotor=new Q(this.nor,!0),this.limitMotor.lowerLimit=i,this.limitMotor.upperLimit=s,this.t3=new at(this,this.limitMotor,new Q(this.tan,!0),new Q(this.bin,!0))}function nt(t,i,s){Z.call(this,t),this.type=P,this.localAxis1=t.localAxis1.clone().normalize(),this.localAxis2=t.localAxis2.clone().normalize();var h=(new B).setQuat((new E).setFromUnitVectors(this.localAxis1,this.localAxis2));this.localAngle1=(new C).tangent(this.localAxis1).normalize(),this.localAngle2=this.localAngle1.clone().applyMatrix3(h,!0),this.ax1=new C,this.ax2=new C,this.an1=new C,this.an2=new C,this.tmp=new C,this.nor=new C,this.tan=new C,this.bin=new C,this.rotationalLimitMotor=new Q(this.nor,!1),this.r3=new $(this,this.rotationalLimitMotor,new Q(this.tan,!0),new Q(this.bin,!0)),this.translationalLimitMotor=new Q(this.nor,!0),this.translationalLimitMotor.lowerLimit=i,this.translationalLimitMotor.upperLimit=s,this.t3=new at(this,this.translationalLimitMotor,new Q(this.tan,!0),new Q(this.bin,!0))}function rt(t){Z.call(this,t),this.type=L,this.localAxis1=t.localAxis1.clone().normalize(),this.localAxis2=t.localAxis2.clone().normalize(),this.localAngle1=new C,this.localAngle2=new C;var i=O.dotVectors(this.localAxis1,this.localAxis2);if(i>-1&&i<1)this.localAngle1.set(this.localAxis2.x-i*this.localAxis1.x,this.localAxis2.y-i*this.localAxis1.y,this.localAxis2.z-i*this.localAxis1.z).normalize(),this.localAngle2.set(this.localAxis1.x-i*this.localAxis2.x,this.localAxis1.y-i*this.localAxis2.y,this.localAxis1.z-i*this.localAxis2.z).normalize();else{var s=(new B).setQuat((new E).setFromUnitVectors(this.localAxis1,this.localAxis2));this.localAngle1.tangent(this.localAxis1).normalize(),this.localAngle2=this.localAngle1.clone().applyMatrix3(s,!0)}this.ax1=new C,this.ax2=new C,this.an1=new C,this.an2=new C,this.tmp=new C,this.nor=new C,this.tan=new C,this.bin=new C,this.translationalLimitMotor=new Q(this.tan,!0),this.translationalLimitMotor.frequency=8,this.translationalLimitMotor.dampingRatio=1,this.rotationalLimitMotor1=new Q(this.tan,!1),this.rotationalLimitMotor2=new Q(this.bin,!1),this.t3=new at(this,new Q(this.nor,!0),this.translationalLimitMotor,new Q(this.bin,!0)),this.t3.weight=1,this.r3=new $(this,new Q(this.nor,!0),this.rotationalLimitMotor1,this.rotationalLimitMotor2)}function lt(){this.scale=1,this.invScale=1,this.body1=null,this.body2=null,this.localAnchorPoint1=new C,this.localAnchorPoint2=new C,this.localAxis1=new C,this.localAxis2=new C,this.allowCollision=!1}function ct(){this.mass=0,this.inertia=new B}function mt(t){this.prev=null,this.next=null,this.shape=null,this.body=null,this.contact=t}function pt(){this.lp1X=NaN,this.lp1Y=NaN,this.lp1Z=NaN,this.lp2X=NaN,this.lp2Y=NaN,this.lp2Z=NaN,this.impulse=NaN}function ut(){this.warmStarted=!1,this.position=new C,this.localPoint1=new C,this.localPoint2=new C,this.normal=new C,this.tangent=new C,this.binormal=new C,this.normalImpulse=0,this.tangentImpulse=0,this.binormalImpulse=0,this.normalDenominator=0,this.tangentDenominator=0,this.binormalDenominator=0,this.penetration=0}function yt(){this.body1=null,this.body2=null,this.numPoints=0,this.points=[new ut,new ut,new ut,new ut]}function xt(){this.nor=new C,this.tan=new C,this.bin=new C,this.norU1=new C,this.tanU1=new C,this.binU1=new C,this.norU2=new C,this.tanU2=new C,this.binU2=new C,this.norT1=new C,this.tanT1=new C,this.binT1=new C,this.norT2=new C,this.tanT2=new C,this.binT2=new C,this.norTU1=new C,this.tanTU1=new C,this.binTU1=new C,this.norTU2=new C,this.tanTU2=new C,this.binTU2=new C,this.norImp=0,this.tanImp=0,this.binImp=0,this.norDen=0,this.tanDen=0,this.binDen=0,this.norTar=0,this.next=null,this.last=!1}function dt(t){X.call(this),this.manifold=t,this.restitution=NaN,this.friction=NaN,this.p1=null,this.p2=null,this.lv1=null,this.lv2=null,this.av1=null,this.av2=null,this.i1=null,this.i2=null,this.tmp=new C,this.tmpC1=new C,this.tmpC2=new C,this.tmpP1=new C,this.tmpP2=new C,this.tmplv1=new C,this.tmplv2=new C,this.tmpav1=new C,this.tmpav2=new C,this.m1=NaN,this.m2=NaN,this.num=0,this.ps=t.points,this.cs=new xt,this.cs.next=new xt,this.cs.next.next=new xt,this.cs.next.next.next=new xt}function ft(){this.shape1=null,this.shape2=null,this.body1=null,this.body2=null,this.prev=null,this.next=null,this.persisting=!1,this.sleeping=!1,this.detector=null,this.constraint=null,this.touching=!1,this.close=!1,this.dist=O.INF,this.b1Link=new mt(this),this.b2Link=new mt(this),this.s1Link=new mt(this),this.s2Link=new mt(this),this.manifold=new yt,this.buffer=[new pt,new pt,new pt,new pt],this.points=this.manifold.points,this.constraint=new dt(this.manifold)}function bt(t,i){this.position=t||new C,this.orientation=i||new E,this.scale=1,this.invScale=1,this.mesh=null,this.id=NaN,this.name="",this.prev=null,this.next=null,this.type=u,this.massInfo=new ct,this.newPosition=new C,this.controlPos=!1,this.newOrientation=new E,this.newRotation=new C,this.currentRotation=new C,this.controlRot=!1,this.controlRotInTime=!1,this.quaternion=new E,this.pos=new C,this.linearVelocity=new C,this.angularVelocity=new C,this.parent=null,this.contactLink=null,this.numContacts=0,this.shapes=null,this.numShapes=0,this.jointLink=null,this.numJoints=0,this.sleepPosition=new C,this.sleepOrientation=new E,this.isStatic=!1,this.isDynamic=!1,this.isKinematic=!1,this.rotation=new B,this.mass=0,this.inverseMass=0,this.inverseInertia=new B,this.localInertia=new B,this.inverseLocalInertia=new B,this.tmpInertia=new B,this.addedToIsland=!1,this.allowSleep=!0,this.sleepTime=0,this.sleeping=!1}function vt(t,i){this.shape1=t||null,this.shape2=i||null}function zt(){this.types=l,this.numPairChecks=0,this.numPairs=0,this.pairs=[]}Object.assign(U.prototype,{Shape:!0,calculateMassInfo:function(t){j("Shape","Inheritance error.")},updateProxy:function(){j("Shape","Inheritance error.")}}),R.prototype=Object.assign(Object.create(U.prototype),{constructor:R,calculateMassInfo:function(t){var i=this.width*this.height*this.depth*this.density,s=1/12;t.mass=i,t.inertia.set(i*(this.height*this.height+this.depth*this.depth)*s,0,0,0,i*(this.width*this.width+this.depth*this.depth)*s,0,0,0,i*(this.width*this.width+this.height*this.height)*s)},updateProxy:function(){var t=this.rotation.elements,i=this.dimentions;i[0]=t[0],i[1]=t[3],i[2]=t[6],i[3]=t[1],i[4]=t[4],i[5]=t[7],i[6]=t[2],i[7]=t[5],i[8]=t[8],i[9]=t[0]*this.halfWidth,i[10]=t[3]*this.halfWidth,i[11]=t[6]*this.halfWidth,i[12]=t[1]*this.halfHeight,i[13]=t[4]*this.halfHeight,i[14]=t[7]*this.halfHeight,i[15]=t[2]*this.halfDepth,i[16]=t[5]*this.halfDepth,i[17]=t[8]*this.halfDepth;var s=i[9],h=i[10],e=i[11],a=i[12],o=i[13],n=i[14],r=i[15],l=i[16],c=i[17],m=this.position.x,p=this.position.y,u=this.position.z,y=this.elements;y[0]=m+s+a+r,y[1]=p+h+o+l,y[2]=u+e+n+c,y[3]=m+s+a-r,y[4]=p+h+o-l,y[5]=u+e+n-c,y[6]=m+s-a+r,y[7]=p+h-o+l,y[8]=u+e-n+c,y[9]=m+s-a-r,y[10]=p+h-o-l,y[11]=u+e-n-c,y[12]=m-s+a+r,y[13]=p-h+o+l,y[14]=u-e+n+c,y[15]=m-s+a-r,y[16]=p-h+o-l,y[17]=u-e+n-c,y[18]=m-s-a+r,y[19]=p-h-o+l,y[20]=u-e-n+c,y[21]=m-s-a-r,y[22]=p-h-o-l,y[23]=u-e-n-c;var x=i[9]<0?-i[9]:i[9],d=i[10]<0?-i[10]:i[10],f=i[11]<0?-i[11]:i[11];x=i[12]<0?x-i[12]:x+i[12],d=i[13]<0?d-i[13]:d+i[13],f=i[14]<0?f-i[14]:f+i[14],x=i[15]<0?x-i[15]:x+i[15],d=i[16]<0?d-i[16]:d+i[16],f=i[17]<0?f-i[17]:f+i[17];var b=A;this.aabb.set(this.position.x-x-b,this.position.x+x+b,this.position.y-d-b,this.position.y+d+b,this.position.z-f-b,this.position.z+f+b),null!=this.proxy&&this.proxy.update()}}),_.prototype=Object.assign(Object.create(U.prototype),{constructor:_,volume:function(){return O.PI*this.radius*1.333333},calculateMassInfo:function(t){var i=this.volume()*this.radius*this.radius*this.density;t.mass=i;var s=i*this.radius*this.radius*.4;t.inertia.set(s,0,0,0,s,0,0,0,s)},updateProxy:function(){var t=A;this.aabb.set(this.position.x-this.radius-t,this.position.x+this.radius+t,this.position.y-this.radius-t,this.position.y+this.radius+t,this.position.z-this.radius-t,this.position.z+this.radius+t),null!=this.proxy&&this.proxy.update()}}),J.prototype=Object.assign(Object.create(U.prototype),{constructor:J,calculateMassInfo:function(t){var i=this.radius*this.radius,s=O.PI*i*this.height*this.density,h=(.25*i+.0833*this.height*this.height)*s,e=.5*i;t.mass=s,t.inertia.set(h,0,0,0,e,0,0,0,h)},updateProxy:function(){var t,i,s,h,e,a,o,n,r,l,c,m=this.rotation.elements;e=m[1]*m[1],a=m[4]*m[4],o=m[7]*m[7],this.normalDirection.set(m[1],m[4],m[7]),this.halfDirection.scale(this.normalDirection,this.halfHeight),i=1-e,(t=O.sqrt(i*i+e*a+e*o))>0&&(t=this.radius/t),i*=t,s=1-a,(t=O.sqrt(a*e+s*s+a*o))>0&&(t=this.radius/t),s*=t,h=1-o,(t=O.sqrt(o*e+o*a+h*h))>0&&(t=this.radius/t),h*=t,n=this.halfDirection.x<0?-this.halfDirection.x:this.halfDirection.x,r=this.halfDirection.y<0?-this.halfDirection.y:this.halfDirection.y,l=this.halfDirection.z<0?-this.halfDirection.z:this.halfDirection.z,n=i<0?n-i:n+i,r=s<0?r-s:r+s,l=h<0?l-h:l+h,c=A,this.aabb.set(this.position.x-n-c,this.position.x+n+c,this.position.y-r-c,this.position.y+r+c,this.position.z-l-c,this.position.z+l+c),null!=this.proxy&&this.proxy.update()}}),W.prototype=Object.assign(Object.create(U.prototype),{constructor:W,volume:function(){return Number.MAX_VALUE},calculateMassInfo:function(t){t.mass=this.density;t.inertia.set(1,0,0,0,1,0,0,0,1)},updateProxy:function(){var t=A,i=-O.INF,s=O.INF,h=this.normal;this.aabb.set(-1===h.x?this.position.x-t:i,1===h.x?this.position.x+t:s,-1===h.y?this.position.y-t:i,1===h.y?this.position.y+t:s,-1===h.z?this.position.z-t:i,1===h.z?this.position.z+t:s),null!=this.proxy&&this.proxy.update()}}),H.prototype=Object.assign(Object.create(U.prototype),{constructor:H,volume:function(){return Number.MAX_VALUE},calculateMassInfo:function(t){t.inertia.set(0,0,0,0,0,0,0,0,0)},updateProxy:function(){this.aabb.set(this.position.x-0,this.position.x+0,this.position.y-0,this.position.y+0,this.position.z-0,this.position.z+0),null!=this.proxy&&this.proxy.update()}}),Object.assign(Q.prototype,{LimitMotor:!0,setLimit:function(t,i){this.lowerLimit=t,this.upperLimit=i},setMotor:function(t,i){this.motorSpeed=t,this.maxMotorForce=i},setSpring:function(t,i){this.frequency=t,this.dampingRatio=i}}),Object.assign(X.prototype,{Constraint:!0,preSolve:function(t,i){j("Constraint","Inheritance error.")},solve:function(){j("Constraint","Inheritance error.")},postSolve:function(){j("Constraint","Inheritance error.")}}),Z.prototype=Object.assign(Object.create(X.prototype),{constructor:Z,setId:function(t){this.id=i},setParent:function(t){this.parent=t,this.scale=this.parent.scale,this.invScale=this.parent.invScale,this.id=this.parent.numJoints,this.name||(this.name="J"+this.id)},updateAnchorPoints:function(){this.relativeAnchorPoint1.copy(this.localAnchorPoint1).applyMatrix3(this.body1.rotation,!0),this.relativeAnchorPoint2.copy(this.localAnchorPoint2).applyMatrix3(this.body2.rotation,!0),this.anchorPoint1.add(this.relativeAnchorPoint1,this.body1.position),this.anchorPoint2.add(this.relativeAnchorPoint2,this.body2.position)},attach:function(t){this.b1Link.body=this.body2,this.b2Link.body=this.body1,t?(this.body1.jointLink.push(this.b1Link),this.body2.jointLink.push(this.b2Link)):(null!=this.body1.jointLink?(this.b1Link.next=this.body1.jointLink).prev=this.b1Link:this.b1Link.next=null,this.body1.jointLink=this.b1Link,this.body1.numJoints++,null!=this.body2.jointLink?(this.b2Link.next=this.body2.jointLink).prev=this.b2Link:this.b2Link.next=null,this.body2.jointLink=this.b2Link,this.body2.numJoints++)},detach:function(t){if(t)this.body1.jointLink.splice(this.body1.jointLink.indexOf(this.b1Link),1),this.body2.jointLink.splice(this.body2.jointLink.indexOf(this.b2Link),1);else{var i=this.b1Link.prev,s=this.b1Link.next;null!=i&&(i.next=s),null!=s&&(s.prev=i),this.body1.jointLink==this.b1Link&&(this.body1.jointLink=s),this.b1Link.prev=null,this.b1Link.next=null,this.b1Link.body=null,this.body1.numJoints--,i=this.b2Link.prev,s=this.b2Link.next,null!=i&&(i.next=s),null!=s&&(s.prev=i),this.body2.jointLink==this.b2Link&&(this.body2.jointLink=s),this.b2Link.prev=null,this.b2Link.next=null,this.b2Link.body=null,this.body2.numJoints--}this.b1Link.body=null,this.b2Link.body=null},awake:function(){this.body1.awake(),this.body2.awake()},preSolve:function(t,i){},solve:function(){},postSolve:function(){},remove:function(){this.dispose()},dispose:function(){this.parent.removeJoint(this)},getPosition:function(){return[(new C).scale(this.anchorPoint1,this.scale),(new C).scale(this.anchorPoint2,this.scale)]}}),Object.assign(G.prototype,{LinearConstraint:!0,preSolve:function(t,i){this.r1x=this.r1.x,this.r1y=this.r1.y,this.r1z=this.r1.z,this.r2x=this.r2.x,this.r2y=this.r2.y,this.r2z=this.r2.z,this.m1=this.b1.inverseMass,this.m2=this.b2.inverseMass,this.ii1=this.i1.clone(),this.ii2=this.i2.clone();var s=this.ii1.elements,h=this.ii2.elements;this.ax1x=this.r1z*s[1]+-this.r1y*s[2],this.ax1y=this.r1z*s[4]+-this.r1y*s[5],this.ax1z=this.r1z*s[7]+-this.r1y*s[8],this.ay1x=-this.r1z*s[0]+this.r1x*s[2],this.ay1y=-this.r1z*s[3]+this.r1x*s[5],this.ay1z=-this.r1z*s[6]+this.r1x*s[8],this.az1x=this.r1y*s[0]+-this.r1x*s[1],this.az1y=this.r1y*s[3]+-this.r1x*s[4],this.az1z=this.r1y*s[6]+-this.r1x*s[7],this.ax2x=this.r2z*h[1]+-this.r2y*h[2],this.ax2y=this.r2z*h[4]+-this.r2y*h[5],this.ax2z=this.r2z*h[7]+-this.r2y*h[8],this.ay2x=-this.r2z*h[0]+this.r2x*h[2],this.ay2y=-this.r2z*h[3]+this.r2x*h[5],this.ay2z=-this.r2z*h[6]+this.r2x*h[8],this.az2x=this.r2y*h[0]+-this.r2x*h[1],this.az2y=this.r2y*h[3]+-this.r2x*h[4],this.az2z=this.r2y*h[6]+-this.r2x*h[7];var e=this.m1+this.m2,a=(new B).set(e,0,0,0,e,0,0,0,e).elements;a[0]+=s[4]*this.r1z*this.r1z-(s[7]+s[5])*this.r1y*this.r1z+s[8]*this.r1y*this.r1y,a[1]+=(s[6]*this.r1y+s[5]*this.r1x)*this.r1z-s[3]*this.r1z*this.r1z-s[8]*this.r1x*this.r1y,a[2]+=(s[3]*this.r1y-s[4]*this.r1x)*this.r1z-s[6]*this.r1y*this.r1y+s[7]*this.r1x*this.r1y,a[3]+=(s[2]*this.r1y+s[7]*this.r1x)*this.r1z-s[1]*this.r1z*this.r1z-s[8]*this.r1x*this.r1y,a[4]+=s[0]*this.r1z*this.r1z-(s[6]+s[2])*this.r1x*this.r1z+s[8]*this.r1x*this.r1x,a[5]+=(s[1]*this.r1x-s[0]*this.r1y)*this.r1z-s[7]*this.r1x*this.r1x+s[6]*this.r1x*this.r1y,a[6]+=(s[1]*this.r1y-s[4]*this.r1x)*this.r1z-s[2]*this.r1y*this.r1y+s[5]*this.r1x*this.r1y,a[7]+=(s[3]*this.r1x-s[0]*this.r1y)*this.r1z-s[5]*this.r1x*this.r1x+s[2]*this.r1x*this.r1y,a[8]+=s[0]*this.r1y*this.r1y-(s[3]+s[1])*this.r1x*this.r1y+s[4]*this.r1x*this.r1x,a[0]+=h[4]*this.r2z*this.r2z-(h[7]+h[5])*this.r2y*this.r2z+h[8]*this.r2y*this.r2y,a[1]+=(h[6]*this.r2y+h[5]*this.r2x)*this.r2z-h[3]*this.r2z*this.r2z-h[8]*this.r2x*this.r2y,a[2]+=(h[3]*this.r2y-h[4]*this.r2x)*this.r2z-h[6]*this.r2y*this.r2y+h[7]*this.r2x*this.r2y,a[3]+=(h[2]*this.r2y+h[7]*this.r2x)*this.r2z-h[1]*this.r2z*this.r2z-h[8]*this.r2x*this.r2y,a[4]+=h[0]*this.r2z*this.r2z-(h[6]+h[2])*this.r2x*this.r2z+h[8]*this.r2x*this.r2x,a[5]+=(h[1]*this.r2x-h[0]*this.r2y)*this.r2z-h[7]*this.r2x*this.r2x+h[6]*this.r2x*this.r2y,a[6]+=(h[1]*this.r2y-h[4]*this.r2x)*this.r2z-h[2]*this.r2y*this.r2y+h[5]*this.r2x*this.r2y,a[7]+=(h[3]*this.r2x-h[0]*this.r2y)*this.r2z-h[5]*this.r2x*this.r2x+h[2]*this.r2x*this.r2y,a[8]+=h[0]*this.r2y*this.r2y-(h[3]+h[1])*this.r2x*this.r2y+h[4]*this.r2x*this.r2x;var o=1/(a[0]*(a[4]*a[8]-a[7]*a[5])+a[3]*(a[7]*a[2]-a[1]*a[8])+a[6]*(a[1]*a[5]-a[4]*a[2]));this.dd=(new B).set(a[4]*a[8]-a[5]*a[7],a[2]*a[7]-a[1]*a[8],a[1]*a[5]-a[2]*a[4],a[5]*a[6]-a[3]*a[8],a[0]*a[8]-a[2]*a[6],a[2]*a[3]-a[0]*a[5],a[3]*a[7]-a[4]*a[6],a[1]*a[6]-a[0]*a[7],a[0]*a[4]-a[1]*a[3]).scaleEqual(o),this.velx=this.p2.x-this.p1.x,this.vely=this.p2.y-this.p1.y,this.velz=this.p2.z-this.p1.z;var n=O.sqrt(this.velx*this.velx+this.vely*this.vely+this.velz*this.velz);n>.005?(n=(.005-n)/n*i*.05,this.velx*=n,this.vely*=n,this.velz*=n):(this.velx=0,this.vely=0,this.velz=0),this.impx*=.95,this.impy*=.95,this.impz*=.95,this.l1.x+=this.impx*this.m1,this.l1.y+=this.impy*this.m1,this.l1.z+=this.impz*this.m1,this.a1.x+=this.impx*this.ax1x+this.impy*this.ay1x+this.impz*this.az1x,this.a1.y+=this.impx*this.ax1y+this.impy*this.ay1y+this.impz*this.az1y,this.a1.z+=this.impx*this.ax1z+this.impy*this.ay1z+this.impz*this.az1z,this.l2.x-=this.impx*this.m2,this.l2.y-=this.impy*this.m2,this.l2.z-=this.impz*this.m2,this.a2.x-=this.impx*this.ax2x+this.impy*this.ay2x+this.impz*this.az2x,this.a2.y-=this.impx*this.ax2y+this.impy*this.ay2y+this.impz*this.az2y,this.a2.z-=this.impx*this.ax2z+this.impy*this.ay2z+this.impz*this.az2z},solve:function(){var t=this.dd.elements,i=this.l2.x-this.l1.x+this.a2.y*this.r2z-this.a2.z*this.r2y-this.a1.y*this.r1z+this.a1.z*this.r1y-this.velx,s=this.l2.y-this.l1.y+this.a2.z*this.r2x-this.a2.x*this.r2z-this.a1.z*this.r1x+this.a1.x*this.r1z-this.vely,h=this.l2.z-this.l1.z+this.a2.x*this.r2y-this.a2.y*this.r2x-this.a1.x*this.r1y+this.a1.y*this.r1x-this.velz,e=i*t[0]+s*t[1]+h*t[2],a=i*t[3]+s*t[4]+h*t[5],o=i*t[6]+s*t[7]+h*t[8];this.impx+=e,this.impy+=a,this.impz+=o,this.l1.x+=e*this.m1,this.l1.y+=a*this.m1,this.l1.z+=o*this.m1,this.a1.x+=e*this.ax1x+a*this.ay1x+o*this.az1x,this.a1.y+=e*this.ax1y+a*this.ay1y+o*this.az1y,this.a1.z+=e*this.ax1z+a*this.ay1z+o*this.az1z,this.l2.x-=e*this.m2,this.l2.y-=a*this.m2,this.l2.z-=o*this.m2,this.a2.x-=e*this.ax2x+a*this.ay2x+o*this.az2x,this.a2.y-=e*this.ax2y+a*this.ay2y+o*this.az2y,this.a2.z-=e*this.ax2z+a*this.ay2z+o*this.az2z}}),Object.assign($.prototype,{Rotational3Constraint:!0,preSolve:function(t,i){this.ax1=this.limitMotor1.axis.x,this.ay1=this.limitMotor1.axis.y,this.az1=this.limitMotor1.axis.z,this.ax2=this.limitMotor2.axis.x,this.ay2=this.limitMotor2.axis.y,this.az2=this.limitMotor2.axis.z,this.ax3=this.limitMotor3.axis.x,this.ay3=this.limitMotor3.axis.y,this.az3=this.limitMotor3.axis.z,this.lowerLimit1=this.limitMotor1.lowerLimit,this.upperLimit1=this.limitMotor1.upperLimit,this.motorSpeed1=this.limitMotor1.motorSpeed,this.maxMotorForce1=this.limitMotor1.maxMotorForce,this.enableMotor1=this.maxMotorForce1>0,this.lowerLimit2=this.limitMotor2.lowerLimit,this.upperLimit2=this.limitMotor2.upperLimit,this.motorSpeed2=this.limitMotor2.motorSpeed,this.maxMotorForce2=this.limitMotor2.maxMotorForce,this.enableMotor2=this.maxMotorForce2>0,this.lowerLimit3=this.limitMotor3.lowerLimit,this.upperLimit3=this.limitMotor3.upperLimit,this.motorSpeed3=this.limitMotor3.motorSpeed,this.maxMotorForce3=this.limitMotor3.maxMotorForce,this.enableMotor3=this.maxMotorForce3>0;var s=this.i1.elements,h=this.i2.elements;this.i1e00=s[0],this.i1e01=s[1],this.i1e02=s[2],this.i1e10=s[3],this.i1e11=s[4],this.i1e12=s[5],this.i1e20=s[6],this.i1e21=s[7],this.i1e22=s[8],this.i2e00=h[0],this.i2e01=h[1],this.i2e02=h[2],this.i2e10=h[3],this.i2e11=h[4],this.i2e12=h[5],this.i2e20=h[6],this.i2e21=h[7],this.i2e22=h[8];var e=this.limitMotor1.frequency,a=this.limitMotor2.frequency,o=this.limitMotor3.frequency,n=e>0,r=a>0,l=o>0,c=this.lowerLimit1<=this.upperLimit1,m=this.lowerLimit2<=this.upperLimit2,p=this.lowerLimit3<=this.upperLimit3,u=this.limitMotor1.angle;c?(this.lowerLimit1==this.upperLimit1?(0!=this.limitState1&&(this.limitState1=0,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-u):u<this.lowerLimit1?(-1!=this.limitState1&&(this.limitState1=-1,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-u):u>this.upperLimit1?(1!=this.limitState1&&(this.limitState1=1,this.limitImpulse1=0),this.limitVelocity1=this.upperLimit1-u):(this.limitState1=2,this.limitImpulse1=0,this.limitVelocity1=0),n||(this.limitVelocity1>.02?this.limitVelocity1-=.02:this.limitVelocity1<-.02?this.limitVelocity1+=.02:this.limitVelocity1=0)):(this.limitState1=2,this.limitImpulse1=0);var y=this.limitMotor2.angle;m?(this.lowerLimit2==this.upperLimit2?(0!=this.limitState2&&(this.limitState2=0,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-y):y<this.lowerLimit2?(-1!=this.limitState2&&(this.limitState2=-1,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-y):y>this.upperLimit2?(1!=this.limitState2&&(this.limitState2=1,this.limitImpulse2=0),this.limitVelocity2=this.upperLimit2-y):(this.limitState2=2,this.limitImpulse2=0,this.limitVelocity2=0),r||(this.limitVelocity2>.02?this.limitVelocity2-=.02:this.limitVelocity2<-.02?this.limitVelocity2+=.02:this.limitVelocity2=0)):(this.limitState2=2,this.limitImpulse2=0);var x=this.limitMotor3.angle;if(p?(this.lowerLimit3==this.upperLimit3?(0!=this.limitState3&&(this.limitState3=0,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-x):x<this.lowerLimit3?(-1!=this.limitState3&&(this.limitState3=-1,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-x):x>this.upperLimit3?(1!=this.limitState3&&(this.limitState3=1,this.limitImpulse3=0),this.limitVelocity3=this.upperLimit3-x):(this.limitState3=2,this.limitImpulse3=0,this.limitVelocity3=0),l||(this.limitVelocity3>.02?this.limitVelocity3-=.02:this.limitVelocity3<-.02?this.limitVelocity3+=.02:this.limitVelocity3=0)):(this.limitState3=2,this.limitImpulse3=0),this.enableMotor1&&(0!=this.limitState1||n)?this.maxMotorImpulse1=this.maxMotorForce1*t:(this.motorImpulse1=0,this.maxMotorImpulse1=0),this.enableMotor2&&(0!=this.limitState2||r)?this.maxMotorImpulse2=this.maxMotorForce2*t:(this.motorImpulse2=0,this.maxMotorImpulse2=0),this.enableMotor3&&(0!=this.limitState3||l)?this.maxMotorImpulse3=this.maxMotorForce3*t:(this.motorImpulse3=0,this.maxMotorImpulse3=0),this.a1x1=this.ax1*this.i1e00+this.ay1*this.i1e01+this.az1*this.i1e02,this.a1y1=this.ax1*this.i1e10+this.ay1*this.i1e11+this.az1*this.i1e12,this.a1z1=this.ax1*this.i1e20+this.ay1*this.i1e21+this.az1*this.i1e22,this.a2x1=this.ax1*this.i2e00+this.ay1*this.i2e01+this.az1*this.i2e02,this.a2y1=this.ax1*this.i2e10+this.ay1*this.i2e11+this.az1*this.i2e12,this.a2z1=this.ax1*this.i2e20+this.ay1*this.i2e21+this.az1*this.i2e22,this.a1x2=this.ax2*this.i1e00+this.ay2*this.i1e01+this.az2*this.i1e02,this.a1y2=this.ax2*this.i1e10+this.ay2*this.i1e11+this.az2*this.i1e12,this.a1z2=this.ax2*this.i1e20+this.ay2*this.i1e21+this.az2*this.i1e22,this.a2x2=this.ax2*this.i2e00+this.ay2*this.i2e01+this.az2*this.i2e02,this.a2y2=this.ax2*this.i2e10+this.ay2*this.i2e11+this.az2*this.i2e12,this.a2z2=this.ax2*this.i2e20+this.ay2*this.i2e21+this.az2*this.i2e22,this.a1x3=this.ax3*this.i1e00+this.ay3*this.i1e01+this.az3*this.i1e02,this.a1y3=this.ax3*this.i1e10+this.ay3*this.i1e11+this.az3*this.i1e12,this.a1z3=this.ax3*this.i1e20+this.ay3*this.i1e21+this.az3*this.i1e22,this.a2x3=this.ax3*this.i2e00+this.ay3*this.i2e01+this.az3*this.i2e02,this.a2y3=this.ax3*this.i2e10+this.ay3*this.i2e11+this.az3*this.i2e12,this.a2z3=this.ax3*this.i2e20+this.ay3*this.i2e21+this.az3*this.i2e22,this.k00=this.ax1*(this.a1x1+this.a2x1)+this.ay1*(this.a1y1+this.a2y1)+this.az1*(this.a1z1+this.a2z1),this.k01=this.ax1*(this.a1x2+this.a2x2)+this.ay1*(this.a1y2+this.a2y2)+this.az1*(this.a1z2+this.a2z2),this.k02=this.ax1*(this.a1x3+this.a2x3)+this.ay1*(this.a1y3+this.a2y3)+this.az1*(this.a1z3+this.a2z3),this.k10=this.ax2*(this.a1x1+this.a2x1)+this.ay2*(this.a1y1+this.a2y1)+this.az2*(this.a1z1+this.a2z1),this.k11=this.ax2*(this.a1x2+this.a2x2)+this.ay2*(this.a1y2+this.a2y2)+this.az2*(this.a1z2+this.a2z2),this.k12=this.ax2*(this.a1x3+this.a2x3)+this.ay2*(this.a1y3+this.a2y3)+this.az2*(this.a1z3+this.a2z3),this.k20=this.ax3*(this.a1x1+this.a2x1)+this.ay3*(this.a1y1+this.a2y1)+this.az3*(this.a1z1+this.a2z1),this.k21=this.ax3*(this.a1x2+this.a2x2)+this.ay3*(this.a1y2+this.a2y2)+this.az3*(this.a1z2+this.a2z2),this.k22=this.ax3*(this.a1x3+this.a2x3)+this.ay3*(this.a1y3+this.a2y3)+this.az3*(this.a1z3+this.a2z3),this.kv00=this.k00,this.kv11=this.k11,this.kv22=this.k22,this.dv00=1/this.kv00,this.dv11=1/this.kv11,this.dv22=1/this.kv22,n&&2!=this.limitState1){var d=6.2831853*e,f=d*d*t,b=i/(f+2*this.limitMotor1.dampingRatio*d);this.cfm1=this.kv00*b,this.limitVelocity1*=f*b}else this.cfm1=0,this.limitVelocity1*=.05*i;r&&2!=this.limitState2?(b=i/((f=(d=6.2831853*a)*d*t)+2*this.limitMotor2.dampingRatio*d),this.cfm2=this.kv11*b,this.limitVelocity2*=f*b):(this.cfm2=0,this.limitVelocity2*=.05*i),l&&2!=this.limitState3?(b=i/((f=(d=6.2831853*o)*d*t)+2*this.limitMotor3.dampingRatio*d),this.cfm3=this.kv22*b,this.limitVelocity3*=f*b):(this.cfm3=0,this.limitVelocity3*=.05*i),this.k00+=this.cfm1,this.k11+=this.cfm2,this.k22+=this.cfm3;var v=1/(this.k00*(this.k11*this.k22-this.k21*this.k12)+this.k10*(this.k21*this.k02-this.k01*this.k22)+this.k20*(this.k01*this.k12-this.k11*this.k02));this.d00=(this.k11*this.k22-this.k12*this.k21)*v,this.d01=(this.k02*this.k21-this.k01*this.k22)*v,this.d02=(this.k01*this.k12-this.k02*this.k11)*v,this.d10=(this.k12*this.k20-this.k10*this.k22)*v,this.d11=(this.k00*this.k22-this.k02*this.k20)*v,this.d12=(this.k02*this.k10-this.k00*this.k12)*v,this.d20=(this.k10*this.k21-this.k11*this.k20)*v,this.d21=(this.k01*this.k20-this.k00*this.k21)*v,this.d22=(this.k00*this.k11-this.k01*this.k10)*v,this.limitImpulse1*=.95,this.motorImpulse1*=.95,this.limitImpulse2*=.95,this.motorImpulse2*=.95,this.limitImpulse3*=.95,this.motorImpulse3*=.95;var z=this.limitImpulse1+this.motorImpulse1,N=this.limitImpulse2+this.motorImpulse2,k=this.limitImpulse3+this.motorImpulse3;this.a1.x+=z*this.a1x1+N*this.a1x2+k*this.a1x3,this.a1.y+=z*this.a1y1+N*this.a1y2+k*this.a1y3,this.a1.z+=z*this.a1z1+N*this.a1z2+k*this.a1z3,this.a2.x-=z*this.a2x1+N*this.a2x2+k*this.a2x3,this.a2.y-=z*this.a2y1+N*this.a2y2+k*this.a2y3,this.a2.z-=z*this.a2z1+N*this.a2z2+k*this.a2z3},solve_:function(){var t=this.a2.x-this.a1.x,i=this.a2.y-this.a1.y,s=this.a2.z-this.a1.z;this.limitVelocity3=30;var h=t*this.ax1+i*this.ay1+s*this.az1-this.limitVelocity1,e=t*this.ax2+i*this.ay2+s*this.az2-this.limitVelocity2,a=t*this.ax3+i*this.ay3+s*this.az3-this.limitVelocity3,o=h*this.d00+e*this.d01+a*this.d02,n=h*this.d10+e*this.d11+a*this.d12,r=h*this.d20+e*this.d21+a*this.d22;this.limitImpulse1+=o,this.limitImpulse2+=n,this.limitImpulse3+=r,this.a1.x+=o*this.a1x1+n*this.a1x2+r*this.a1x3,this.a1.y+=o*this.a1y1+n*this.a1y2+r*this.a1y3,this.a1.z+=o*this.a1z1+n*this.a1z2+r*this.a1z3,this.a2.x-=o*this.a2x1+n*this.a2x2+r*this.a2x3,this.a2.y-=o*this.a2y1+n*this.a2y2+r*this.a2y3,this.a2.z-=o*this.a2z1+n*this.a2z2+r*this.a2z3},solve:function(){var t=this.a2.x-this.a1.x,i=this.a2.y-this.a1.y,s=this.a2.z-this.a1.z,h=t*this.ax1+i*this.ay1+s*this.az1,e=t*this.ax2+i*this.ay2+s*this.az2,a=t*this.ax3+i*this.ay3+s*this.az3,o=this.motorImpulse1,n=this.motorImpulse2,r=this.motorImpulse3,l=0,c=0,m=0;this.enableMotor1&&(l=(h-this.motorSpeed1)*this.dv00,this.motorImpulse1+=l,this.motorImpulse1>this.maxMotorImpulse1?this.motorImpulse1=this.maxMotorImpulse1:this.motorImpulse1<-this.maxMotorImpulse1&&(this.motorImpulse1=-this.maxMotorImpulse1),l=this.motorImpulse1-o),this.enableMotor2&&(c=(e-this.motorSpeed2)*this.dv11,this.motorImpulse2+=c,this.motorImpulse2>this.maxMotorImpulse2?this.motorImpulse2=this.maxMotorImpulse2:this.motorImpulse2<-this.maxMotorImpulse2&&(this.motorImpulse2=-this.maxMotorImpulse2),c=this.motorImpulse2-n),this.enableMotor3&&(m=(a-this.motorSpeed3)*this.dv22,this.motorImpulse3+=m,this.motorImpulse3>this.maxMotorImpulse3?this.motorImpulse3=this.maxMotorImpulse3:this.motorImpulse3<-this.maxMotorImpulse3&&(this.motorImpulse3=-this.maxMotorImpulse3),m=this.motorImpulse3-r),h+=l*this.kv00+c*this.k01+m*this.k02,e+=l*this.k10+c*this.kv11+m*this.k12,a+=l*this.k20+c*this.k21+m*this.kv22,h-=this.limitVelocity1+this.limitImpulse1*this.cfm1,e-=this.limitVelocity2+this.limitImpulse2*this.cfm2,a-=this.limitVelocity3+this.limitImpulse3*this.cfm3;var p=this.limitImpulse1,u=this.limitImpulse2,y=this.limitImpulse3,x=h*this.d00+e*this.d01+a*this.d02,d=h*this.d10+e*this.d11+a*this.d12,f=h*this.d20+e*this.d21+a*this.d22;this.limitImpulse1+=x,this.limitImpulse2+=d,this.limitImpulse3+=f;var b,v=0;switch((2==this.limitState1||this.limitImpulse1*this.limitState1<0)&&(e+=(x=-p)*this.k10,a+=x*this.k20,v|=1),(2==this.limitState2||this.limitImpulse2*this.limitState2<0)&&(h+=(d=-u)*this.k01,a+=d*this.k21,v|=2),(2==this.limitState3||this.limitImpulse3*this.limitState3<0)&&(h+=(f=-y)*this.k02,e+=f*this.k12,v|=4),v){case 1:b=1/(this.k11*this.k22-this.k12*this.k21),d=(this.k22*e+-this.k12*a)*b,f=(-this.k21*e+this.k11*a)*b;break;case 2:b=1/(this.k00*this.k22-this.k02*this.k20),x=(this.k22*h+-this.k02*a)*b,f=(-this.k20*h+this.k00*a)*b;break;case 3:f=a/this.k22;break;case 4:b=1/(this.k00*this.k11-this.k01*this.k10),x=(this.k11*h+-this.k01*e)*b,d=(-this.k10*h+this.k00*e)*b;break;case 5:d=e/this.k11;break;case 6:x=h/this.k00}this.limitImpulse1=x+p,this.limitImpulse2=d+u,this.limitImpulse3=f+y;var z=l+x,N=c+d,k=m+f;this.a1.x+=z*this.a1x1+N*this.a1x2+k*this.a1x3,this.a1.y+=z*this.a1y1+N*this.a1y2+k*this.a1y3,this.a1.z+=z*this.a1z1+N*this.a1z2+k*this.a1z3,this.a2.x-=z*this.a2x1+N*this.a2x2+k*this.a2x3,this.a2.y-=z*this.a2y1+N*this.a2y2+k*this.a2y3,this.a2.z-=z*this.a2z1+N*this.a2z2+k*this.a2z3,t=this.a2.x-this.a1.x,i=this.a2.y-this.a1.y,s=this.a2.z-this.a1.z,e=t*this.ax2+i*this.ay2+s*this.az2}}),tt.prototype=Object.assign(Object.create(Z.prototype),{constructor:tt,preSolve:function(t,i){this.updateAnchorPoints(),this.ax1.copy(this.localAxis1).applyMatrix3(this.body1.rotation,!0),this.ax2.copy(this.localAxis2).applyMatrix3(this.body2.rotation,!0),this.an1.copy(this.localAngle1).applyMatrix3(this.body1.rotation,!0),this.an2.copy(this.localAngle2).applyMatrix3(this.body2.rotation,!0),this.nor.set(this.ax1.x*this.body2.inverseMass+this.ax2.x*this.body1.inverseMass,this.ax1.y*this.body2.inverseMass+this.ax2.y*this.body1.inverseMass,this.ax1.z*this.body2.inverseMass+this.ax2.z*this.body1.inverseMass).normalize(),this.tan.tangent(this.nor).normalize(),this.bin.crossVectors(this.nor,this.tan);var s=O.acosClamp(O.dotVectors(this.an1,this.an2));this.tmp.crossVectors(this.an1,this.an2),O.dotVectors(this.nor,this.tmp)<0?this.limitMotor.angle=-s:this.limitMotor.angle=s,this.tmp.crossVectors(this.ax1,this.ax2),this.r3.limitMotor2.angle=O.dotVectors(this.tan,this.tmp),this.r3.limitMotor3.angle=O.dotVectors(this.bin,this.tmp),this.r3.preSolve(t,i),this.lc.preSolve(t,i)},solve:function(){this.r3.solve(),this.lc.solve()},postSolve:function(){}}),it.prototype=Object.assign(Object.create(Z.prototype),{constructor:it,preSolve:function(t,i){this.updateAnchorPoints(),this.lc.preSolve(t,i)},solve:function(){this.lc.solve()},postSolve:function(){}}),Object.assign(st.prototype,{TranslationalConstraint:!0,preSolve:function(t,i){this.ax=this.limitMotor.axis.x,this.ay=this.limitMotor.axis.y,this.az=this.limitMotor.axis.z,this.lowerLimit=this.limitMotor.lowerLimit,this.upperLimit=this.limitMotor.upperLimit,this.motorSpeed=this.limitMotor.motorSpeed,this.maxMotorForce=this.limitMotor.maxMotorForce,this.enableMotor=this.maxMotorForce>0,this.m1=this.b1.inverseMass,this.m2=this.b2.inverseMass;var s=this.i1.elements,h=this.i2.elements;this.i1e00=s[0],this.i1e01=s[1],this.i1e02=s[2],this.i1e10=s[3],this.i1e11=s[4],this.i1e12=s[5],this.i1e20=s[6],this.i1e21=s[7],this.i1e22=s[8],this.i2e00=h[0],this.i2e01=h[1],this.i2e02=h[2],this.i2e10=h[3],this.i2e11=h[4],this.i2e12=h[5],this.i2e20=h[6],this.i2e21=h[7],this.i2e22=h[8];var e=this.p2.x-this.p1.x,a=this.p2.y-this.p1.y,o=this.p2.z-this.p1.z,n=e*this.ax+a*this.ay+o*this.az,r=this.limitMotor.frequency,l=r>0;(l&&n>20||n<-20)&&(l=!1),this.lowerLimit<=this.upperLimit?(this.lowerLimit==this.upperLimit?(0!=this.limitState&&(this.limitState=0,this.limitImpulse=0),this.limitVelocity=this.lowerLimit-n,l||(n=this.lowerLimit)):n<this.lowerLimit?(-1!=this.limitState&&(this.limitState=-1,this.limitImpulse=0),this.limitVelocity=this.lowerLimit-n,l||(n=this.lowerLimit)):n>this.upperLimit?(1!=this.limitState&&(this.limitState=1,this.limitImpulse=0),this.limitVelocity=this.upperLimit-n,l||(n=this.upperLimit)):(this.limitState=2,this.limitImpulse=0,this.limitVelocity=0),l||(this.limitVelocity>.005?this.limitVelocity-=.005:this.limitVelocity<-.005?this.limitVelocity+=.005:this.limitVelocity=0)):(this.limitState=2,this.limitImpulse=0),this.enableMotor&&(0!=this.limitState||l)?this.maxMotorImpulse=this.maxMotorForce*t:(this.motorImpulse=0,this.maxMotorImpulse=0);var c=n*this.ax,m=n*this.ay,p=n*this.az,u=this.m1/(this.m1+this.m2),y=1-u;if(this.r1x=this.r1.x+c*u,this.r1y=this.r1.y+m*u,this.r1z=this.r1.z+p*u,this.r2x=this.r2.x-c*y,this.r2y=this.r2.y-m*y,this.r2z=this.r2.z-p*y,this.t1x=this.r1y*this.az-this.r1z*this.ay,this.t1y=this.r1z*this.ax-this.r1x*this.az,this.t1z=this.r1x*this.ay-this.r1y*this.ax,this.t2x=this.r2y*this.az-this.r2z*this.ay,this.t2y=this.r2z*this.ax-this.r2x*this.az,this.t2z=this.r2x*this.ay-this.r2y*this.ax,this.l1x=this.ax*this.m1,this.l1y=this.ay*this.m1,this.l1z=this.az*this.m1,this.l2x=this.ax*this.m2,this.l2y=this.ay*this.m2,this.l2z=this.az*this.m2,this.a1x=this.t1x*this.i1e00+this.t1y*this.i1e01+this.t1z*this.i1e02,this.a1y=this.t1x*this.i1e10+this.t1y*this.i1e11+this.t1z*this.i1e12,this.a1z=this.t1x*this.i1e20+this.t1y*this.i1e21+this.t1z*this.i1e22,this.a2x=this.t2x*this.i2e00+this.t2y*this.i2e01+this.t2z*this.i2e02,this.a2y=this.t2x*this.i2e10+this.t2y*this.i2e11+this.t2z*this.i2e12,this.a2z=this.t2x*this.i2e20+this.t2y*this.i2e21+this.t2z*this.i2e22,this.motorDenom=this.m1+this.m2+this.ax*(this.a1y*this.r1z-this.a1z*this.r1y+this.a2y*this.r2z-this.a2z*this.r2y)+this.ay*(this.a1z*this.r1x-this.a1x*this.r1z+this.a2z*this.r2x-this.a2x*this.r2z)+this.az*(this.a1x*this.r1y-this.a1y*this.r1x+this.a2x*this.r2y-this.a2y*this.r2x),this.invMotorDenom=1/this.motorDenom,l&&2!=this.limitState){var x=6.2831853*r,d=x*x*t,f=i/(d+2*this.limitMotor.dampingRatio*x);this.cfm=this.motorDenom*f,this.limitVelocity*=d*f}else this.cfm=0,this.limitVelocity*=.05*i;this.invDenom=1/(this.motorDenom+this.cfm);var b=this.limitImpulse+this.motorImpulse;this.l1.x+=b*this.l1x,this.l1.y+=b*this.l1y,this.l1.z+=b*this.l1z,this.a1.x+=b*this.a1x,this.a1.y+=b*this.a1y,this.a1.z+=b*this.a1z,this.l2.x-=b*this.l2x,this.l2.y-=b*this.l2y,this.l2.z-=b*this.l2z,this.a2.x-=b*this.a2x,this.a2.y-=b*this.a2y,this.a2.z-=b*this.a2z},solve:function(){var t,i,s=this.ax*(this.l2.x-this.l1.x)+this.ay*(this.l2.y-this.l1.y)+this.az*(this.l2.z-this.l1.z)+this.t2x*this.a2.x-this.t1x*this.a1.x+this.t2y*this.a2.y-this.t1y*this.a1.y+this.t2z*this.a2.z-this.t1z*this.a1.z;if(this.enableMotor){t=(s-this.motorSpeed)*this.invMotorDenom;var h=this.motorImpulse;this.motorImpulse+=t,this.motorImpulse>this.maxMotorImpulse?this.motorImpulse=this.maxMotorImpulse:this.motorImpulse<-this.maxMotorImpulse&&(this.motorImpulse=-this.maxMotorImpulse),s-=(t=this.motorImpulse-h)*this.motorDenom}else t=0;if(2!=this.limitState){i=(s-this.limitVelocity-this.limitImpulse*this.cfm)*this.invDenom;var e=this.limitImpulse;this.limitImpulse+=i,this.limitImpulse*this.limitState<0&&(this.limitImpulse=0),i=this.limitImpulse-e}else i=0;var a=i+t;this.l1.x+=a*this.l1x,this.l1.y+=a*this.l1y,this.l1.z+=a*this.l1z,this.a1.x+=a*this.a1x,this.a1.y+=a*this.a1y,this.a1.z+=a*this.a1z,this.l2.x-=a*this.l2x,this.l2.y-=a*this.l2y,this.l2.z-=a*this.l2z,this.a2.x-=a*this.a2x,this.a2.y-=a*this.a2y,this.a2.z-=a*this.a2z}}),ht.prototype=Object.assign(Object.create(Z.prototype),{constructor:ht,preSolve:function(t,i){this.updateAnchorPoints(),this.nor.sub(this.anchorPoint2,this.anchorPoint1).normalize(),this.t.preSolve(t,i)},solve:function(){this.t.solve()},postSolve:function(){}}),Object.assign(et.prototype,{AngularConstraint:!0,preSolve:function(t,i){var s,h,e;this.ii1=this.i1.clone(),this.ii2=this.i2.clone(),s=1/((e=(new B).add(this.ii1,this.ii2).elements)[0]*(e[4]*e[8]-e[7]*e[5])+e[3]*(e[7]*e[2]-e[1]*e[8])+e[6]*(e[1]*e[5]-e[4]*e[2])),this.dd=(new B).set(e[4]*e[8]-e[5]*e[7],e[2]*e[7]-e[1]*e[8],e[1]*e[5]-e[2]*e[4],e[5]*e[6]-e[3]*e[8],e[0]*e[8]-e[2]*e[6],e[2]*e[3]-e[0]*e[5],e[3]*e[7]-e[4]*e[6],e[1]*e[6]-e[0]*e[7],e[0]*e[4]-e[1]*e[3]).multiplyScalar(s),this.relativeOrientation.invert(this.b1.orientation).multiply(this.targetOrientation).multiply(this.b2.orientation),s=2*this.relativeOrientation.w,this.vel.copy(this.relativeOrientation).multiplyScalar(s),(h=this.vel.length())>.02?(h=(.02-h)/h*i*.05,this.vel.multiplyScalar(h)):this.vel.set(0,0,0),this.rn1.copy(this.imp).applyMatrix3(this.ii1,!0),this.rn2.copy(this.imp).applyMatrix3(this.ii2,!0),this.a1.add(this.rn1),this.a2.sub(this.rn2)},solve:function(){var t=this.a2.clone().sub(this.a1).sub(this.vel);this.rn0.copy(t).applyMatrix3(this.dd,!0),this.rn1.copy(this.rn0).applyMatrix3(this.ii1,!0),this.rn2.copy(this.rn0).applyMatrix3(this.ii2,!0),this.imp.add(this.rn0),this.a1.add(this.rn1),this.a2.sub(this.rn2)}}),Object.assign(at.prototype,{Translational3Constraint:!0,preSolve:function(t,i){this.ax1=this.limitMotor1.axis.x,this.ay1=this.limitMotor1.axis.y,this.az1=this.limitMotor1.axis.z,this.ax2=this.limitMotor2.axis.x,this.ay2=this.limitMotor2.axis.y,this.az2=this.limitMotor2.axis.z,this.ax3=this.limitMotor3.axis.x,this.ay3=this.limitMotor3.axis.y,this.az3=this.limitMotor3.axis.z,this.lowerLimit1=this.limitMotor1.lowerLimit,this.upperLimit1=this.limitMotor1.upperLimit,this.motorSpeed1=this.limitMotor1.motorSpeed,this.maxMotorForce1=this.limitMotor1.maxMotorForce,this.enableMotor1=this.maxMotorForce1>0,this.lowerLimit2=this.limitMotor2.lowerLimit,this.upperLimit2=this.limitMotor2.upperLimit,this.motorSpeed2=this.limitMotor2.motorSpeed,this.maxMotorForce2=this.limitMotor2.maxMotorForce,this.enableMotor2=this.maxMotorForce2>0,this.lowerLimit3=this.limitMotor3.lowerLimit,this.upperLimit3=this.limitMotor3.upperLimit,this.motorSpeed3=this.limitMotor3.motorSpeed,this.maxMotorForce3=this.limitMotor3.maxMotorForce,this.enableMotor3=this.maxMotorForce3>0,this.m1=this.b1.inverseMass,this.m2=this.b2.inverseMass;var s=this.i1.elements,h=this.i2.elements;this.i1e00=s[0],this.i1e01=s[1],this.i1e02=s[2],this.i1e10=s[3],this.i1e11=s[4],this.i1e12=s[5],this.i1e20=s[6],this.i1e21=s[7],this.i1e22=s[8],this.i2e00=h[0],this.i2e01=h[1],this.i2e02=h[2],this.i2e10=h[3],this.i2e11=h[4],this.i2e12=h[5],this.i2e20=h[6],this.i2e21=h[7],this.i2e22=h[8];var e=this.p2.x-this.p1.x,a=this.p2.y-this.p1.y,o=this.p2.z-this.p1.z,n=e*this.ax1+a*this.ay1+o*this.az1,r=e*this.ax2+a*this.ay2+o*this.az2,l=e*this.ax3+a*this.ay3+o*this.az3,c=this.limitMotor1.frequency,m=this.limitMotor2.frequency,p=this.limitMotor3.frequency,u=c>0,y=m>0,x=p>0,d=this.lowerLimit1<=this.upperLimit1,f=this.lowerLimit2<=this.upperLimit2,b=this.lowerLimit3<=this.upperLimit3;(u&&n>20||n<-20)&&(u=!1),(y&&r>20||r<-20)&&(y=!1),(x&&l>20||l<-20)&&(x=!1),d?(this.lowerLimit1==this.upperLimit1?(0!=this.limitState1&&(this.limitState1=0,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-n,u||(n=this.lowerLimit1)):n<this.lowerLimit1?(-1!=this.limitState1&&(this.limitState1=-1,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-n,u||(n=this.lowerLimit1)):n>this.upperLimit1?(1!=this.limitState1&&(this.limitState1=1,this.limitImpulse1=0),this.limitVelocity1=this.upperLimit1-n,u||(n=this.upperLimit1)):(this.limitState1=2,this.limitImpulse1=0,this.limitVelocity1=0),u||(this.limitVelocity1>.005?this.limitVelocity1-=.005:this.limitVelocity1<-.005?this.limitVelocity1+=.005:this.limitVelocity1=0)):(this.limitState1=2,this.limitImpulse1=0),f?(this.lowerLimit2==this.upperLimit2?(0!=this.limitState2&&(this.limitState2=0,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-r,y||(r=this.lowerLimit2)):r<this.lowerLimit2?(-1!=this.limitState2&&(this.limitState2=-1,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-r,y||(r=this.lowerLimit2)):r>this.upperLimit2?(1!=this.limitState2&&(this.limitState2=1,this.limitImpulse2=0),this.limitVelocity2=this.upperLimit2-r,y||(r=this.upperLimit2)):(this.limitState2=2,this.limitImpulse2=0,this.limitVelocity2=0),y||(this.limitVelocity2>.005?this.limitVelocity2-=.005:this.limitVelocity2<-.005?this.limitVelocity2+=.005:this.limitVelocity2=0)):(this.limitState2=2,this.limitImpulse2=0),b?(this.lowerLimit3==this.upperLimit3?(0!=this.limitState3&&(this.limitState3=0,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-l,x||(l=this.lowerLimit3)):l<this.lowerLimit3?(-1!=this.limitState3&&(this.limitState3=-1,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-l,x||(l=this.lowerLimit3)):l>this.upperLimit3?(1!=this.limitState3&&(this.limitState3=1,this.limitImpulse3=0),this.limitVelocity3=this.upperLimit3-l,x||(l=this.upperLimit3)):(this.limitState3=2,this.limitImpulse3=0,this.limitVelocity3=0),x||(this.limitVelocity3>.005?this.limitVelocity3-=.005:this.limitVelocity3<-.005?this.limitVelocity3+=.005:this.limitVelocity3=0)):(this.limitState3=2,this.limitImpulse3=0),this.enableMotor1&&(0!=this.limitState1||u)?this.maxMotorImpulse1=this.maxMotorForce1*t:(this.motorImpulse1=0,this.maxMotorImpulse1=0),this.enableMotor2&&(0!=this.limitState2||y)?this.maxMotorImpulse2=this.maxMotorForce2*t:(this.motorImpulse2=0,this.maxMotorImpulse2=0),this.enableMotor3&&(0!=this.limitState3||x)?this.maxMotorImpulse3=this.maxMotorForce3*t:(this.motorImpulse3=0,this.maxMotorImpulse3=0);var v=n*this.ax1+r*this.ax2+l*this.ax2,z=n*this.ay1+r*this.ay2+l*this.ay2,N=n*this.az1+r*this.az2+l*this.az2,k=this.m2/(this.m1+this.m2);this.weight>=0&&(k=this.weight);var w=1-k;this.r1x=this.r1.x+v*k,this.r1y=this.r1.y+z*k,this.r1z=this.r1.z+N*k,this.r2x=this.r2.x-v*w,this.r2y=this.r2.y-z*w,this.r2z=this.r2.z-N*w,this.t1x1=this.r1y*this.az1-this.r1z*this.ay1,this.t1y1=this.r1z*this.ax1-this.r1x*this.az1,this.t1z1=this.r1x*this.ay1-this.r1y*this.ax1,this.t2x1=this.r2y*this.az1-this.r2z*this.ay1,this.t2y1=this.r2z*this.ax1-this.r2x*this.az1,this.t2z1=this.r2x*this.ay1-this.r2y*this.ax1,this.l1x1=this.ax1*this.m1,this.l1y1=this.ay1*this.m1,this.l1z1=this.az1*this.m1,this.l2x1=this.ax1*this.m2,this.l2y1=this.ay1*this.m2,this.l2z1=this.az1*this.m2,this.a1x1=this.t1x1*this.i1e00+this.t1y1*this.i1e01+this.t1z1*this.i1e02,this.a1y1=this.t1x1*this.i1e10+this.t1y1*this.i1e11+this.t1z1*this.i1e12,this.a1z1=this.t1x1*this.i1e20+this.t1y1*this.i1e21+this.t1z1*this.i1e22,this.a2x1=this.t2x1*this.i2e00+this.t2y1*this.i2e01+this.t2z1*this.i2e02,this.a2y1=this.t2x1*this.i2e10+this.t2y1*this.i2e11+this.t2z1*this.i2e12,this.a2z1=this.t2x1*this.i2e20+this.t2y1*this.i2e21+this.t2z1*this.i2e22,this.t1x2=this.r1y*this.az2-this.r1z*this.ay2,this.t1y2=this.r1z*this.ax2-this.r1x*this.az2,this.t1z2=this.r1x*this.ay2-this.r1y*this.ax2,this.t2x2=this.r2y*this.az2-this.r2z*this.ay2,this.t2y2=this.r2z*this.ax2-this.r2x*this.az2,this.t2z2=this.r2x*this.ay2-this.r2y*this.ax2,this.l1x2=this.ax2*this.m1,this.l1y2=this.ay2*this.m1,this.l1z2=this.az2*this.m1,this.l2x2=this.ax2*this.m2,this.l2y2=this.ay2*this.m2,this.l2z2=this.az2*this.m2,this.a1x2=this.t1x2*this.i1e00+this.t1y2*this.i1e01+this.t1z2*this.i1e02,this.a1y2=this.t1x2*this.i1e10+this.t1y2*this.i1e11+this.t1z2*this.i1e12,this.a1z2=this.t1x2*this.i1e20+this.t1y2*this.i1e21+this.t1z2*this.i1e22,this.a2x2=this.t2x2*this.i2e00+this.t2y2*this.i2e01+this.t2z2*this.i2e02,this.a2y2=this.t2x2*this.i2e10+this.t2y2*this.i2e11+this.t2z2*this.i2e12,this.a2z2=this.t2x2*this.i2e20+this.t2y2*this.i2e21+this.t2z2*this.i2e22,this.t1x3=this.r1y*this.az3-this.r1z*this.ay3,this.t1y3=this.r1z*this.ax3-this.r1x*this.az3,this.t1z3=this.r1x*this.ay3-this.r1y*this.ax3,this.t2x3=this.r2y*this.az3-this.r2z*this.ay3,this.t2y3=this.r2z*this.ax3-this.r2x*this.az3,this.t2z3=this.r2x*this.ay3-this.r2y*this.ax3,this.l1x3=this.ax3*this.m1,this.l1y3=this.ay3*this.m1,this.l1z3=this.az3*this.m1,this.l2x3=this.ax3*this.m2,this.l2y3=this.ay3*this.m2,this.l2z3=this.az3*this.m2,this.a1x3=this.t1x3*this.i1e00+this.t1y3*this.i1e01+this.t1z3*this.i1e02,this.a1y3=this.t1x3*this.i1e10+this.t1y3*this.i1e11+this.t1z3*this.i1e12,this.a1z3=this.t1x3*this.i1e20+this.t1y3*this.i1e21+this.t1z3*this.i1e22,this.a2x3=this.t2x3*this.i2e00+this.t2y3*this.i2e01+this.t2z3*this.i2e02,this.a2y3=this.t2x3*this.i2e10+this.t2y3*this.i2e11+this.t2z3*this.i2e12,this.a2z3=this.t2x3*this.i2e20+this.t2y3*this.i2e21+this.t2z3*this.i2e22;var g=this.m1+this.m2;if(this.k00=(this.ax1*this.ax1+this.ay1*this.ay1+this.az1*this.az1)*g,this.k01=(this.ax1*this.ax2+this.ay1*this.ay2+this.az1*this.az2)*g,this.k02=(this.ax1*this.ax3+this.ay1*this.ay3+this.az1*this.az3)*g,this.k10=(this.ax2*this.ax1+this.ay2*this.ay1+this.az2*this.az1)*g,this.k11=(this.ax2*this.ax2+this.ay2*this.ay2+this.az2*this.az2)*g,this.k12=(this.ax2*this.ax3+this.ay2*this.ay3+this.az2*this.az3)*g,this.k20=(this.ax3*this.ax1+this.ay3*this.ay1+this.az3*this.az1)*g,this.k21=(this.ax3*this.ax2+this.ay3*this.ay2+this.az3*this.az2)*g,this.k22=(this.ax3*this.ax3+this.ay3*this.ay3+this.az3*this.az3)*g,this.k00+=this.t1x1*this.a1x1+this.t1y1*this.a1y1+this.t1z1*this.a1z1,this.k01+=this.t1x1*this.a1x2+this.t1y1*this.a1y2+this.t1z1*this.a1z2,this.k02+=this.t1x1*this.a1x3+this.t1y1*this.a1y3+this.t1z1*this.a1z3,this.k10+=this.t1x2*this.a1x1+this.t1y2*this.a1y1+this.t1z2*this.a1z1,this.k11+=this.t1x2*this.a1x2+this.t1y2*this.a1y2+this.t1z2*this.a1z2,this.k12+=this.t1x2*this.a1x3+this.t1y2*this.a1y3+this.t1z2*this.a1z3,this.k20+=this.t1x3*this.a1x1+this.t1y3*this.a1y1+this.t1z3*this.a1z1,this.k21+=this.t1x3*this.a1x2+this.t1y3*this.a1y2+this.t1z3*this.a1z2,this.k22+=this.t1x3*this.a1x3+this.t1y3*this.a1y3+this.t1z3*this.a1z3,this.k00+=this.t2x1*this.a2x1+this.t2y1*this.a2y1+this.t2z1*this.a2z1,this.k01+=this.t2x1*this.a2x2+this.t2y1*this.a2y2+this.t2z1*this.a2z2,this.k02+=this.t2x1*this.a2x3+this.t2y1*this.a2y3+this.t2z1*this.a2z3,this.k10+=this.t2x2*this.a2x1+this.t2y2*this.a2y1+this.t2z2*this.a2z1,this.k11+=this.t2x2*this.a2x2+this.t2y2*this.a2y2+this.t2z2*this.a2z2,this.k12+=this.t2x2*this.a2x3+this.t2y2*this.a2y3+this.t2z2*this.a2z3,this.k20+=this.t2x3*this.a2x1+this.t2y3*this.a2y1+this.t2z3*this.a2z1,this.k21+=this.t2x3*this.a2x2+this.t2y3*this.a2y2+this.t2z3*this.a2z2,this.k22+=this.t2x3*this.a2x3+this.t2y3*this.a2y3+this.t2z3*this.a2z3,this.kv00=this.k00,this.kv11=this.k11,this.kv22=this.k22,this.dv00=1/this.kv00,this.dv11=1/this.kv11,this.dv22=1/this.kv22,u&&2!=this.limitState1){var M=6.2831853*c,I=M*M*t,V=i/(I+2*this.limitMotor1.dampingRatio*M);this.cfm1=this.kv00*V,this.limitVelocity1*=I*V}else this.cfm1=0,this.limitVelocity1*=.05*i;y&&2!=this.limitState2?(V=i/((I=(M=6.2831853*m)*M*t)+2*this.limitMotor2.dampingRatio*M),this.cfm2=this.kv11*V,this.limitVelocity2*=I*V):(this.cfm2=0,this.limitVelocity2*=.05*i),x&&2!=this.limitState3?(V=i/((I=(M=6.2831853*p)*M*t)+2*this.limitMotor3.dampingRatio*M),this.cfm3=this.kv22*V,this.limitVelocity3*=I*V):(this.cfm3=0,this.limitVelocity3*=.05*i),this.k00+=this.cfm1,this.k11+=this.cfm2,this.k22+=this.cfm3;var S=1/(this.k00*(this.k11*this.k22-this.k21*this.k12)+this.k10*(this.k21*this.k02-this.k01*this.k22)+this.k20*(this.k01*this.k12-this.k11*this.k02));this.d00=(this.k11*this.k22-this.k12*this.k21)*S,this.d01=(this.k02*this.k21-this.k01*this.k22)*S,this.d02=(this.k01*this.k12-this.k02*this.k11)*S,this.d10=(this.k12*this.k20-this.k10*this.k22)*S,this.d11=(this.k00*this.k22-this.k02*this.k20)*S,this.d12=(this.k02*this.k10-this.k00*this.k12)*S,this.d20=(this.k10*this.k21-this.k11*this.k20)*S,this.d21=(this.k01*this.k20-this.k00*this.k21)*S,this.d22=(this.k00*this.k11-this.k01*this.k10)*S;var L=this.limitImpulse1+this.motorImpulse1,P=this.limitImpulse2+this.motorImpulse2,T=this.limitImpulse3+this.motorImpulse3;this.l1.x+=L*this.l1x1+P*this.l1x2+T*this.l1x3,this.l1.y+=L*this.l1y1+P*this.l1y2+T*this.l1y3,this.l1.z+=L*this.l1z1+P*this.l1z2+T*this.l1z3,this.a1.x+=L*this.a1x1+P*this.a1x2+T*this.a1x3,this.a1.y+=L*this.a1y1+P*this.a1y2+T*this.a1y3,this.a1.z+=L*this.a1z1+P*this.a1z2+T*this.a1z3,this.l2.x-=L*this.l2x1+P*this.l2x2+T*this.l2x3,this.l2.y-=L*this.l2y1+P*this.l2y2+T*this.l2y3,this.l2.z-=L*this.l2z1+P*this.l2z2+T*this.l2z3,this.a2.x-=L*this.a2x1+P*this.a2x2+T*this.a2x3,this.a2.y-=L*this.a2y1+P*this.a2y2+T*this.a2y3,this.a2.z-=L*this.a2z1+P*this.a2z2+T*this.a2z3},solve:function(){var t=this.l2.x-this.l1.x+this.a2.y*this.r2z-this.a2.z*this.r2y-this.a1.y*this.r1z+this.a1.z*this.r1y,i=this.l2.y-this.l1.y+this.a2.z*this.r2x-this.a2.x*this.r2z-this.a1.z*this.r1x+this.a1.x*this.r1z,s=this.l2.z-this.l1.z+this.a2.x*this.r2y-this.a2.y*this.r2x-this.a1.x*this.r1y+this.a1.y*this.r1x,h=t*this.ax1+i*this.ay1+s*this.az1,e=t*this.ax2+i*this.ay2+s*this.az2,a=t*this.ax3+i*this.ay3+s*this.az3,o=this.motorImpulse1,n=this.motorImpulse2,r=this.motorImpulse3,l=0,c=0,m=0;this.enableMotor1&&(l=(h-this.motorSpeed1)*this.dv00,this.motorImpulse1+=l,this.motorImpulse1>this.maxMotorImpulse1?this.motorImpulse1=this.maxMotorImpulse1:this.motorImpulse1<-this.maxMotorImpulse1&&(this.motorImpulse1=-this.maxMotorImpulse1),l=this.motorImpulse1-o),this.enableMotor2&&(c=(e-this.motorSpeed2)*this.dv11,this.motorImpulse2+=c,this.motorImpulse2>this.maxMotorImpulse2?this.motorImpulse2=this.maxMotorImpulse2:this.motorImpulse2<-this.maxMotorImpulse2&&(this.motorImpulse2=-this.maxMotorImpulse2),c=this.motorImpulse2-n),this.enableMotor3&&(m=(a-this.motorSpeed3)*this.dv22,this.motorImpulse3+=m,this.motorImpulse3>this.maxMotorImpulse3?this.motorImpulse3=this.maxMotorImpulse3:this.motorImpulse3<-this.maxMotorImpulse3&&(this.motorImpulse3=-this.maxMotorImpulse3),m=this.motorImpulse3-r),h+=l*this.kv00+c*this.k01+m*this.k02,e+=l*this.k10+c*this.kv11+m*this.k12,a+=l*this.k20+c*this.k21+m*this.kv22,h-=this.limitVelocity1+this.limitImpulse1*this.cfm1,e-=this.limitVelocity2+this.limitImpulse2*this.cfm2,a-=this.limitVelocity3+this.limitImpulse3*this.cfm3;var p=this.limitImpulse1,u=this.limitImpulse2,y=this.limitImpulse3,x=h*this.d00+e*this.d01+a*this.d02,d=h*this.d10+e*this.d11+a*this.d12,f=h*this.d20+e*this.d21+a*this.d22;this.limitImpulse1+=x,this.limitImpulse2+=d,this.limitImpulse3+=f;var b,v=0;switch((2==this.limitState1||this.limitImpulse1*this.limitState1<0)&&(e+=(x=-p)*this.k10,a+=x*this.k20,v|=1),(2==this.limitState2||this.limitImpulse2*this.limitState2<0)&&(h+=(d=-u)*this.k01,a+=d*this.k21,v|=2),(2==this.limitState3||this.limitImpulse3*this.limitState3<0)&&(h+=(f=-y)*this.k02,e+=f*this.k12,v|=4),v){case 1:b=1/(this.k11*this.k22-this.k12*this.k21),d=(this.k22*e+-this.k12*a)*b,f=(-this.k21*e+this.k11*a)*b;break;case 2:b=1/(this.k00*this.k22-this.k02*this.k20),x=(this.k22*h+-this.k02*a)*b,f=(-this.k20*h+this.k00*a)*b;break;case 3:f=a/this.k22;break;case 4:b=1/(this.k00*this.k11-this.k01*this.k10),x=(this.k11*h+-this.k01*e)*b,d=(-this.k10*h+this.k00*e)*b;break;case 5:d=e/this.k11;break;case 6:x=h/this.k00}this.limitImpulse1=p+x,this.limitImpulse2=u+d,this.limitImpulse3=y+f;var z=l+x,N=c+d,k=m+f;this.l1.x+=z*this.l1x1+N*this.l1x2+k*this.l1x3,this.l1.y+=z*this.l1y1+N*this.l1y2+k*this.l1y3,this.l1.z+=z*this.l1z1+N*this.l1z2+k*this.l1z3,this.a1.x+=z*this.a1x1+N*this.a1x2+k*this.a1x3,this.a1.y+=z*this.a1y1+N*this.a1y2+k*this.a1y3,this.a1.z+=z*this.a1z1+N*this.a1z2+k*this.a1z3,this.l2.x-=z*this.l2x1+N*this.l2x2+k*this.l2x3,this.l2.y-=z*this.l2y1+N*this.l2y2+k*this.l2y3,this.l2.z-=z*this.l2z1+N*this.l2z2+k*this.l2z3,this.a2.x-=z*this.a2x1+N*this.a2x2+k*this.a2x3,this.a2.y-=z*this.a2y1+N*this.a2y2+k*this.a2y3,this.a2.z-=z*this.a2z1+N*this.a2z2+k*this.a2z3}}),ot.prototype=Object.assign(Object.create(Z.prototype),{constructor:ot,preSolve:function(t,i){this.updateAnchorPoints(),this.ax1.copy(this.localAxis1).applyMatrix3(this.body1.rotation,!0),this.ax2.copy(this.localAxis2).applyMatrix3(this.body2.rotation,!0),this.nor.set(this.ax1.x*this.body2.inverseMass+this.ax2.x*this.body1.inverseMass,this.ax1.y*this.body2.inverseMass+this.ax2.y*this.body1.inverseMass,this.ax1.z*this.body2.inverseMass+this.ax2.z*this.body1.inverseMass).normalize(),this.tan.tangent(this.nor).normalize(),this.bin.crossVectors(this.nor,this.tan),this.ac.preSolve(t,i),this.t3.preSolve(t,i)},solve:function(){this.ac.solve(),this.t3.solve()},postSolve:function(){}}),nt.prototype=Object.assign(Object.create(Z.prototype),{constructor:nt,preSolve:function(t,i){this.updateAnchorPoints(),this.ax1.copy(this.localAxis1).applyMatrix3(this.body1.rotation,!0),this.an1.copy(this.localAngle1).applyMatrix3(this.body1.rotation,!0),this.ax2.copy(this.localAxis2).applyMatrix3(this.body2.rotation,!0),this.an2.copy(this.localAngle2).applyMatrix3(this.body2.rotation,!0),this.nor.set(this.ax1.x*this.body2.inverseMass+this.ax2.x*this.body1.inverseMass,this.ax1.y*this.body2.inverseMass+this.ax2.y*this.body1.inverseMass,this.ax1.z*this.body2.inverseMass+this.ax2.z*this.body1.inverseMass).normalize(),this.tan.tangent(this.nor).normalize(),this.bin.crossVectors(this.nor,this.tan),this.tmp.crossVectors(this.an1,this.an2);var s=O.acosClamp(O.dotVectors(this.an1,this.an2));O.dotVectors(this.nor,this.tmp)<0?this.rotationalLimitMotor.angle=-s:this.rotationalLimitMotor.angle=s,this.tmp.crossVectors(this.ax1,this.ax2),this.r3.limitMotor2.angle=O.dotVectors(this.tan,this.tmp),this.r3.limitMotor3.angle=O.dotVectors(this.bin,this.tmp),this.r3.preSolve(t,i),this.t3.preSolve(t,i)},solve:function(){this.r3.solve(),this.t3.solve()},postSolve:function(){}}),rt.prototype=Object.assign(Object.create(Z.prototype),{constructor:rt,preSolve:function(t,i){this.updateAnchorPoints(),this.ax1.copy(this.localAxis1).applyMatrix3(this.body1.rotation,!0),this.an1.copy(this.localAngle1).applyMatrix3(this.body1.rotation,!0),this.ax2.copy(this.localAxis2).applyMatrix3(this.body2.rotation,!0),this.an2.copy(this.localAngle2).applyMatrix3(this.body2.rotation,!0),this.r3.limitMotor1.angle=O.dotVectors(this.ax1,this.ax2);var s=O.dotVectors(this.an1,this.ax2);O.dotVectors(this.ax1,this.tmp.crossVectors(this.an1,this.ax2))<0?this.rotationalLimitMotor1.angle=-s:this.rotationalLimitMotor1.angle=s,s=O.dotVectors(this.an2,this.ax1),O.dotVectors(this.ax2,this.tmp.crossVectors(this.an2,this.ax1))<0?this.rotationalLimitMotor2.angle=-s:this.rotationalLimitMotor2.angle=s,this.nor.crossVectors(this.ax1,this.ax2).normalize(),this.tan.crossVectors(this.nor,this.ax2).normalize(),this.bin.crossVectors(this.nor,this.ax1).normalize(),this.r3.preSolve(t,i),this.t3.preSolve(t,i)},solve:function(){this.r3.solve(),this.t3.solve()},postSolve:function(){}}),yt.prototype={constructor:yt,reset:function(t,i){this.body1=t.parent,this.body2=i.parent,this.numPoints=0},addPointVec:function(t,i,s,h){var e=this.points[this.numPoints++];e.position.copy(t),e.localPoint1.sub(t,this.body1.position).applyMatrix3(this.body1.rotation),e.localPoint2.sub(t,this.body2.position).applyMatrix3(this.body2.rotation),e.normal.copy(i),h&&e.normal.negate(),e.normalImpulse=0,e.penetration=s,e.warmStarted=!1},addPoint:function(t,i,s,h,e,a,o,n){var r=this.points[this.numPoints++];r.position.set(t,i,s),r.localPoint1.sub(r.position,this.body1.position).applyMatrix3(this.body1.rotation),r.localPoint2.sub(r.position,this.body2.position).applyMatrix3(this.body2.rotation),r.normalImpulse=0,r.normal.set(h,e,a),n&&r.normal.negate(),r.penetration=o,r.warmStarted=!1}},dt.prototype=Object.assign(Object.create(X.prototype),{constructor:dt,attach:function(){this.p1=this.body1.position,this.p2=this.body2.position,this.lv1=this.body1.linearVelocity,this.av1=this.body1.angularVelocity,this.lv2=this.body2.linearVelocity,this.av2=this.body2.angularVelocity,this.i1=this.body1.inverseInertia,this.i2=this.body2.inverseInertia},detach:function(){this.p1=null,this.p2=null,this.lv1=null,this.lv2=null,this.av1=null,this.av2=null,this.i1=null,this.i2=null},preSolve:function(t,i){this.m1=this.body1.inverseMass,this.m2=this.body2.inverseMass;var s=this.m1+this.m2;this.num=this.manifold.numPoints;for(var h,e,a,o,n,r,l,c=this.cs,m=0;m<this.num;m++)h=this.ps[m],this.tmpP1.sub(h.position,this.p1),this.tmpP2.sub(h.position,this.p2),this.tmpC1.crossVectors(this.av1,this.tmpP1),this.tmpC2.crossVectors(this.av2,this.tmpP2),c.norImp=h.normalImpulse,c.tanImp=h.tangentImpulse,c.binImp=h.binormalImpulse,c.nor.copy(h.normal),this.tmp.set(this.lv2.x+this.tmpC2.x-(this.lv1.x+this.tmpC1.x),this.lv2.y+this.tmpC2.y-(this.lv1.y+this.tmpC1.y),this.lv2.z+this.tmpC2.z-(this.lv1.z+this.tmpC1.z)),e=O.dotVectors(c.nor,this.tmp),c.tan.set(this.tmp.x-e*c.nor.x,this.tmp.y-e*c.nor.y,this.tmp.z-e*c.nor.z),O.dotVectors(c.tan,c.tan)<=.04&&c.tan.tangent(c.nor),c.tan.normalize(),c.bin.crossVectors(c.nor,c.tan),c.norU1.scale(c.nor,this.m1),c.norU2.scale(c.nor,this.m2),c.tanU1.scale(c.tan,this.m1),c.tanU2.scale(c.tan,this.m2),c.binU1.scale(c.bin,this.m1),c.binU2.scale(c.bin,this.m2),c.norT1.crossVectors(this.tmpP1,c.nor),c.tanT1.crossVectors(this.tmpP1,c.tan),c.binT1.crossVectors(this.tmpP1,c.bin),c.norT2.crossVectors(this.tmpP2,c.nor),c.tanT2.crossVectors(this.tmpP2,c.tan),c.binT2.crossVectors(this.tmpP2,c.bin),r=this.i1,l=this.i2,c.norTU1.copy(c.norT1).applyMatrix3(r,!0),c.tanTU1.copy(c.tanT1).applyMatrix3(r,!0),c.binTU1.copy(c.binT1).applyMatrix3(r,!0),c.norTU2.copy(c.norT2).applyMatrix3(l,!0),c.tanTU2.copy(c.tanT2).applyMatrix3(l,!0),c.binTU2.copy(c.binT2).applyMatrix3(l,!0),this.tmpC1.crossVectors(c.norTU1,this.tmpP1),this.tmpC2.crossVectors(c.norTU2,this.tmpP2),this.tmp.add(this.tmpC1,this.tmpC2),c.norDen=1/(s+O.dotVectors(c.nor,this.tmp)),this.tmpC1.crossVectors(c.tanTU1,this.tmpP1),this.tmpC2.crossVectors(c.tanTU2,this.tmpP2),this.tmp.add(this.tmpC1,this.tmpC2),c.tanDen=1/(s+O.dotVectors(c.tan,this.tmp)),this.tmpC1.crossVectors(c.binTU1,this.tmpP1),this.tmpC2.crossVectors(c.binTU2,this.tmpP2),this.tmp.add(this.tmpC1,this.tmpC2),c.binDen=1/(s+O.dotVectors(c.bin,this.tmp)),h.warmStarted?(a=h.normalImpulse,this.lv1.addScaledVector(c.norU1,a),this.av1.addScaledVector(c.norTU1,a),this.lv2.subScaledVector(c.norU2,a),this.av2.subScaledVector(c.norTU2,a),c.norImp=a,c.tanImp=0,c.binImp=0,e=0):(c.norImp=0,c.tanImp=0,c.binImp=0),e>-1&&(e=0),(o=this.restitution*-e)<(n=-(h.penetration+.005)*i*.05)&&(o=n),c.norTar=o,c.last=m==this.num-1,c=c.next},solve:function(){var t,i,s,h,e,a,o,n,r;this.tmplv1.copy(this.lv1),this.tmplv2.copy(this.lv2),this.tmpav1.copy(this.av1),this.tmpav2.copy(this.av2);for(var l=this.cs;e=l.norImp,a=l.tanImp,o=l.binImp,n=-e*this.friction,this.tmp.sub(this.tmplv2,this.tmplv1),t=a,s=o,(r=(a+=i=(O.dotVectors(this.tmp,l.tan)+O.dotVectors(this.tmpav2,l.tanT2)-O.dotVectors(this.tmpav1,l.tanT1))*l.tanDen)*a+(o+=h=(O.dotVectors(this.tmp,l.bin)+O.dotVectors(this.tmpav2,l.binT2)-O.dotVectors(this.tmpav1,l.binT1))*l.binDen)*o)>n*n&&(a*=r=n/O.sqrt(r),o*=r),i=a-t,h=o-s,this.tmp.set(l.tanU1.x*i+l.binU1.x*h,l.tanU1.y*i+l.binU1.y*h,l.tanU1.z*i+l.binU1.z*h),this.tmplv1.addEqual(this.tmp),this.tmp.set(l.tanTU1.x*i+l.binTU1.x*h,l.tanTU1.y*i+l.binTU1.y*h,l.tanTU1.z*i+l.binTU1.z*h),this.tmpav1.addEqual(this.tmp),this.tmp.set(l.tanU2.x*i+l.binU2.x*h,l.tanU2.y*i+l.binU2.y*h,l.tanU2.z*i+l.binU2.z*h),this.tmplv2.subEqual(this.tmp),this.tmp.set(l.tanTU2.x*i+l.binTU2.x*h,l.tanTU2.y*i+l.binTU2.y*h,l.tanTU2.z*i+l.binTU2.z*h),this.tmpav2.subEqual(this.tmp),this.tmp.sub(this.tmplv2,this.tmplv1),t=e,(e+=i=(O.dotVectors(this.tmp,l.nor)+O.dotVectors(this.tmpav2,l.norT2)-O.dotVectors(this.tmpav1,l.norT1)-l.norTar)*l.norDen)>0&&(e=0),i=e-t,this.tmplv1.addScaledVector(l.norU1,i),this.tmpav1.addScaledVector(l.norTU1,i),this.tmplv2.subScaledVector(l.norU2,i),this.tmpav2.subScaledVector(l.norTU2,i),l.norImp=e,l.tanImp=a,l.binImp=o,!l.last;)l=l.next;this.lv1.copy(this.tmplv1),this.lv2.copy(this.tmplv2),this.av1.copy(this.tmpav1),this.av2.copy(this.tmpav2)},postSolve:function(){for(var t,i=this.cs,s=this.num;s--;)(t=this.ps[s]).normal.copy(i.nor),t.tangent.copy(i.tan),t.binormal.copy(i.bin),t.normalImpulse=i.norImp,t.tangentImpulse=i.tanImp,t.binormalImpulse=i.binImp,t.normalDenominator=i.norDen,t.tangentDenominator=i.tanDen,t.binormalDenominator=i.binDen,i=i.next}}),Object.assign(ft.prototype,{Contact:!0,mixRestitution:function(t,i){return O.sqrt(t*i)},mixFriction:function(t,i){return O.sqrt(t*i)},updateManifold:function(){this.constraint.restitution=this.mixRestitution(this.shape1.restitution,this.shape2.restitution),this.constraint.friction=this.mixFriction(this.shape1.friction,this.shape2.friction);for(var t=this.manifold.numPoints,i=t;i--;){var s=this.buffer[i],h=this.points[i];s.lp1X=h.localPoint1.x,s.lp1Y=h.localPoint1.y,s.lp1Z=h.localPoint1.z,s.lp2X=h.localPoint2.x,s.lp2Y=h.localPoint2.y,s.lp2Z=h.localPoint2.z,s.impulse=h.normalImpulse}this.manifold.numPoints=0,this.detector.detectCollision(this.shape1,this.shape2,this.manifold);var e=this.manifold.numPoints;if(0==e)return this.touching=!1,this.close=!1,void(this.dist=O.INF);for((this.touching||this.dist<.001)&&(this.close=!0),this.touching=!0,i=e;i--;){for(var a=(h=this.points[i]).localPoint1.x,o=h.localPoint1.y,n=h.localPoint1.z,r=h.localPoint2.x,l=h.localPoint2.y,c=h.localPoint2.z,m=-1,p=4e-4,u=t;u--;){var y=(s=this.buffer[u]).lp1X-a,x=s.lp1Y-o,d=s.lp1Z-n,f=y*y+x*x+d*d,b=(y=s.lp2X-r)*y+(x=s.lp2Y-l)*x+(d=s.lp2Z-c)*d;f<b?f<p&&(p=f,m=u):b<p&&(p=b,m=u),p<this.dist&&(this.dist=p)}if(-1!=m){var v=this.buffer[m];this.buffer[m]=this.buffer[--t],this.buffer[t]=v,h.normalImpulse=v.impulse,h.warmStarted=!0}else h.normalImpulse=0,h.warmStarted=!1}},attach:function(t,i){this.shape1=t,this.shape2=i,this.body1=t.parent,this.body2=i.parent,this.manifold.body1=this.body1,this.manifold.body2=this.body2,this.constraint.body1=this.body1,this.constraint.body2=this.body2,this.constraint.attach(),this.s1Link.shape=i,this.s1Link.body=this.body2,this.s2Link.shape=t,this.s2Link.body=this.body1,null!=t.contactLink?(this.s1Link.next=t.contactLink).prev=this.s1Link:this.s1Link.next=null,t.contactLink=this.s1Link,t.numContacts++,null!=i.contactLink?(this.s2Link.next=i.contactLink).prev=this.s2Link:this.s2Link.next=null,i.contactLink=this.s2Link,i.numContacts++,this.b1Link.shape=i,this.b1Link.body=this.body2,this.b2Link.shape=t,this.b2Link.body=this.body1,null!=this.body1.contactLink?(this.b1Link.next=this.body1.contactLink).prev=this.b1Link:this.b1Link.next=null,this.body1.contactLink=this.b1Link,this.body1.numContacts++,null!=this.body2.contactLink?(this.b2Link.next=this.body2.contactLink).prev=this.b2Link:this.b2Link.next=null,this.body2.contactLink=this.b2Link,this.body2.numContacts++,this.prev=null,this.next=null,this.persisting=!0,this.sleeping=this.body1.sleeping&&this.body2.sleeping,this.manifold.numPoints=0},detach:function(){var t=this.s1Link.prev,i=this.s1Link.next;null!==t&&(t.next=i),null!==i&&(i.prev=t),this.shape1.contactLink==this.s1Link&&(this.shape1.contactLink=i),this.s1Link.prev=null,this.s1Link.next=null,this.s1Link.shape=null,this.s1Link.body=null,this.shape1.numContacts--,t=this.s2Link.prev,i=this.s2Link.next,null!==t&&(t.next=i),null!==i&&(i.prev=t),this.shape2.contactLink==this.s2Link&&(this.shape2.contactLink=i),this.s2Link.prev=null,this.s2Link.next=null,this.s2Link.shape=null,this.s2Link.body=null,this.shape2.numContacts--,t=this.b1Link.prev,i=this.b1Link.next,null!==t&&(t.next=i),null!==i&&(i.prev=t),this.body1.contactLink==this.b1Link&&(this.body1.contactLink=i),this.b1Link.prev=null,this.b1Link.next=null,this.b1Link.shape=null,this.b1Link.body=null,this.body1.numContacts--,t=this.b2Link.prev,i=this.b2Link.next,null!==t&&(t.next=i),null!==i&&(i.prev=t),this.body2.contactLink==this.b2Link&&(this.body2.contactLink=i),this.b2Link.prev=null,this.b2Link.next=null,this.b2Link.shape=null,this.b2Link.body=null,this.body2.numContacts--,this.manifold.body1=null,this.manifold.body2=null,this.constraint.body1=null,this.constraint.body2=null,this.constraint.detach(),this.shape1=null,this.shape2=null,this.body1=null,this.body2=null}}),Object.assign(bt.prototype,{setParent:function(t){this.parent=t,this.scale=this.parent.scale,this.invScale=this.parent.invScale,this.id=this.parent.numRigidBodies,this.name||(this.name=this.id),this.updateMesh()},addShape:function(t){t.parent&&j("RigidBody","It is not possible that you add a shape which already has an associated body."),null!=this.shapes&&((this.shapes.prev=t).next=this.shapes),this.shapes=t,t.parent=this,this.parent&&this.parent.addShape(t),this.numShapes++},removeShape:function(t){var i=t;if(i.parent==this){var s=i.prev,h=i.next;null!=s&&(s.next=h),null!=h&&(h.prev=s),this.shapes==i&&(this.shapes=h),i.prev=null,i.next=null,i.parent=null,this.parent&&this.parent.removeShape(i),this.numShapes--}},remove:function(){this.dispose()},dispose:function(){this.parent.removeRigidBody(this)},checkContact:function(t){this.parent.checkContact(this.name,t)},setupMass:function(t,i){var s=void 0===i||i;this.type=t||x,this.isDynamic=this.type===y,this.isStatic=this.type===x,this.mass=0,this.localInertia.set(0,0,0,0,0,0,0,0,0);for(var h=new B,e=new C,a=this.shapes;null!==a;a=a.next){a.calculateMassInfo(this.massInfo);var o=this.massInfo.mass;e.addScaledVector(a.relativePosition,o),this.mass+=o,this.rotateInertia(a.relativeRotation,this.massInfo.inertia,h),this.localInertia.add(h),this.localInertia.addOffset(o,a.relativePosition)}if(this.inverseMass=1/this.mass,e.scaleEqual(this.inverseMass),s){for(this.position.add(e),a=this.shapes;null!==a;a=a.next)a.relativePosition.subEqual(e);this.localInertia.subOffset(this.mass,e)}this.inverseLocalInertia.invert(this.localInertia),this.type===x&&(this.inverseMass=0,this.inverseLocalInertia.set(0,0,0,0,0,0,0,0,0)),this.syncShapes(),this.awake()},awake:function(){if(this.allowSleep&&this.sleeping){this.sleeping=!1,this.sleepTime=0;for(var t=this.contactLink;null!=t;)t.body.sleepTime=0,t.body.sleeping=!1,t=t.next;for(var i=this.jointLink;null!=i;)i.body.sleepTime=0,i.body.sleeping=!1,i=i.next;for(var s=this.shapes;null!=s;s=s.next)s.updateProxy()}},sleep:function(){if(this.allowSleep&&!this.sleeping){this.linearVelocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.sleepPosition.copy(this.position),this.sleepOrientation.copy(this.orientation),this.sleepTime=0,this.sleeping=!0;for(var t=this.shapes;null!=t;t=t.next)t.updateProxy()}},testWakeUp:function(){(this.linearVelocity.testZero()||this.angularVelocity.testZero()||this.position.testDiff(this.sleepPosition)||this.orientation.testDiff(this.sleepOrientation))&&this.awake()},isLonely:function(){return 0==this.numJoints&&0==this.numContacts},updatePosition:function(t){switch(this.type){case x:this.linearVelocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.controlPos&&(this.position.copy(this.newPosition),this.controlPos=!1),this.controlRot&&(this.orientation.copy(this.newOrientation),this.controlRot=!1);break;case y:this.isKinematic&&(this.linearVelocity.set(0,0,0),this.angularVelocity.set(0,0,0)),this.controlPos&&(this.linearVelocity.subVectors(this.newPosition,this.position).multiplyScalar(1/t),this.controlPos=!1),this.controlRot&&(this.angularVelocity.copy(this.getAxis()),this.orientation.copy(this.newOrientation),this.controlRot=!1),this.position.addScaledVector(this.linearVelocity,t),this.orientation.addTime(this.angularVelocity,t),this.updateMesh();break;default:j("RigidBody","Invalid type.")}this.syncShapes(),this.updateMesh()},getAxis:function(){return new C(0,1,0).applyMatrix3(this.inverseLocalInertia,!0).normalize()},rotateInertia:function(t,i,s){this.tmpInertia.multiplyMatrices(t,i),s.multiplyMatrices(this.tmpInertia,t,!0)},syncShapes:function(){this.rotation.setQuat(this.orientation),this.rotateInertia(this.rotation,this.inverseLocalInertia,this.inverseInertia);for(var t=this.shapes;null!=t;t=t.next)t.position.copy(t.relativePosition).applyMatrix3(this.rotation,!0).add(this.position),t.rotation.multiplyMatrices(this.rotation,t.relativeRotation),t.updateProxy()},applyImpulse:function(t,i){this.linearVelocity.addScaledVector(i,this.inverseMass);var s=(new C).copy(t).sub(this.position).cross(i).applyMatrix3(this.inverseInertia,!0);this.angularVelocity.add(s)},setPosition:function(t){this.newPosition.copy(t).multiplyScalar(this.invScale),this.controlPos=!0,this.isKinematic||(this.isKinematic=!0)},setQuaternion:function(t){this.newOrientation.set(t.x,t.y,t.z,t.w),this.controlRot=!0,this.isKinematic||(this.isKinematic=!0)},setRotation:function(t){this.newOrientation=(new E).setFromEuler(t.x*O.degtorad,t.y*O.degtorad,t.y*O.degtorad),this.controlRot=!0},resetPosition:function(t,i,s){this.linearVelocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.position.set(t,i,s).multiplyScalar(this.invScale),this.awake()},resetQuaternion:function(t){this.angularVelocity.set(0,0,0),this.orientation=new E(t.x,t.y,t.z,t.w),this.awake()},resetRotation:function(t,i,s){this.angularVelocity.set(0,0,0),this.orientation=(new E).setFromEuler(t*O.degtorad,i*O.degtorad,s*O.degtorad),this.awake()},getPosition:function(){return this.pos},getQuaternion:function(){return this.quaternion},connectMesh:function(t){this.mesh=t,this.updateMesh()},updateMesh:function(){this.pos.scale(this.position,this.scale),this.quaternion.copy(this.orientation),null!==this.mesh&&(this.mesh.position.copy(this.getPosition()),this.mesh.quaternion.copy(this.getQuaternion()))}}),Object.assign(zt.prototype,{BroadPhase:!0,createProxy:function(t){j("BroadPhase","Inheritance error.")},addProxy:function(t){j("BroadPhase","Inheritance error.")},removeProxy:function(t){j("BroadPhase","Inheritance error.")},isAvailablePair:function(t,i){var s,h=t.parent,e=i.parent;if(h==e||!h.isDynamic&&!e.isDynamic||0==(t.belongsTo&i.collidesWith)||0==(i.belongsTo&t.collidesWith))return!1;for(s=h.numJoints<e.numJoints?h.jointLink:e.jointLink;null!==s;){var a=s.joint;if(!a.allowCollision&&(a.body1==h&&a.body2==e||a.body1==e&&a.body2==h))return!1;s=s.next}return!0},detectPairs:function(){this.pairs=[],this.numPairs=0,this.numPairChecks=0,this.collectPairs()},collectPairs:function(){Error("BroadPhase","Inheritance error.")},addPair:function(t,i){var s=new vt(t,i);this.pairs.push(s),this.numPairs++}});var Nt=0;function kt(t){this.shape=t,this.aabb=t.aabb}function wt(t){kt.call(this,t),this.id=Nt++}function gt(){zt.call(this),this.types=c,this.proxies=[]}function Mt(){this.numElements=0,this.bufferSize=256,this.elements=[],this.elements.length=this.bufferSize,this.stack=new Float32Array(64)}function It(t,i){this.proxy=t,this.pair=null,this.min1=null,this.max1=null,this.min2=null,this.max2=null,this.max=i,this.value=0}function Vt(t,i){kt.call(this,i),this.belongsTo=0,this.max=[],this.min=[],this.sap=t,this.min[0]=new It(this,!1),this.max[0]=new It(this,!0),this.min[1]=new It(this,!1),this.max[1]=new It(this,!0),this.min[2]=new It(this,!1),this.max[2]=new It(this,!0),this.max[0].pair=this.min[0],this.max[1].pair=this.min[1],this.max[2].pair=this.min[2],this.min[0].min1=this.min[1],this.min[0].max1=this.max[1],this.min[0].min2=this.min[2],this.min[0].max2=this.max[2],this.min[1].min1=this.min[0],this.min[1].max1=this.max[0],this.min[1].min2=this.min[2],this.min[1].max2=this.max[2],this.min[2].min1=this.min[0],this.min[2].max1=this.max[0],this.min[2].min2=this.min[1],this.min[2].max2=this.max[1]}function St(){zt.call(this),this.types=m,this.numElementsD=0,this.numElementsS=0,this.axesD=[new Mt,new Mt,new Mt],this.axesS=[new Mt,new Mt,new Mt],this.index1=0,this.index2=1}function Lt(){this.child1=null,this.child2=null,this.parent=null,this.proxy=null,this.height=0,this.aabb=new F}function Pt(){this.root=null,this.freeNodes=[],this.freeNodes.length=16384,this.numFreeNodes=0,this.aabb=new F}function Tt(t){kt.call(this,t),this.leaf=new Lt,this.leaf.proxy=this}function At(){zt.call(this),this.types=p,this.tree=new Pt,this.stack=[],this.leaves=[],this.numLeaves=0}function Ot(){this.flip=!1}function jt(){Ot.call(this),this.clipVertices1=new Float32Array(24),this.clipVertices2=new Float32Array(24),this.used=new Float32Array(8),this.INF=1/0}function Dt(t){Ot.call(this),this.flip=t}function Ct(){Ot.call(this)}function Et(t){Ot.call(this),this.flip=t}function Bt(t){Ot.call(this),this.flip=t}function Ft(){Ot.call(this)}function qt(t){Ot.call(this),this.flip=t,this.n=new C,this.p=new C}function Ut(t){Ot.call(this),this.flip=t,this.n=new C,this.p=new C,this.dix=new C,this.diy=new C,this.diz=new C,this.cc=new C,this.cc2=new C}function Rt(t){switch(t instanceof Object||(t={}),this.scale=t.worldscale||1,this.invScale=1/this.scale,this.timeStep=t.timestep||.01666,this.timerate=1e3*this.timeStep,this.timer=null,this.preLoop=null,this.postLoop=null,this.numIterations=t.iterations||8,t.broadphase||2){case 1:this.broadPhase=new gt;break;case 2:default:this.broadPhase=new St;break;case 3:this.broadPhase=new At}this.Btypes=["None","BruteForce","Sweep & Prune","Bounding Volume Tree"],this.broadPhaseType=this.Btypes[t.broadphase||2],this.performance=null,this.isStat=void 0!==t.info&&t.info,this.isStat&&(this.performance=new D(this)),this.enableRandomizer=void 0===t.random||t.random,this.rigidBodies=null,this.numRigidBodies=0,this.contacts=null,this.unusedContacts=null,this.numContacts=0,this.numContactPoints=0,this.joints=null,this.numJoints=0,this.numIslands=0,this.gravity=new C(0,-9.8,0),void 0!==t.gravity&&this.gravity.fromArray(t.gravity);this.detectors=[],this.detectors.length=5;for(var i=5;i--;)this.detectors[i]=[],this.detectors[i].length=5;this.detectors[v][v]=new Ft,this.detectors[v][z]=new Et(!1),this.detectors[z][v]=new Et(!0),this.detectors[z][z]=new jt,this.detectors[N][N]=new Ct,this.detectors[N][z]=new Dt(!0),this.detectors[z][N]=new Dt(!1),this.detectors[N][v]=new Bt(!0),this.detectors[v][N]=new Bt(!1),this.detectors[k][v]=new qt(!0),this.detectors[v][k]=new qt(!1),this.detectors[k][z]=new Ut(!0),this.detectors[z][k]=new Ut(!1),this.randX=65535,this.randA=98765,this.randB=123456789,this.islandRigidBodies=[],this.islandStack=[],this.islandConstraints=[]}Object.assign(kt.prototype,{Proxy:!0,update:function(){j("Proxy","Inheritance error.")}}),wt.prototype=Object.assign(Object.create(kt.prototype),{constructor:wt,update:function(){}}),gt.prototype=Object.assign(Object.create(zt.prototype),{constructor:gt,createProxy:function(t){return new wt(t)},addProxy:function(t){this.proxies.push(t)},removeProxy:function(t){var i=this.proxies.indexOf(t);i>-1&&this.proxies.splice(i,1)},collectPairs:function(){var t,i,s,h=0,e=this.proxies,a=e.length;for(this.numPairChecks=a*(a-1)>>1;h<a;)for(i=e[h++],t=h+1;t<a;)s=e[t++],!i.aabb.intersectTest(s.aabb)&&this.isAvailablePair(i.shape,s.shape)&&this.addPair(i.shape,s.shape)}}),Object.assign(Mt.prototype,{SAPAxis:!0,addElements:function(t,i){if(this.numElements+2>=this.bufferSize){this.bufferSize*=2;for(var s=[],h=this.numElements;h--;)s[h]=this.elements[h]}this.elements[this.numElements++]=t,this.elements[this.numElements++]=i},removeElements:function(t,i){for(var s=-1,h=-1,e=0,a=this.numElements;e<a;e++){var o=this.elements[e];if(o==t||o==i){if(-1!=s){h=e;break}s=e}}for(e=s+1,a=h;e<a;e++)this.elements[e-1]=this.elements[e];for(e=h+1,a=this.numElements;e<a;e++)this.elements[e-2]=this.elements[e];this.elements[--this.numElements]=null,this.elements[--this.numElements]=null},sort:function(){for(var t=0,i=1;this.numElements>>i!=0;)i++;i=i*this.numElements>>2,t=0;for(var s=!1,h=this.elements,e=1,a=this.numElements;e<a;e++){var o=h[e],n=o.value,r=h[e-1];if(r.value>n){var l=e;do{if(h[l]=r,0==--l)break;r=h[l-1]}while(r.value>n);if(h[l]=o,(t+=e-l)>i){s=!0;break}}}if(s){t=2;var c=this.stack;for(c[0]=0,c[1]=this.numElements-1;t>0;){var m=c[--t],p=c[--t],u=m-p;if(u>16){var y=p+O.floor(.5*u);for(o=h[y],h[y]=h[m],h[m]=o,n=o.value,e=p-1,l=m;;){var x,d;do{x=h[++e]}while(x.value<n);do{d=h[--l]}while(n<d.value&&l!=p);if(e>=l)break;h[e]=d,h[l]=x}h[m]=h[e],h[e]=o,e-p>m-e?(c[t++]=p,c[t++]=e-1,c[t++]=e+1,c[t++]=m):(c[t++]=e+1,c[t++]=m,c[t++]=p,c[t++]=e-1)}else for(e=p+1;e<=m;e++)if(n=(o=h[e]).value,(r=h[e-1]).value>n){l=e;do{if(h[l]=r,0==--l)break;r=h[l-1]}while(r.value>n);h[l]=o}}}},calculateTestCount:function(){for(var t=1,i=0,s=1,h=this.numElements;s<h;s++)this.elements[s].max?t--:(i+=t,t++);return i}}),Vt.prototype=Object.assign(Object.create(kt.prototype),{constructor:Vt,isDynamic:function(){var t=this.shape.parent;return t.isDynamic&&!t.sleeping},update:function(){var t=this.aabb.elements;this.min[0].value=t[0],this.min[1].value=t[1],this.min[2].value=t[2],this.max[0].value=t[3],this.max[1].value=t[4],this.max[2].value=t[5],(1==this.belongsTo&&!this.isDynamic()||2==this.belongsTo&&this.isDynamic())&&(this.sap.removeProxy(this),this.sap.addProxy(this))}}),St.prototype=Object.assign(Object.create(zt.prototype),{constructor:St,createProxy:function(t){return new Vt(this,t)},addProxy:function(t){var i=t;i.isDynamic()?(this.axesD[0].addElements(i.min[0],i.max[0]),this.axesD[1].addElements(i.min[1],i.max[1]),this.axesD[2].addElements(i.min[2],i.max[2]),i.belongsTo=1,this.numElementsD+=2):(this.axesS[0].addElements(i.min[0],i.max[0]),this.axesS[1].addElements(i.min[1],i.max[1]),this.axesS[2].addElements(i.min[2],i.max[2]),i.belongsTo=2,this.numElementsS+=2)},removeProxy:function(t){var i=t;if(0!=i.belongsTo){switch(i.belongsTo){case 1:this.axesD[0].removeElements(i.min[0],i.max[0]),this.axesD[1].removeElements(i.min[1],i.max[1]),this.axesD[2].removeElements(i.min[2],i.max[2]),this.numElementsD-=2;break;case 2:this.axesS[0].removeElements(i.min[0],i.max[0]),this.axesS[1].removeElements(i.min[1],i.max[1]),this.axesS[2].removeElements(i.min[2],i.max[2]),this.numElementsS-=2}i.belongsTo=0}},collectPairs:function(){if(0!=this.numElementsD){var t,i,s,h,e=this.axesD[this.index1],a=this.axesD[this.index2];e.sort(),a.sort(),e.calculateTestCount()<=a.calculateTestCount()?((a=this.axesS[this.index1]).sort(),t=e.elements,i=a.elements):((e=this.axesS[this.index2]).sort(),t=a.elements,i=e.elements,this.index1^=this.index2,this.index2^=this.index1,this.index1^=this.index2);for(var o=0,n=0;o<this.numElementsD;){var r,l;if(n==this.numElementsS)r=t[o],l=!0,o++;else{var c=t[o],m=i[n];c.value<m.value?(r=c,l=!0,o++):(r=m,l=!1,n++)}if(r.max){var p=r.pair;if(l){if(p==s){s=s.pair;continue}r=s}else{if(p==h){h=h.pair;continue}r=h}do{if((b=r.pair)==p){r.pair=b.pair;break}r=b}while(null!=r)}else{for(var u=r.proxy.shape,y=r.min1.value,x=r.max1.value,d=r.min2.value,f=r.max2.value,b=s;null!=b;b=b.pair){var v=b.proxy.shape;this.numPairChecks++,y>b.max1.value||x<b.min1.value||d>b.max2.value||f<b.min2.value||!this.isAvailablePair(u,v)||this.addPair(u,v)}if(l){for(b=h;null!=b;b=b.pair)v=b.proxy.shape,this.numPairChecks++,y>b.max1.value||x<b.min1.value||d>b.max2.value||f<b.min2.value||!this.isAvailablePair(u,v)||this.addPair(u,v);r.pair=s,s=r}else r.pair=h,h=r}}this.index2=3^(this.index1|this.index2)}}}),Object.assign(Pt.prototype,{DBVT:!0,moveLeaf:function(t){this.deleteLeaf(t),this.insertLeaf(t)},insertLeaf:function(t){if(null!=this.root){for(var i,s,h=t.aabb,e=this.root;null==e.proxy;){var a=e.child1,o=e.child2,n=e.aabb,r=a.aabb,l=o.aabb;i=n.surfaceArea(),this.aabb.combine(h,n);var c=2*(s=this.aabb.surfaceArea()),m=2*(s-i),p=m;this.aabb.combine(h,r),null!=a.proxy?p+=this.aabb.surfaceArea():p+=this.aabb.surfaceArea()-r.surfaceArea();var u=m;if(this.aabb.combine(h,l),null!=o.proxy?u+=this.aabb.surfaceArea():u+=this.aabb.surfaceArea()-l.surfaceArea(),p<u){if(c<p)break;e=a}else{if(c<u)break;e=o}}var y,x=e.parent;(y=this.numFreeNodes>0?this.freeNodes[--this.numFreeNodes]:new Lt).parent=x,y.child1=t,y.child2=e,y.aabb.combine(t.aabb,e.aabb),y.height=e.height+1,e.parent=y,t.parent=y,e==this.root?this.root=y:x.child1==e?x.child1=y:x.child2=y;do{y=this.balance(y),this.fix(y),y=y.parent}while(null!=y)}else this.root=t},getBalance:function(t){return null!=t.proxy?0:t.child1.height-t.child2.height},deleteLeaf:function(t){if(t!=this.root){var i,s=t.parent;if(i=s.child1==t?s.child2:s.child1,s==this.root)return this.root=i,void(i.parent=null);var h=s.parent;i.parent=h,h.child1==s?h.child1=i:h.child2=i,this.numFreeNodes<16384&&(this.freeNodes[this.numFreeNodes++]=s);do{h=this.balance(h),this.fix(h),h=h.parent}while(null!=h)}else this.root=null},balance:function(t){var i=t.height;if(i<2)return t;var s,h=t.parent,e=t.child1,a=t.child2,o=e.height,n=a.height,r=o-n;if(r>1){var l=e.child1,c=e.child2,m=l.height,p=c.height;return m>p?(e.child2=t,t.parent=e,t.child1=c,c.parent=t,t.aabb.combine(c.aabb,a.aabb),s=p-n,t.height=p-(s&s>>31)+1,e.aabb.combine(l.aabb,t.aabb),s=m-i,e.height=m-(s&s>>31)+1):(e.child1=t,t.parent=e,t.child1=l,l.parent=t,t.aabb.combine(l.aabb,a.aabb),s=m-n,t.height=m-(s&s>>31)+1,e.aabb.combine(t.aabb,c.aabb),s=i-p,e.height=i-(s&s>>31)+1),null!=h?h.child1==t?h.child1=e:h.child2=e:this.root=e,e.parent=h,e}if(r<-1){var u=a.child1,y=a.child2,x=u.height,d=y.height;return x>d?(a.child2=t,t.parent=a,t.child2=y,y.parent=t,t.aabb.combine(e.aabb,y.aabb),s=o-d,t.height=o-(s&s>>31)+1,a.aabb.combine(u.aabb,t.aabb),s=x-i,a.height=x-(s&s>>31)+1):(a.child1=t,t.parent=a,t.child2=u,u.parent=t,t.aabb.combine(e.aabb,u.aabb),s=o-x,t.height=o-(s&s>>31)+1,a.aabb.combine(t.aabb,y.aabb),s=i-d,a.height=i-(s&s>>31)+1),null!=h?h.child1==t?h.child1=a:h.child2=a:this.root=a,a.parent=h,a}return t},fix:function(t){var i=t.child1,s=t.child2;t.aabb.combine(i.aabb,s.aabb),t.height=i.height<s.height?s.height+1:i.height+1}}),Tt.prototype=Object.assign(Object.create(kt.prototype),{constructor:Tt,update:function(){}}),At.prototype=Object.assign(Object.create(zt.prototype),{constructor:At,createProxy:function(t){return new Tt(t)},addProxy:function(t){this.tree.insertLeaf(t.leaf),this.leaves.push(t.leaf),this.numLeaves++},removeProxy:function(t){this.tree.deleteLeaf(t.leaf);var i=this.leaves.indexOf(t.leaf);i>-1&&(this.leaves.splice(i,1),this.numLeaves--)},collectPairs:function(){if(!(this.numLeaves<2))for(var t,i=this.numLeaves;i--;)(t=this.leaves[i]).proxy.aabb.intersectTestTwo(t.aabb)&&(t.aabb.copy(t.proxy.aabb,.1),this.tree.deleteLeaf(t),this.tree.insertLeaf(t),this.collide(t,this.tree.root))},collide:function(t,i){var s,h,e,a,o,n,r=2;for(this.stack[0]=t,this.stack[1]=i;r>0;)if(e=this.stack[--r],a=this.stack[--r],o=null!=e.proxy,n=null!=a.proxy,this.numPairChecks++,o&&n){if((s=e.proxy.shape)==(h=a.proxy.shape)||s.aabb.intersectTest(h.aabb)||!this.isAvailablePair(s,h))continue;this.addPair(s,h)}else{if(e.aabb.intersectTest(a.aabb))continue;n||!o&&e.aabb.surfaceArea()>a.aabb.surfaceArea()?(this.stack[r++]=e.child1,this.stack[r++]=a,this.stack[r++]=e.child2,this.stack[r++]=a):(this.stack[r++]=e,this.stack[r++]=a.child1,this.stack[r++]=e,this.stack[r++]=a.child2)}}}),Object.assign(Ot.prototype,{CollisionDetector:!0,detectCollision:function(t,i,s){j("CollisionDetector","Inheritance error.")}}),jt.prototype=Object.assign(Object.create(Ot.prototype),{constructor:jt,detectCollision:function(t,i,s){var h,e;t.id<i.id?(h=t,e=i):(h=i,e=t);var a,o,n,r,l,c,m,p,u,y,x,d,f,b,v,z,N,k,w,g,M,I,V,S,L,P,T,A,j,D,C,E,B,F,q,U=h.elements,R=e.elements,_=h.dimentions,J=e.dimentions,W=h.position,H=e.position,Y=W.x,Q=W.y,X=W.z,K=H.x,Z=H.y,G=H.z,$=K-Y,tt=Z-Q,it=G-X,st=h.halfWidth,ht=h.halfHeight,et=h.halfDepth,at=e.halfWidth,ot=e.halfHeight,nt=e.halfDepth,rt=_[0],lt=_[1],ct=_[2],mt=_[3],pt=_[4],ut=_[5],yt=_[6],xt=_[7],dt=_[8],ft=_[9],bt=_[10],vt=_[11],zt=_[12],Nt=_[13],kt=_[14],wt=_[15],gt=_[16],Mt=_[17],It=J[0],Vt=J[1],St=J[2],Lt=J[3],Pt=J[4],Tt=J[5],At=J[6],Ot=J[7],jt=J[8],Dt=J[9],Ct=J[10],Et=J[11],Bt=J[12],Ft=J[13],qt=J[14],Ut=J[15],Rt=J[16],_t=J[17],Jt=lt*St-ct*Vt,Wt=ct*It-rt*St,Ht=rt*Vt-lt*It,Yt=lt*Tt-ct*Pt,Qt=ct*Lt-rt*Tt,Xt=rt*Pt-lt*Lt,Kt=lt*jt-ct*Ot,Zt=ct*At-rt*jt,Gt=rt*Ot-lt*At,$t=pt*St-ut*Vt,ti=ut*It-mt*St,ii=mt*Vt-pt*It,si=pt*Tt-ut*Pt,hi=ut*Lt-mt*Tt,ei=mt*Pt-pt*Lt,ai=pt*jt-ut*Ot,oi=ut*At-mt*jt,ni=mt*Ot-pt*At,ri=xt*St-dt*Vt,li=dt*It-yt*St,ci=yt*Vt-xt*It,mi=xt*Tt-dt*Pt,pi=dt*Lt-yt*Tt,ui=yt*Pt-xt*Lt,yi=xt*jt-dt*Ot,xi=dt*At-yt*jt,di=yt*Ot-xt*At,fi=!1,bi=!1,vi=!1,zi=!1,Ni=!1,ki=!1,wi=!1,gi=!1,Mi=!1;if((a=(C=rt*$+lt*tt+ct*it)>0)||(C=-C),(B=rt*It+lt*Vt+ct*St)<0&&(B=-B),(F=rt*Lt+lt*Pt+ct*Tt)<0&&(F=-F),(q=rt*At+lt*Ot+ct*jt)<0&&(q=-q),!((z=C-(E=st)-(B*at+F*ot+q*nt))>0||((o=(C=mt*$+pt*tt+ut*it)>0)||(C=-C),(B=mt*It+pt*Vt+ut*St)<0&&(B=-B),(F=mt*Lt+pt*Pt+ut*Tt)<0&&(F=-F),(q=mt*At+pt*Ot+ut*jt)<0&&(q=-q),(N=C-(E=ht)-(B*at+F*ot+q*nt))>0||((n=(C=yt*$+xt*tt+dt*it)>0)||(C=-C),(B=yt*It+xt*Vt+dt*St)<0&&(B=-B),(F=yt*Lt+xt*Pt+dt*Tt)<0&&(F=-F),(q=yt*At+xt*Ot+dt*jt)<0&&(q=-q),(k=C-(E=et)-(B*at+F*ot+q*nt))>0||((r=(C=It*$+Vt*tt+St*it)>0)||(C=-C),(B=It*rt+Vt*lt+St*ct)<0&&(B=-B),(F=It*mt+Vt*pt+St*ut)<0&&(F=-F),(q=It*yt+Vt*xt+St*dt)<0&&(q=-q),(w=1*(C-(E=B*st+F*ht+q*et)-at))>0||((l=(C=Lt*$+Pt*tt+Tt*it)>0)||(C=-C),(B=Lt*rt+Pt*lt+Tt*ct)<0&&(B=-B),(F=Lt*mt+Pt*pt+Tt*ut)<0&&(F=-F),(q=Lt*yt+Pt*xt+Tt*dt)<0&&(q=-q),(g=1*(C-(E=B*st+F*ht+q*et)-ot))>0||((c=(C=At*$+Ot*tt+jt*it)>0)||(C=-C),(B=At*rt+Ot*lt+jt*ct)<0&&(B=-B),(F=At*mt+Ot*pt+jt*ut)<0&&(F=-F),(q=At*yt+Ot*xt+jt*dt)<0&&(q=-q),(M=1*(C-(E=B*st+F*ht+q*et)-nt))>0))))))){if((C=Jt*Jt+Wt*Wt+Ht*Ht)>1e-5){if((m=(C=(Jt*=C=1/O.sqrt(C))*$+(Wt*=C)*tt+(Ht*=C)*it)>0)||(C=-C),(B=Jt*mt+Wt*pt+Ht*ut)<0&&(B=-B),(F=Jt*yt+Wt*xt+Ht*dt)<0&&(F=-F),E=B*ht+F*et,(B=Jt*Lt+Wt*Pt+Ht*Tt)<0&&(B=-B),(F=Jt*At+Wt*Ot+Ht*jt)<0&&(F=-F),(I=C-E-(B*ot+F*nt))>0)return}else m=!1,I=0,fi=!0;if((C=Yt*Yt+Qt*Qt+Xt*Xt)>1e-5){if((p=(C=(Yt*=C=1/O.sqrt(C))*$+(Qt*=C)*tt+(Xt*=C)*it)>0)||(C=-C),(B=Yt*mt+Qt*pt+Xt*ut)<0&&(B=-B),(F=Yt*yt+Qt*xt+Xt*dt)<0&&(F=-F),E=B*ht+F*et,(B=Yt*It+Qt*Vt+Xt*St)<0&&(B=-B),(F=Yt*At+Qt*Ot+Xt*jt)<0&&(F=-F),(V=C-E-(B*at+F*nt))>0)return}else p=!1,V=0,bi=!0;if((C=Kt*Kt+Zt*Zt+Gt*Gt)>1e-5){if((u=(C=(Kt*=C=1/O.sqrt(C))*$+(Zt*=C)*tt+(Gt*=C)*it)>0)||(C=-C),(B=Kt*mt+Zt*pt+Gt*ut)<0&&(B=-B),(F=Kt*yt+Zt*xt+Gt*dt)<0&&(F=-F),E=B*ht+F*et,(B=Kt*It+Zt*Vt+Gt*St)<0&&(B=-B),(F=Kt*Lt+Zt*Pt+Gt*Tt)<0&&(F=-F),(S=C-E-(B*at+F*ot))>0)return}else u=!1,S=0,vi=!0;if((C=$t*$t+ti*ti+ii*ii)>1e-5){if((y=(C=($t*=C=1/O.sqrt(C))*$+(ti*=C)*tt+(ii*=C)*it)>0)||(C=-C),(B=$t*rt+ti*lt+ii*ct)<0&&(B=-B),(F=$t*yt+ti*xt+ii*dt)<0&&(F=-F),E=B*st+F*et,(B=$t*Lt+ti*Pt+ii*Tt)<0&&(B=-B),(F=$t*At+ti*Ot+ii*jt)<0&&(F=-F),(L=C-E-(B*ot+F*nt))>0)return}else y=!1,L=0,zi=!0;if((C=si*si+hi*hi+ei*ei)>1e-5){if((x=(C=(si*=C=1/O.sqrt(C))*$+(hi*=C)*tt+(ei*=C)*it)>0)||(C=-C),(B=si*rt+hi*lt+ei*ct)<0&&(B=-B),(F=si*yt+hi*xt+ei*dt)<0&&(F=-F),E=B*st+F*et,(B=si*It+hi*Vt+ei*St)<0&&(B=-B),(F=si*At+hi*Ot+ei*jt)<0&&(F=-F),(P=C-E-(B*at+F*nt))>0)return}else x=!1,P=0,Ni=!0;if((C=ai*ai+oi*oi+ni*ni)>1e-5){if((d=(C=(ai*=C=1/O.sqrt(C))*$+(oi*=C)*tt+(ni*=C)*it)>0)||(C=-C),(B=ai*rt+oi*lt+ni*ct)<0&&(B=-B),(F=ai*yt+oi*xt+ni*dt)<0&&(F=-F),E=B*st+F*et,(B=ai*It+oi*Vt+ni*St)<0&&(B=-B),(F=ai*Lt+oi*Pt+ni*Tt)<0&&(F=-F),(T=C-E-(B*at+F*ot))>0)return}else d=!1,T=0,ki=!0;if((C=ri*ri+li*li+ci*ci)>1e-5){if((f=(C=(ri*=C=1/O.sqrt(C))*$+(li*=C)*tt+(ci*=C)*it)>0)||(C=-C),(B=ri*rt+li*lt+ci*ct)<0&&(B=-B),(F=ri*mt+li*pt+ci*ut)<0&&(F=-F),E=B*st+F*ht,(B=ri*Lt+li*Pt+ci*Tt)<0&&(B=-B),(F=ri*At+li*Ot+ci*jt)<0&&(F=-F),(A=C-E-(B*ot+F*nt))>0)return}else f=!1,A=0,wi=!0;if((C=mi*mi+pi*pi+ui*ui)>1e-5){if((b=(C=(mi*=C=1/O.sqrt(C))*$+(pi*=C)*tt+(ui*=C)*it)>0)||(C=-C),(B=mi*rt+pi*lt+ui*ct)<0&&(B=-B),(F=mi*mt+pi*pt+ui*ut)<0&&(F=-F),E=B*st+F*ht,(B=mi*It+pi*Vt+ui*St)<0&&(B=-B),(F=mi*At+pi*Ot+ui*jt)<0&&(F=-F),(j=C-E-(B*at+F*nt))>0)return}else b=!1,j=0,gi=!0;if((C=yi*yi+xi*xi+di*di)>1e-5){if((v=(C=(yi*=C=1/O.sqrt(C))*$+(xi*=C)*tt+(di*=C)*it)>0)||(C=-C),(B=yi*rt+xi*lt+di*ct)<0&&(B=-B),(F=yi*mt+xi*pt+di*ut)<0&&(F=-F),E=B*st+F*ht,(B=yi*It+xi*Vt+di*St)<0&&(B=-B),(F=yi*Lt+xi*Pt+di*Tt)<0&&(F=-F),(D=C-E-(B*at+F*ot))>0)return}else v=!1,D=0,Mi=!0;var Ii=z,Vi=z,Si=0,Li=a;N>Vi&&(Ii=N,Vi=N,Si=1,Li=o),k>Vi&&(Ii=k,Vi=k,Si=2,Li=n),w>Vi&&(Ii=w,Vi=w,Si=3,Li=r),g>Vi&&(Ii=g,Vi=g,Si=4,Li=l),M>Vi&&(Ii=M,Vi=M,Si=5,Li=c),I-.01>Vi&&!fi&&(Ii=I,Vi=I-.01,Si=6,Li=m),V-.01>Vi&&!bi&&(Ii=V,Vi=V-.01,Si=7,Li=p),S-.01>Vi&&!vi&&(Ii=S,Vi=S-.01,Si=8,Li=u),L-.01>Vi&&!zi&&(Ii=L,Vi=L-.01,Si=9,Li=y),P-.01>Vi&&!Ni&&(Ii=P,Vi=P-.01,Si=10,Li=x),T-.01>Vi&&!ki&&(Ii=T,Vi=T-.01,Si=11,Li=d),A-.01>Vi&&!wi&&(Ii=A,Vi=A-.01,Si=12,Li=f),j-.01>Vi&&!gi&&(Ii=j,Vi=j-.01,Si=13,Li=b),D-.01>Vi&&!Mi&&(Ii=D,Si=14,Li=v);var Pi=0,Ti=0,Ai=0,Oi=0,ji=0,Di=0,Ci=0,Ei=0,Bi=0,Fi=0,qi=0,Ui=0,Ri=0,_i=0,Ji=0,Wi=0,Hi=0,Yi=0,Qi=!1;if(0==Si?(Li?(Fi=Y+ft,qi=Q+bt,Ui=X+vt,Pi=rt,Ti=lt,Ai=ct):(Fi=Y-ft,qi=Q-bt,Ui=X-vt,Pi=-rt,Ti=-lt,Ai=-ct),Ri=zt,_i=Nt,Ji=kt,Oi=-mt,ji=-pt,Di=-ut,Wi=wt,Hi=gt,Yi=Mt,Ci=-yt,Ei=-xt,Bi=-dt):1==Si?(Li?(Fi=Y+zt,qi=Q+Nt,Ui=X+kt,Pi=mt,Ti=pt,Ai=ut):(Fi=Y-zt,qi=Q-Nt,Ui=X-kt,Pi=-mt,Ti=-pt,Ai=-ut),Ri=ft,_i=bt,Ji=vt,Oi=-rt,ji=-lt,Di=-ct,Wi=wt,Hi=gt,Yi=Mt,Ci=-yt,Ei=-xt,Bi=-dt):2==Si?(Li?(Fi=Y+wt,qi=Q+gt,Ui=X+Mt,Pi=yt,Ti=xt,Ai=dt):(Fi=Y-wt,qi=Q-gt,Ui=X-Mt,Pi=-yt,Ti=-xt,Ai=-dt),Ri=ft,_i=bt,Ji=vt,Oi=-rt,ji=-lt,Di=-ct,Wi=zt,Hi=Nt,Yi=kt,Ci=-mt,Ei=-pt,Bi=-ut):3==Si?(Qi=!0,Li?(Fi=K-Dt,qi=Z-Ct,Ui=G-Et,Pi=-It,Ti=-Vt,Ai=-St):(Fi=K+Dt,qi=Z+Ct,Ui=G+Et,Pi=It,Ti=Vt,Ai=St),Ri=Bt,_i=Ft,Ji=qt,Oi=-Lt,ji=-Pt,Di=-Tt,Wi=Ut,Hi=Rt,Yi=_t,Ci=-At,Ei=-Ot,Bi=-jt):4==Si?(Qi=!0,Li?(Fi=K-Bt,qi=Z-Ft,Ui=G-qt,Pi=-Lt,Ti=-Pt,Ai=-Tt):(Fi=K+Bt,qi=Z+Ft,Ui=G+qt,Pi=Lt,Ti=Pt,Ai=Tt),Ri=Dt,_i=Ct,Ji=Et,Oi=-It,ji=-Vt,Di=-St,Wi=Ut,Hi=Rt,Yi=_t,Ci=-At,Ei=-Ot,Bi=-jt):5==Si?(Qi=!0,Li?(Fi=K-Ut,qi=Z-Rt,Ui=G-_t,Pi=-At,Ti=-Ot,Ai=-jt):(Fi=K+Ut,qi=Z+Rt,Ui=G+_t,Pi=At,Ti=Ot,Ai=jt),Ri=Dt,_i=Ct,Ji=Et,Oi=-It,ji=-Vt,Di=-St,Wi=Bt,Hi=Ft,Yi=qt,Ci=-Lt,Ei=-Pt,Bi=-Tt):6==Si?(Pi=Jt,Ti=Wt,Ai=Ht,Oi=rt,ji=lt,Di=ct,Ci=It,Ei=Vt,Bi=St):7==Si?(Pi=Yt,Ti=Qt,Ai=Xt,Oi=rt,ji=lt,Di=ct,Ci=Lt,Ei=Pt,Bi=Tt):8==Si?(Pi=Kt,Ti=Zt,Ai=Gt,Oi=rt,ji=lt,Di=ct,Ci=At,Ei=Ot,Bi=jt):9==Si?(Pi=$t,Ti=ti,Ai=ii,Oi=mt,ji=pt,Di=ut,Ci=It,Ei=Vt,Bi=St):10==Si?(Pi=si,Ti=hi,Ai=ei,Oi=mt,ji=pt,Di=ut,Ci=Lt,Ei=Pt,Bi=Tt):11==Si?(Pi=ai,Ti=oi,Ai=ni,Oi=mt,ji=pt,Di=ut,Ci=At,Ei=Ot,Bi=jt):12==Si?(Pi=ri,Ti=li,Ai=ci,Oi=yt,ji=xt,Di=dt,Ci=It,Ei=Vt,Bi=St):13==Si?(Pi=mi,Ti=pi,Ai=ui,Oi=yt,ji=xt,Di=dt,Ci=Lt,Ei=Pt,Bi=Tt):14==Si&&(Pi=yi,Ti=xi,Ai=di,Oi=yt,ji=xt,Di=dt,Ci=At,Ei=Ot,Bi=jt),Si>5){var Xi,Ki,Zi,Gi,$i,ts,is,ss,hs,es,as;Li||(Pi=-Pi,Ti=-Ti,Ai=-Ai),Ki=Pi*(ts=U[0])+Ti*(is=U[1])+Ai*(ss=U[2]),(Xi=Pi*(Zi=U[3])+Ti*(Gi=U[4])+Ai*($i=U[5]))>Ki&&(Ki=Xi,ts=Zi,is=Gi,ss=$i),(Xi=Pi*(Zi=U[6])+Ti*(Gi=U[7])+Ai*($i=U[8]))>Ki&&(Ki=Xi,ts=Zi,is=Gi,ss=$i),(Xi=Pi*(Zi=U[9])+Ti*(Gi=U[10])+Ai*($i=U[11]))>Ki&&(Ki=Xi,ts=Zi,is=Gi,ss=$i),(Xi=Pi*(Zi=U[12])+Ti*(Gi=U[13])+Ai*($i=U[14]))>Ki&&(Ki=Xi,ts=Zi,is=Gi,ss=$i),(Xi=Pi*(Zi=U[15])+Ti*(Gi=U[16])+Ai*($i=U[17]))>Ki&&(Ki=Xi,ts=Zi,is=Gi,ss=$i),(Xi=Pi*(Zi=U[18])+Ti*(Gi=U[19])+Ai*($i=U[20]))>Ki&&(Ki=Xi,ts=Zi,is=Gi,ss=$i),(Xi=Pi*(Zi=U[21])+Ti*(Gi=U[22])+Ai*($i=U[23]))>Ki&&(Ki=Xi,ts=Zi,is=Gi,ss=$i),Ki=Pi*(hs=R[0])+Ti*(es=R[1])+Ai*(as=R[2]),(Xi=Pi*(Zi=R[3])+Ti*(Gi=R[4])+Ai*($i=R[5]))<Ki&&(Ki=Xi,hs=Zi,es=Gi,as=$i),(Xi=Pi*(Zi=R[6])+Ti*(Gi=R[7])+Ai*($i=R[8]))<Ki&&(Ki=Xi,hs=Zi,es=Gi,as=$i),(Xi=Pi*(Zi=R[9])+Ti*(Gi=R[10])+Ai*($i=R[11]))<Ki&&(Ki=Xi,hs=Zi,es=Gi,as=$i),(Xi=Pi*(Zi=R[12])+Ti*(Gi=R[13])+Ai*($i=R[14]))<Ki&&(Ki=Xi,hs=Zi,es=Gi,as=$i),(Xi=Pi*(Zi=R[15])+Ti*(Gi=R[16])+Ai*($i=R[17]))<Ki&&(Ki=Xi,hs=Zi,es=Gi,as=$i),(Xi=Pi*(Zi=R[18])+Ti*(Gi=R[19])+Ai*($i=R[20]))<Ki&&(Ki=Xi,hs=Zi,es=Gi,as=$i),(Xi=Pi*(Zi=R[21])+Ti*(Gi=R[22])+Ai*($i=R[23]))<Ki&&(Ki=Xi,hs=Zi,es=Gi,as=$i);var os=((Zi=hs-ts)*(Oi-Ci*(B=Oi*Ci+ji*Ei+Di*Bi))+(Gi=es-is)*(ji-Ei*B)+($i=as-ss)*(Di-Bi*B))/(1-B*B);s.addPoint(ts+Oi*os+Pi*Ii*.5,is+ji*os+Ti*Ii*.5,ss+Di*os+Ai*Ii*.5,Pi,Ti,Ai,Ii,!1)}else{var ns,rs,ls,cs,ms,ps,us,ys,xs,ds,fs,bs,vs,zs,Ns,ks,ws,gs,Ms,Is,Vs,Ss=1,Ls=0,Ps=0;Qi?((Ls=rt*Pi+lt*Ti+ct*Ai)<Ss&&(Ss=Ls,Ps=0),-Ls<Ss&&(Ss=-Ls,Ps=1),(Ls=mt*Pi+pt*Ti+ut*Ai)<Ss&&(Ss=Ls,Ps=2),-Ls<Ss&&(Ss=-Ls,Ps=3),(Ls=yt*Pi+xt*Ti+dt*Ai)<Ss&&(Ss=Ls,Ps=4),-Ls<Ss&&(Ss=-Ls,Ps=5),0==Ps?(ns=U[0],rs=U[1],ls=U[2],cs=U[6],ms=U[7],ps=U[8],us=U[9],ys=U[10],xs=U[11],ds=U[3],fs=U[4],bs=U[5]):1==Ps?(ns=U[15],rs=U[16],ls=U[17],cs=U[21],ms=U[22],ps=U[23],us=U[18],ys=U[19],xs=U[20],ds=U[12],fs=U[13],bs=U[14]):2==Ps?(ns=U[12],rs=U[13],ls=U[14],cs=U[0],ms=U[1],ps=U[2],us=U[3],ys=U[4],xs=U[5],ds=U[15],fs=U[16],bs=U[17]):3==Ps?(ns=U[21],rs=U[22],ls=U[23],cs=U[9],ms=U[10],ps=U[11],us=U[6],ys=U[7],xs=U[8],ds=U[18],fs=U[19],bs=U[20]):4==Ps?(ns=U[12],rs=U[13],ls=U[14],cs=U[18],ms=U[19],ps=U[20],us=U[6],ys=U[7],xs=U[8],ds=U[0],fs=U[1],bs=U[2]):5==Ps&&(ns=U[3],rs=U[4],ls=U[5],cs=R[9],ms=R[10],ps=R[11],us=U[21],ys=U[22],xs=U[23],ds=U[15],fs=U[16],bs=U[17])):((Ls=It*Pi+Vt*Ti+St*Ai)<Ss&&(Ss=Ls,Ps=0),-Ls<Ss&&(Ss=-Ls,Ps=1),(Ls=Lt*Pi+Pt*Ti+Tt*Ai)<Ss&&(Ss=Ls,Ps=2),-Ls<Ss&&(Ss=-Ls,Ps=3),(Ls=At*Pi+Ot*Ti+jt*Ai)<Ss&&(Ss=Ls,Ps=4),-Ls<Ss&&(Ss=-Ls,Ps=5),0==Ps?(ns=R[0],rs=R[1],ls=R[2],cs=R[6],ms=R[7],ps=R[8],us=R[9],ys=R[10],xs=R[11],ds=R[3],fs=R[4],bs=R[5]):1==Ps?(ns=R[15],rs=R[16],ls=R[17],cs=R[21],ms=R[22],ps=R[23],us=R[18],ys=R[19],xs=R[20],ds=R[12],fs=R[13],bs=R[14]):2==Ps?(ns=R[12],rs=R[13],ls=R[14],cs=R[0],ms=R[1],ps=R[2],us=R[3],ys=R[4],xs=R[5],ds=R[15],fs=R[16],bs=R[17]):3==Ps?(ns=R[21],rs=R[22],ls=R[23],cs=R[9],ms=R[10],ps=R[11],us=R[6],ys=R[7],xs=R[8],ds=R[18],fs=R[19],bs=R[20]):4==Ps?(ns=R[12],rs=R[13],ls=R[14],cs=R[18],ms=R[19],ps=R[20],us=R[6],ys=R[7],xs=R[8],ds=R[0],fs=R[1],bs=R[2]):5==Ps&&(ns=R[3],rs=R[4],ls=R[5],cs=R[9],ms=R[10],ps=R[11],us=R[21],ys=R[22],xs=R[23],ds=R[15],fs=R[16],bs=R[17])),this.clipVertices1[0]=ns,this.clipVertices1[1]=rs,this.clipVertices1[2]=ls,this.clipVertices1[3]=cs,this.clipVertices1[4]=ms,this.clipVertices1[5]=ps,this.clipVertices1[6]=us,this.clipVertices1[7]=ys,this.clipVertices1[8]=xs,this.clipVertices1[9]=ds,this.clipVertices1[10]=fs,this.clipVertices1[11]=bs,zs=0,B=((ks=this.clipVertices1[9])-Fi-Ri)*Oi+((ws=this.clipVertices1[10])-qi-_i)*ji+((gs=this.clipVertices1[11])-Ui-Ji)*Di;for(var Ts=0;Ts<4;Ts++)Ns=3*Ts,F=((Ms=this.clipVertices1[Ns])-Fi-Ri)*Oi+((Is=this.clipVertices1[Ns+1])-qi-_i)*ji+((Vs=this.clipVertices1[Ns+2])-Ui-Ji)*Di,B>0?F>0?(Ns=3*zs,zs++,this.clipVertices2[Ns]=Ms,this.clipVertices2[Ns+1]=Is,this.clipVertices2[Ns+2]=Vs):(Ns=3*zs,zs++,os=B/(B-F),this.clipVertices2[Ns]=ks+(Ms-ks)*os,this.clipVertices2[Ns+1]=ws+(Is-ws)*os,this.clipVertices2[Ns+2]=gs+(Vs-gs)*os):F>0&&(Ns=3*zs,zs++,os=B/(B-F),this.clipVertices2[Ns]=ks+(Ms-ks)*os,this.clipVertices2[Ns+1]=ws+(Is-ws)*os,this.clipVertices2[Ns+2]=gs+(Vs-gs)*os,Ns=3*zs,zs++,this.clipVertices2[Ns]=Ms,this.clipVertices2[Ns+1]=Is,this.clipVertices2[Ns+2]=Vs),ks=Ms,ws=Is,gs=Vs,B=F;if(0!=(vs=zs)){for(zs=0,Ns=3*(vs-1),B=((ks=this.clipVertices2[Ns])-Fi-Wi)*Ci+((ws=this.clipVertices2[Ns+1])-qi-Hi)*Ei+((gs=this.clipVertices2[Ns+2])-Ui-Yi)*Bi,Ts=0;Ts<vs;Ts++)Ns=3*Ts,F=((Ms=this.clipVertices2[Ns])-Fi-Wi)*Ci+((Is=this.clipVertices2[Ns+1])-qi-Hi)*Ei+((Vs=this.clipVertices2[Ns+2])-Ui-Yi)*Bi,B>0?F>0?(Ns=3*zs,zs++,this.clipVertices1[Ns]=Ms,this.clipVertices1[Ns+1]=Is,this.clipVertices1[Ns+2]=Vs):(Ns=3*zs,zs++,os=B/(B-F),this.clipVertices1[Ns]=ks+(Ms-ks)*os,this.clipVertices1[Ns+1]=ws+(Is-ws)*os,this.clipVertices1[Ns+2]=gs+(Vs-gs)*os):F>0&&(Ns=3*zs,zs++,os=B/(B-F),this.clipVertices1[Ns]=ks+(Ms-ks)*os,this.clipVertices1[Ns+1]=ws+(Is-ws)*os,this.clipVertices1[Ns+2]=gs+(Vs-gs)*os,Ns=3*zs,zs++,this.clipVertices1[Ns]=Ms,this.clipVertices1[Ns+1]=Is,this.clipVertices1[Ns+2]=Vs),ks=Ms,ws=Is,gs=Vs,B=F;if(0!=(vs=zs)){for(zs=0,Ns=3*(vs-1),B=((ks=this.clipVertices1[Ns])-Fi+Ri)*-Oi+((ws=this.clipVertices1[Ns+1])-qi+_i)*-ji+((gs=this.clipVertices1[Ns+2])-Ui+Ji)*-Di,Ts=0;Ts<vs;Ts++)Ns=3*Ts,F=((Ms=this.clipVertices1[Ns])-Fi+Ri)*-Oi+((Is=this.clipVertices1[Ns+1])-qi+_i)*-ji+((Vs=this.clipVertices1[Ns+2])-Ui+Ji)*-Di,B>0?F>0?(Ns=3*zs,zs++,this.clipVertices2[Ns]=Ms,this.clipVertices2[Ns+1]=Is,this.clipVertices2[Ns+2]=Vs):(Ns=3*zs,zs++,os=B/(B-F),this.clipVertices2[Ns]=ks+(Ms-ks)*os,this.clipVertices2[Ns+1]=ws+(Is-ws)*os,this.clipVertices2[Ns+2]=gs+(Vs-gs)*os):F>0&&(Ns=3*zs,zs++,os=B/(B-F),this.clipVertices2[Ns]=ks+(Ms-ks)*os,this.clipVertices2[Ns+1]=ws+(Is-ws)*os,this.clipVertices2[Ns+2]=gs+(Vs-gs)*os,Ns=3*zs,zs++,this.clipVertices2[Ns]=Ms,this.clipVertices2[Ns+1]=Is,this.clipVertices2[Ns+2]=Vs),ks=Ms,ws=Is,gs=Vs,B=F;if(0!=(vs=zs)){for(zs=0,Ns=3*(vs-1),B=((ks=this.clipVertices2[Ns])-Fi+Wi)*-Ci+((ws=this.clipVertices2[Ns+1])-qi+Hi)*-Ei+((gs=this.clipVertices2[Ns+2])-Ui+Yi)*-Bi,Ts=0;Ts<vs;Ts++)Ns=3*Ts,F=((Ms=this.clipVertices2[Ns])-Fi+Wi)*-Ci+((Is=this.clipVertices2[Ns+1])-qi+Hi)*-Ei+((Vs=this.clipVertices2[Ns+2])-Ui+Yi)*-Bi,B>0?F>0?(Ns=3*zs,zs++,this.clipVertices1[Ns]=Ms,this.clipVertices1[Ns+1]=Is,this.clipVertices1[Ns+2]=Vs):(Ns=3*zs,zs++,os=B/(B-F),this.clipVertices1[Ns]=ks+(Ms-ks)*os,this.clipVertices1[Ns+1]=ws+(Is-ws)*os,this.clipVertices1[Ns+2]=gs+(Vs-gs)*os):F>0&&(Ns=3*zs,zs++,os=B/(B-F),this.clipVertices1[Ns]=ks+(Ms-ks)*os,this.clipVertices1[Ns+1]=ws+(Is-ws)*os,this.clipVertices1[Ns+2]=gs+(Vs-gs)*os,Ns=3*zs,zs++,this.clipVertices1[Ns]=Ms,this.clipVertices1[Ns+1]=Is,this.clipVertices1[Ns+2]=Vs),ks=Ms,ws=Is,gs=Vs,B=F;if(Qi){var As=h;h=e,e=As}if(0!=(vs=zs)){var Os=h!=t;if(vs>4){Oi=ns-(ks=.25*(ns+cs+us+ds)),ji=rs-(ws=.25*(rs+ms+ys+fs)),Di=ls-(gs=.25*(ls+ps+xs+bs)),Ci=cs-ks,Ei=ms-ws,Bi=ps-gs;var js=0,Ds=0,Cs=0,Es=0,Bs=-this.INF;for(Ss=this.INF,Ts=0;Ts<vs;Ts++)this.used[Ts]=!1,Ns=3*Ts,(Ls=(ks=this.clipVertices1[Ns])*Oi+(ws=this.clipVertices1[Ns+1])*ji+(gs=this.clipVertices1[Ns+2])*Di)<Ss&&(Ss=Ls,js=Ts),Ls>Bs&&(Bs=Ls,Cs=Ts);for(this.used[js]=!0,this.used[Cs]=!0,Bs=-this.INF,Ss=this.INF,Ts=0;Ts<vs;Ts++)this.used[Ts]||(Ns=3*Ts,(Ls=(ks=this.clipVertices1[Ns])*Ci+(ws=this.clipVertices1[Ns+1])*Ei+(gs=this.clipVertices1[Ns+2])*Bi)<Ss&&(Ss=Ls,Ds=Ts),Ls>Bs&&(Bs=Ls,Es=Ts));Ns=3*js,(Ls=((ks=this.clipVertices1[Ns])-Fi)*Pi+((ws=this.clipVertices1[Ns+1])-qi)*Ti+((gs=this.clipVertices1[Ns+2])-Ui)*Ai)<0&&s.addPoint(ks,ws,gs,Pi,Ti,Ai,Ls,Os),Ns=3*Ds,(Ls=((ks=this.clipVertices1[Ns])-Fi)*Pi+((ws=this.clipVertices1[Ns+1])-qi)*Ti+((gs=this.clipVertices1[Ns+2])-Ui)*Ai)<0&&s.addPoint(ks,ws,gs,Pi,Ti,Ai,Ls,Os),Ns=3*Cs,(Ls=((ks=this.clipVertices1[Ns])-Fi)*Pi+((ws=this.clipVertices1[Ns+1])-qi)*Ti+((gs=this.clipVertices1[Ns+2])-Ui)*Ai)<0&&s.addPoint(ks,ws,gs,Pi,Ti,Ai,Ls,Os),Ns=3*Es,(Ls=((ks=this.clipVertices1[Ns])-Fi)*Pi+((ws=this.clipVertices1[Ns+1])-qi)*Ti+((gs=this.clipVertices1[Ns+2])-Ui)*Ai)<0&&s.addPoint(ks,ws,gs,Pi,Ti,Ai,Ls,Os)}else for(Ts=0;Ts<vs;Ts++)Ns=3*Ts,(Ls=((ks=this.clipVertices1[Ns])-Fi)*Pi+((ws=this.clipVertices1[Ns+1])-qi)*Ti+((gs=this.clipVertices1[Ns+2])-Ui)*Ai)<0&&s.addPoint(ks,ws,gs,Pi,Ti,Ai,Ls,Os)}}}}}}}}),Dt.prototype=Object.assign(Object.create(Ot.prototype),{constructor:Dt,getSep:function(t,i,s,h,e){var a,o,n,r,l,c,m,p,u,y,x,d,f,b=new C,v=t.position.x,z=t.position.y,N=t.position.z,k=i.position.x,w=i.position.y,g=i.position.z,M=k-v,I=w-z,V=g-N;M*M+I*I+V*V==0&&(I=.001);var S=-M,L=-I,P=-V;this.supportPointB(t,-S,-L,-P,b);var T=b.x,A=b.y,j=b.z;this.supportPointC(i,S,L,P,b);var D=b.x,E=b.y,B=b.z,F=D-T,q=E-A,U=B-j;if(F*S+q*L+U*P<=0)return!1;if((S=q*V-U*I)*S+(L=U*M-F*V)*L+(P=F*I-q*M)*P==0)return s.set(F-M,q-I,U-V).normalize(),h.set(.5*(T+D),.5*(A+E),.5*(j+B)),!0;this.supportPointB(t,-S,-L,-P,b);var R=b.x,_=b.y,J=b.z;this.supportPointC(i,S,L,P,b);var W=b.x,H=b.y,Y=b.z,Q=W-R,X=H-_,K=Y-J;if(Q*S+X*L+K*P<=0)return!1;(S=(o=q-I)*(c=K-V)-(n=U-V)*(l=X-I))*M+(L=n*(r=Q-M)-(a=F-M)*c)*I+(P=a*l-o*r)*V>0&&(a=F,o=q,n=U,F=Q,q=X,U=K,Q=a,X=o,K=n,a=T,o=A,n=j,T=R,A=_,j=J,R=a,_=o,J=n,a=D,o=E,n=B,D=W,E=H,B=Y,W=a,H=o,Y=n,S=-S,L=-L,P=-P);for(var Z=0;;){if(++Z>100)return!1;this.supportPointB(t,-S,-L,-P,b);var G=b.x,$=b.y,tt=b.z;this.supportPointC(i,S,L,P,b);var it=b.x,st=b.y,ht=b.z,et=it-G,at=st-$,ot=ht-tt;if(et*S+at*L+ot*P<=0)return!1;if((q*ot-U*at)*M+(U*et-F*ot)*I+(F*at-q*et)*V<0)Q=et,X=at,K=ot,R=G,_=$,J=tt,W=it,H=st,Y=ht,S=(o=q-I)*(c=ot-V)-(n=U-V)*(l=at-I),L=n*(r=et-M)-(a=F-M)*c,P=a*l-o*r;else if((at*K-ot*X)*M+(ot*Q-et*K)*I+(et*X-at*Q)*V<0)F=et,q=at,U=ot,T=G,A=$,j=tt,D=it,E=st,B=ht,S=(o=at-I)*(c=K-V)-(n=ot-V)*(l=X-I),L=n*(r=Q-M)-(a=et-M)*c,P=a*l-o*r;else for(var nt=!1;;){if(S=(o=X-q)*(c=ot-U)-(n=K-U)*(l=at-q),L=n*(r=et-F)-(a=Q-F)*c,P=a*l-o*r,(S*=m=1/O.sqrt(S*S+L*L+P*P))*F+(L*=m)*q+(P*=m)*U>=0&&!nt){var rt=(q*K-U*X)*et+(U*Q-F*K)*at+(F*X-q*Q)*ot,lt=(at*K-ot*X)*M+(ot*Q-et*K)*I+(et*X-at*Q)*V,ct=(I*U-V*q)*et+(V*F-M*U)*at+(M*q-I*F)*ot,mt=(X*U-K*q)*M+(K*F-Q*U)*I+(Q*q-X*F)*V,pt=rt+lt+ct+mt;pt<=0&&(rt=0,pt=(lt=(X*ot-K*at)*S+(K*et-Q*ot)*L+(Q*at-X*et)*P)+(ct=(at*K-ot*X)*S+(ot*Q-et*K)*L+(et*X-at*Q)*P)+(mt=(q*K-U*X)*S+(U*Q-F*K)*L+(F*X-q*Q)*P));var ut=1/pt;p=(v*rt+T*lt+R*ct+G*mt)*ut,u=(z*rt+A*lt+_*ct+$*mt)*ut,y=(N*rt+j*lt+J*ct+tt*mt)*ut,x=(k*rt+D*lt+W*ct+it*mt)*ut,d=(w*rt+E*lt+H*ct+st*mt)*ut,f=(g*rt+B*lt+Y*ct+ht*mt)*ut,nt=!0}this.supportPointB(t,-S,-L,-P,b);var yt=b.x,xt=b.y,dt=b.z;this.supportPointC(i,S,L,P,b);var ft=b.x,bt=b.y,vt=b.z,zt=ft-yt,Nt=bt-xt,kt=vt-dt,wt=-(zt*S+Nt*L+kt*P);if((zt-et)*S+(Nt-at)*L+(kt-ot)*P<=.01||wt>=0)return!!nt&&(s.set(-S,-L,-P),h.set(.5*(p+x),.5*(u+d),.5*(y+f)),e.x=wt,!0);(Nt*U-kt*q)*M+(kt*F-zt*U)*I+(zt*q-Nt*F)*V<0?(Nt*K-kt*X)*M+(kt*Q-zt*K)*I+(zt*X-Nt*Q)*V<0?(F=zt,q=Nt,U=kt,T=yt,A=xt,j=dt,D=ft,E=bt,B=vt):(et=zt,at=Nt,ot=kt,G=yt,$=xt,tt=dt,it=ft,st=bt,ht=vt):(Nt*ot-kt*at)*M+(kt*et-zt*ot)*I+(zt*at-Nt*et)*V<0?(Q=zt,X=Nt,K=kt,R=yt,_=xt,J=dt,W=ft,H=bt,Y=vt):(F=zt,q=Nt,U=kt,T=yt,A=xt,j=dt,D=ft,E=bt,B=vt)}}},supportPointB:function(t,i,s,h,e){var a,o,n,r=t.rotation.elements,l=r[0]*i+r[3]*s+r[6]*h,c=r[1]*i+r[4]*s+r[7]*h,m=r[2]*i+r[5]*s+r[8]*h,p=t.halfWidth,u=t.halfHeight,y=t.halfDepth;a=l<0?-p:p,o=c<0?-u:u,n=m<0?-y:y,l=r[0]*a+r[1]*o+r[2]*n+t.position.x,c=r[3]*a+r[4]*o+r[5]*n+t.position.y,m=r[6]*a+r[7]*o+r[8]*n+t.position.z,e.set(l,c,m)},supportPointC:function(t,i,s,h,e){var a,o,n,r=t.rotation.elements,l=r[0]*i+r[3]*s+r[6]*h,c=r[1]*i+r[4]*s+r[7]*h,m=r[2]*i+r[5]*s+r[8]*h,p=l,u=m,y=p*p+u*u,x=t.radius,d=t.halfHeight;0==y?c<0?(a=x,o=-d,n=0):(a=x,o=d,n=0):(y=t.radius/O.sqrt(y),c<0?(a=p*y,o=-d,n=u*y):(a=p*y,o=d,n=u*y)),l=r[0]*a+r[1]*o+r[2]*n+t.position.x,c=r[3]*a+r[4]*o+r[5]*n+t.position.y,m=r[6]*a+r[7]*o+r[8]*n+t.position.z,e.set(l,c,m)},detectCollision:function(t,i,s){var h,e;this.flip?(h=i,e=t):(h=t,e=i);var a=new C,o=new C,n=new C;if(this.getSep(h,e,a,o,n)){var r=h.position.x,l=h.position.y,c=h.position.z,m=e.position.x,p=e.position.y,u=e.position.z,y=h.halfWidth,x=h.halfHeight,d=h.halfDepth,f=e.halfHeight,b=e.radius,v=h.dimentions,z=v[0],N=v[1],k=v[2],w=v[3],g=v[4],M=v[5],I=v[6],V=v[7],S=v[8],L=v[9],P=v[10],T=v[11],A=v[12],j=v[13],D=v[14],E=v[15],B=v[16],F=v[17],q=e.normalDirection.x,U=e.normalDirection.y,R=e.normalDirection.z,_=e.halfDirection.x,J=e.halfDirection.y,W=e.halfDirection.z,H=a.x,Y=a.y,Q=a.z,X=H*z+Y*N+Q*k,K=H*w+Y*g+Q*M,Z=H*I+Y*V+Q*S,G=H*q+Y*U+Q*R,$=X>0,tt=K>0,it=Z>0,st=G>0;$||(X=-X),tt||(K=-K),it||(Z=-Z),st||(G=-G);var ht,et,at,ot,nt,rt,lt,ct,mt,pt,ut,yt,xt,dt,ft,bt,vt,zt,Nt,kt,wt,gt,Mt,It,Vt,St,Lt,Pt,Tt,At,Ot,jt,Dt,Ct,Et,Bt,Ft,qt,Ut,Rt,_t,Jt,Wt,Ht,Yt,Qt,Xt,Kt,Zt,Gt,$t,ti,ii,si=0;if(G>.999?si=X>.999?X>G?1:4:K>.999?K>G?2:4:Z>.999&&Z>G?3:4:X>.999?si=1:K>.999?si=2:Z>.999&&(si=3),0==si)s.addPoint(o.x,o.y,o.z,H,Y,Q,n.x,this.flip);else if(4==si){var hi,ei,ai,oi,ni,ri,li,ci,mi,pi,ui,yi;st?(ot=m-_,nt=p-J,rt=u-W,H=-q,Y=-U,Q=-R):(ot=m+_,nt=p+J,rt=u+W,H=q,Y=U,Q=R),si=0,(Wt=z*H+N*Y+k*Q)<(kt=1)&&(kt=Wt,si=0),-Wt<kt&&(kt=-Wt,si=1),(Wt=w*H+g*Y+M*Q)<kt&&(kt=Wt,si=2),-Wt<kt&&(kt=-Wt,si=3),(Wt=I*H+V*Y+S*Q)<kt&&(kt=Wt,si=4),-Wt<kt&&(kt=-Wt,si=5);var xi=h.elements;switch(si){case 0:hi=xi[0],ei=xi[1],ai=xi[2],oi=xi[6],ni=xi[7],ri=xi[8],li=xi[9],ci=xi[10],mi=xi[11],pi=xi[3],ui=xi[4],yi=xi[5];break;case 1:hi=xi[15],ei=xi[16],ai=xi[17],oi=xi[21],ni=xi[22],ri=xi[23],li=xi[18],ci=xi[19],mi=xi[20],pi=xi[12],ui=xi[13],yi=xi[14];break;case 2:hi=xi[12],ei=xi[13],ai=xi[14],oi=xi[0],ni=xi[1],ri=xi[2],li=xi[3],ci=xi[4],mi=xi[5],pi=xi[15],ui=xi[16],yi=xi[17];break;case 3:hi=xi[21],ei=xi[22],ai=xi[23],oi=xi[9],ni=xi[10],ri=xi[11],li=xi[6],ci=xi[7],mi=xi[8],pi=xi[18],ui=xi[19],yi=xi[20];break;case 4:hi=xi[12],ei=xi[13],ai=xi[14],oi=xi[18],ni=xi[19],ri=xi[20],li=xi[6],ci=xi[7],mi=xi[8],pi=xi[0],ui=xi[1],yi=xi[2];break;case 5:hi=xi[3],ei=xi[4],ai=xi[5],oi=xi[9],ni=xi[10],ri=xi[11],li=xi[21],ci=xi[22],mi=xi[23],pi=xi[15],ui=xi[16],yi=xi[17]}(Nt=H*(hi-ot)+Y*(ei-nt)+Q*(ai-rt))<=0&&s.addPoint(hi,ei,ai,-H,-Y,-Q,Nt,this.flip),(Nt=H*(oi-ot)+Y*(ni-nt)+Q*(ri-rt))<=0&&s.addPoint(oi,ni,ri,-H,-Y,-Q,Nt,this.flip),(Nt=H*(li-ot)+Y*(ci-nt)+Q*(mi-rt))<=0&&s.addPoint(li,ci,mi,-H,-Y,-Q,Nt,this.flip),(Nt=H*(pi-ot)+Y*(ui-nt)+Q*(yi-rt))<=0&&s.addPoint(pi,ui,yi,-H,-Y,-Q,Nt,this.flip)}else{switch(si){case 1:$?(ht=r+L,et=l+P,at=c+T,H=z,Y=N,Q=k):(ht=r-L,et=l-P,at=c-T,H=-z,Y=-N,Q=-k),Qt=w,Xt=g,Kt=M,ti=x,Zt=I,Gt=V,$t=S,ii=d;break;case 2:tt?(ht=r+A,et=l+j,at=c+D,H=w,Y=g,Q=M):(ht=r-A,et=l-j,at=c-D,H=-w,Y=-g,Q=-M),Qt=z,Xt=N,Kt=k,ti=y,Zt=I,Gt=V,$t=S,ii=d;break;case 3:it?(ht=r+E,et=l+B,at=c+F,H=I,Y=V,Q=S):(ht=r-E,et=l-B,at=c-F,H=-I,Y=-V,Q=-S),Qt=z,Xt=N,Kt=k,ti=y,Zt=w,Gt=g,$t=M,ii=x}if(ot=m+(wt=(kt=H*q+Y*U+Q*R)<0?f:-f)*q,nt=p+wt*U,rt=u+wt*R,G>=.999999?(gt=-Y,Mt=Q,It=H):(gt=H,Mt=Y,It=Q),St=(wt=gt*q+Mt*U+It*R)*q-gt,Lt=wt*U-Mt,Pt=wt*R-It,0==(wt=O.sqrt(St*St+Lt*Lt+Pt*Pt)))return;if(gt=ot+(St*=wt=b/wt),Mt=nt+(Lt*=wt),It=rt+(Pt*=wt),kt<-.96||kt>.96)lt=q*q*1.5-.5,ct=q*U*1.5-.866025403*R,mt=q*R*1.5+.866025403*U,pt=U*q*1.5+.866025403*R,ut=U*U*1.5-.5,yt=U*R*1.5-.866025403*q,xt=R*q*1.5-.866025403*U,dt=R*U*1.5+.866025403*q,ft=R*R*1.5-.5,(qt=Qt*(gt=(bt=gt)-(Nt=H*(bt-ht)+Y*((vt=Mt)-et)+Q*((zt=It)-at))*H-ht)+Xt*(Mt=vt-Nt*Y-et)+Kt*(It=zt-Nt*Q-at))<-ti?qt=-ti:qt>ti&&(qt=ti),(Jt=Zt*gt+Gt*Mt+$t*It)<-ii?Jt=-ii:Jt>ii&&(Jt=ii),bt=ht+(gt=qt*Qt+Jt*Zt),vt=et+(Mt=qt*Xt+Jt*Gt),zt=at+(It=qt*Kt+Jt*$t),s.addPoint(bt,vt,zt,H,Y,Q,Nt,this.flip),vt=St*pt+Lt*ut+Pt*yt,zt=St*xt+Lt*dt+Pt*ft,(Nt=H*((bt=(St=bt=St*lt+Lt*ct+Pt*mt)+ot)-ht)+Y*((vt=(Lt=vt)+nt)-et)+Q*((zt=(Pt=zt)+rt)-at))<=0&&((qt=Qt*(gt=bt-Nt*H-ht)+Xt*(Mt=vt-Nt*Y-et)+Kt*(It=zt-Nt*Q-at))<-ti?qt=-ti:qt>ti&&(qt=ti),(Jt=Zt*gt+Gt*Mt+$t*It)<-ii?Jt=-ii:Jt>ii&&(Jt=ii),bt=ht+(gt=qt*Qt+Jt*Zt),vt=et+(Mt=qt*Xt+Jt*Gt),zt=at+(It=qt*Kt+Jt*$t),s.addPoint(bt,vt,zt,H,Y,Q,Nt,this.flip)),vt=St*pt+Lt*ut+Pt*yt,zt=St*xt+Lt*dt+Pt*ft,(Nt=H*((bt=(St=bt=St*lt+Lt*ct+Pt*mt)+ot)-ht)+Y*((vt=(Lt=vt)+nt)-et)+Q*((zt=(Pt=zt)+rt)-at))<=0&&((qt=Qt*(gt=bt-Nt*H-ht)+Xt*(Mt=vt-Nt*Y-et)+Kt*(It=zt-Nt*Q-at))<-ti?qt=-ti:qt>ti&&(qt=ti),(Jt=Zt*gt+Gt*Mt+$t*It)<-ii?Jt=-ii:Jt>ii&&(Jt=ii),bt=ht+(gt=qt*Qt+Jt*Zt),vt=et+(Mt=qt*Xt+Jt*Gt),zt=at+(It=qt*Kt+Jt*$t),s.addPoint(bt,vt,zt,H,Y,Q,Nt,this.flip));else{if(Et=gt,kt>0?(Ut=gt+2*_,Rt=Mt+2*J,_t=It+2*W):(Ut=gt-2*_,Rt=Mt-2*J,_t=It-2*W),gt=(Ut-=(Jt=H*(Ut-ht)+Y*(Rt-et)+Q*(_t-at))*H)-(Et-=(qt=H*(Et-ht)+Y*((Bt=Mt)-et)+Q*((Ft=It)-at))*H),Mt=(Rt-=Jt*Y)-(Bt-=qt*Y),It=(_t-=Jt*Q)-(Ft-=qt*Q),Vt=Jt-qt,Ht=(K=(jt=Ut-ht)*Qt+(Dt=Rt-et)*Xt+(Ct=_t-at)*Kt)-ti,(Wt=(X=(Tt=Et-ht)*Qt+(At=Bt-et)*Xt+(Ot=Ft-at)*Kt)-ti)>0){if(Ht>0)return;X=(Tt=(Et+=gt*(Yt=Wt/(Wt-Ht)))-ht)*Qt+(At=(Bt+=Mt*Yt)-et)*Xt+(Ot=(Ft+=It*Yt)-at)*Kt,gt=Ut-Et,Mt=Rt-Bt,It=_t-Ft,Vt=Jt-(qt+=Vt*Yt)}else Ht>0&&(K=(jt=(Ut=Et+gt*(Yt=Wt/(Wt-Ht)))-ht)*Qt+(Dt=(Rt=Bt+Mt*Yt)-et)*Xt+(Ct=(_t=Ft+It*Yt)-at)*Kt,gt=Ut-Et,Mt=Rt-Bt,It=_t-Ft,Vt=(Jt=qt+Vt*Yt)-qt);if(Ht=K+ti,(Wt=X+ti)<0){if(Ht<0)return;Tt=(Et+=gt*(Yt=Wt/(Wt-Ht)))-ht,At=(Bt+=Mt*Yt)-et,Ot=(Ft+=It*Yt)-at,gt=Ut-Et,Mt=Rt-Bt,It=_t-Ft,Vt=Jt-(qt+=Vt*Yt)}else Ht<0&&(jt=(Ut=Et+gt*(Yt=Wt/(Wt-Ht)))-ht,Dt=(Rt=Bt+Mt*Yt)-et,Ct=(_t=Ft+It*Yt)-at,gt=Ut-Et,Mt=Rt-Bt,It=_t-Ft,Vt=(Jt=qt+Vt*Yt)-qt);if(Ht=(K=jt*Zt+Dt*Gt+Ct*$t)-ii,(Wt=(X=Tt*Zt+At*Gt+Ot*$t)-ii)>0){if(Ht>0)return;X=(Tt=(Et+=gt*(Yt=Wt/(Wt-Ht)))-ht)*Zt+(At=(Bt+=Mt*Yt)-et)*Gt+(Ot=(Ft+=It*Yt)-at)*$t,gt=Ut-Et,Mt=Rt-Bt,It=_t-Ft,Vt=Jt-(qt+=Vt*Yt)}else Ht>0&&(K=(jt=(Ut=Et+gt*(Yt=Wt/(Wt-Ht)))-ht)*Zt+(Dt=(Rt=Bt+Mt*Yt)-et)*Gt+(Ct=(_t=Ft+It*Yt)-at)*$t,gt=Ut-Et,Mt=Rt-Bt,It=_t-Ft,Vt=(Jt=qt+Vt*Yt)-qt);if(Ht=K+ii,(Wt=X+ii)<0){if(Ht<0)return;Et+=gt*(Yt=Wt/(Wt-Ht)),Bt+=Mt*Yt,Ft+=It*Yt,qt+=Vt*Yt}else Ht<0&&(Ut=Et+gt*(Yt=Wt/(Wt-Ht)),Rt=Bt+Mt*Yt,_t=Ft+It*Yt,Jt=qt+Vt*Yt);qt<0&&s.addPoint(Et,Bt,Ft,H,Y,Q,qt,this.flip),Jt<0&&s.addPoint(Ut,Rt,_t,H,Y,Q,Jt,this.flip)}}}}}),Ct.prototype=Object.assign(Object.create(Ot.prototype),{constructor:Ct,getSep:function(t,i,s,h,e){var a,o,n,r,l,c,m,p,u,y,x,d,f,b=new C,v=t.position.x,z=t.position.y,N=t.position.z,k=i.position.x,w=i.position.y,g=i.position.z,M=k-v,I=w-z,V=g-N;M*M+I*I+V*V==0&&(I=.001);var S=-M,L=-I,P=-V;this.supportPoint(t,-S,-L,-P,b);var T=b.x,A=b.y,j=b.z;this.supportPoint(i,S,L,P,b);var D=b.x,E=b.y,B=b.z,F=D-T,q=E-A,U=B-j;if(F*S+q*L+U*P<=0)return!1;if((S=q*V-U*I)*S+(L=U*M-F*V)*L+(P=F*I-q*M)*P==0)return s.set(F-M,q-I,U-V).normalize(),h.set(.5*(T+D),.5*(A+E),.5*(j+B)),!0;this.supportPoint(t,-S,-L,-P,b);var R=b.x,_=b.y,J=b.z;this.supportPoint(i,S,L,P,b);var W=b.x,H=b.y,Y=b.z,Q=W-R,X=H-_,K=Y-J;if(Q*S+X*L+K*P<=0)return!1;(S=(o=q-I)*(c=K-V)-(n=U-V)*(l=X-I))*M+(L=n*(r=Q-M)-(a=F-M)*c)*I+(P=a*l-o*r)*V>0&&(a=F,o=q,n=U,F=Q,q=X,U=K,Q=a,X=o,K=n,a=T,o=A,n=j,T=R,A=_,j=J,R=a,_=o,J=n,a=D,o=E,n=B,D=W,E=H,B=Y,W=a,H=o,Y=n,S=-S,L=-L,P=-P);for(var Z=0;;){if(++Z>100)return!1;this.supportPoint(t,-S,-L,-P,b);var G=b.x,$=b.y,tt=b.z;this.supportPoint(i,S,L,P,b);var it=b.x,st=b.y,ht=b.z,et=it-G,at=st-$,ot=ht-tt;if(et*S+at*L+ot*P<=0)return!1;if((q*ot-U*at)*M+(U*et-F*ot)*I+(F*at-q*et)*V<0)Q=et,X=at,K=ot,R=G,_=$,J=tt,W=it,H=st,Y=ht,S=(o=q-I)*(c=ot-V)-(n=U-V)*(l=at-I),L=n*(r=et-M)-(a=F-M)*c,P=a*l-o*r;else if((at*K-ot*X)*M+(ot*Q-et*K)*I+(et*X-at*Q)*V<0)F=et,q=at,U=ot,T=G,A=$,j=tt,D=it,E=st,B=ht,S=(o=at-I)*(c=K-V)-(n=ot-V)*(l=X-I),L=n*(r=Q-M)-(a=et-M)*c,P=a*l-o*r;else for(var nt=!1;;){if(S=(o=X-q)*(c=ot-U)-(n=K-U)*(l=at-q),L=n*(r=et-F)-(a=Q-F)*c,P=a*l-o*r,(S*=m=1/O.sqrt(S*S+L*L+P*P))*F+(L*=m)*q+(P*=m)*U>=0&&!nt){var rt=(q*K-U*X)*et+(U*Q-F*K)*at+(F*X-q*Q)*ot,lt=(at*K-ot*X)*M+(ot*Q-et*K)*I+(et*X-at*Q)*V,ct=(I*U-V*q)*et+(V*F-M*U)*at+(M*q-I*F)*ot,mt=(X*U-K*q)*M+(K*F-Q*U)*I+(Q*q-X*F)*V,pt=rt+lt+ct+mt;pt<=0&&(rt=0,pt=(lt=(X*ot-K*at)*S+(K*et-Q*ot)*L+(Q*at-X*et)*P)+(ct=(at*K-ot*X)*S+(ot*Q-et*K)*L+(et*X-at*Q)*P)+(mt=(q*K-U*X)*S+(U*Q-F*K)*L+(F*X-q*Q)*P));var ut=1/pt;p=(v*rt+T*lt+R*ct+G*mt)*ut,u=(z*rt+A*lt+_*ct+$*mt)*ut,y=(N*rt+j*lt+J*ct+tt*mt)*ut,x=(k*rt+D*lt+W*ct+it*mt)*ut,d=(w*rt+E*lt+H*ct+st*mt)*ut,f=(g*rt+B*lt+Y*ct+ht*mt)*ut,nt=!0}this.supportPoint(t,-S,-L,-P,b);var yt=b.x,xt=b.y,dt=b.z;this.supportPoint(i,S,L,P,b);var ft=b.x,bt=b.y,vt=b.z,zt=ft-yt,Nt=bt-xt,kt=vt-dt,wt=-(zt*S+Nt*L+kt*P);if((zt-et)*S+(Nt-at)*L+(kt-ot)*P<=.01||wt>=0)return!!nt&&(s.set(-S,-L,-P),h.set(.5*(p+x),.5*(u+d),.5*(y+f)),e.x=wt,!0);(Nt*U-kt*q)*M+(kt*F-zt*U)*I+(zt*q-Nt*F)*V<0?(Nt*K-kt*X)*M+(kt*Q-zt*K)*I+(zt*X-Nt*Q)*V<0?(F=zt,q=Nt,U=kt,T=yt,A=xt,j=dt,D=ft,E=bt,B=vt):(et=zt,at=Nt,ot=kt,G=yt,$=xt,tt=dt,it=ft,st=bt,ht=vt):(Nt*ot-kt*at)*M+(kt*et-zt*ot)*I+(zt*at-Nt*et)*V<0?(Q=zt,X=Nt,K=kt,R=yt,_=xt,J=dt,W=ft,H=bt,Y=vt):(F=zt,q=Nt,U=kt,T=yt,A=xt,j=dt,D=ft,E=bt,B=vt)}}},supportPoint:function(t,i,s,h,e){var a,o,n,r=t.rotation.elements,l=r[0]*i+r[3]*s+r[6]*h,c=r[1]*i+r[4]*s+r[7]*h,m=r[2]*i+r[5]*s+r[8]*h,p=l,u=m,y=p*p+u*u,x=t.radius,d=t.halfHeight;0==y?c<0?(a=x,o=-d,n=0):(a=x,o=d,n=0):(y=t.radius/O.sqrt(y),c<0?(a=p*y,o=-d,n=u*y):(a=p*y,o=d,n=u*y)),l=r[0]*a+r[1]*o+r[2]*n+t.position.x,c=r[3]*a+r[4]*o+r[5]*n+t.position.y,m=r[6]*a+r[7]*o+r[8]*n+t.position.z,e.set(l,c,m)},detectCollision:function(t,i,s){var h,e;t.id<i.id?(h=t,e=i):(h=i,e=t);var a,o,n,r,l,c,m,p,u,y,x,d,f,b,v,z,N,k,w,g,M,I=h.position,V=e.position,S=I.x,L=I.y,P=I.z,T=V.x,A=V.y,j=V.z,D=h.halfHeight,E=e.halfHeight,B=h.normalDirection,F=e.normalDirection,q=h.halfDirection,U=e.halfDirection,R=h.radius,_=e.radius,J=B.x,W=B.y,H=B.z,Y=F.x,Q=F.y,X=F.z,K=q.x,Z=q.y,G=q.z,$=U.x,tt=U.y,it=U.z,st=S-T,ht=L-A,et=P-j,at=new C,ot=new C,nt=new C;if(this.getSep(h,e,at,ot,nt)){var rt=at.x*J+at.y*W+at.z*H,lt=at.x*Y+at.y*Q+at.z*X,ct=rt>0,mt=lt>0;ct||(rt=-rt),mt||(lt=-lt);var pt,ut,yt,xt=0;(rt>.999||lt>.999)&&(xt=rt>lt?1:2);var dt,ft,bt,vt,zt,Nt,kt,wt,gt,Mt,It,Vt,St,Lt,Pt,Tt,At=nt.x;switch(pt=at.x,ut=at.y,yt=at.z,xt){case 0:s.addPoint(ot.x,ot.y,ot.z,pt,ut,yt,At,!1);break;case 1:if(ct?(o=S+K,n=L+Z,r=P+G,pt=J,ut=W,yt=H):(o=S-K,n=L-Z,r=P-G,pt=-J,ut=-W,yt=-H),l=T+(a=(w=pt*Y+ut*Q+yt*X)<0?E:-E)*Y,c=A+a*Q,m=j+a*X,lt>=.999999?(p=-ut,u=yt,y=pt):(p=pt,u=ut,y=yt),st=(a=p*Y+u*Q+y*X)*Y-p,ht=a*Q-u,et=a*X-y,0==(a=O.sqrt(st*st+ht*ht+et*et)))break;if(p=l+(st*=a=_/a),u=c+(ht*=a),y=m+(et*=a),w<-.96||w>.96)dt=Y*Y*1.5-.5,ft=Y*Q*1.5-.866025403*X,bt=Y*X*1.5+.866025403*Q,vt=Q*Y*1.5+.866025403*X,zt=Q*Q*1.5-.5,Nt=Q*X*1.5-.866025403*Y,kt=X*Y*1.5-.866025403*Q,wt=X*Q*1.5+.866025403*Y,gt=X*X*1.5-.5,(a=(p=(Mt=p)-(St=pt*(Mt-o)+ut*((It=u)-n)+yt*((Vt=y)-r))*pt-o)*p+(u=It-St*ut-n)*u+(y=Vt-St*yt-r)*y)>R*R&&(p*=a=R/O.sqrt(a),u*=a,y*=a),Mt=o+p,It=n+u,Vt=r+y,s.addPoint(Mt,It,Vt,pt,ut,yt,St,!1),It=st*vt+ht*zt+et*Nt,Vt=st*kt+ht*wt+et*gt,(St=pt*((Mt=(st=Mt=st*dt+ht*ft+et*bt)+l)-o)+ut*((It=(ht=It)+c)-n)+yt*((Vt=(et=Vt)+m)-r))<=0&&((a=(p=Mt-St*pt-o)*p+(u=It-St*ut-n)*u+(y=Vt-St*yt-r)*y)>R*R&&(p*=a=R/O.sqrt(a),u*=a,y*=a),Mt=o+p,It=n+u,Vt=r+y,s.addPoint(Mt,It,Vt,pt,ut,yt,St,!1)),It=st*vt+ht*zt+et*Nt,Vt=st*kt+ht*wt+et*gt,(St=pt*((Mt=(st=Mt=st*dt+ht*ft+et*bt)+l)-o)+ut*((It=(ht=It)+c)-n)+yt*((Vt=(et=Vt)+m)-r))<=0&&((a=(p=Mt-St*pt-o)*p+(u=It-St*ut-n)*u+(y=Vt-St*yt-r)*y)>R*R&&(p*=a=R/O.sqrt(a),u*=a,y*=a),Mt=o+p,It=n+u,Vt=r+y,s.addPoint(Mt,It,Vt,pt,ut,yt,St,!1));else{if(x=p,w>0?(b=p+Y*E*2,v=u+Q*E*2,z=y+X*E*2):(b=p-Y*E*2,v=u-Q*E*2,z=y-X*E*2),(Tt=(Lt=(st=o-(x-=(N=pt*(x-o)+ut*((d=u)-n)+yt*((f=y)-r))*pt))*(p=(b-=(k=pt*(b-o)+ut*(v-n)+yt*(z-r))*pt)-x)+(ht=n-(d-=N*ut))*(u=(v-=k*ut)-d)+(et=r-(f-=N*yt))*(y=(z-=k*yt)-f))*Lt-(Pt=p*p+u*u+y*y)*(st*st+ht*ht+et*et-R*R))<0)break;(M=(Lt-(Tt=O.sqrt(Tt)))/Pt)<(g=(Lt+Tt)/Pt)&&(a=g,g=M,M=a),M>1&&(M=1),g<0&&(g=0),p=x+(b-x)*g,u=d+(v-d)*g,y=f+(z-f)*g,b=x+(b-x)*M,v=d+(v-d)*M,z=f+(z-f)*M,x=p,d=u,f=y,a=N+(k-N)*g,k=N+(k-N)*M,(N=a)<0&&s.addPoint(x,d,f,pt,ut,yt,St,!1),k<0&&s.addPoint(b,v,z,pt,ut,yt,St,!1)}break;case 2:if(mt?(l=T-$,c=A-tt,m=j-it,pt=-Y,ut=-Q,yt=-X):(l=T+$,c=A+tt,m=j+it,pt=Y,ut=Q,yt=X),o=S+(a=(w=pt*J+ut*W+yt*H)<0?D:-D)*J,n=L+a*W,r=P+a*H,rt>=.999999?(p=-ut,u=yt,y=pt):(p=pt,u=ut,y=yt),st=(a=p*J+u*W+y*H)*J-p,ht=a*W-u,et=a*H-y,0==(a=O.sqrt(st*st+ht*ht+et*et)))break;if(p=o+(st*=a=R/a),u=n+(ht*=a),y=r+(et*=a),w<-.96||w>.96)dt=J*J*1.5-.5,ft=J*W*1.5-.866025403*H,bt=J*H*1.5+.866025403*W,vt=W*J*1.5+.866025403*H,zt=W*W*1.5-.5,Nt=W*H*1.5-.866025403*J,kt=H*J*1.5-.866025403*W,wt=H*W*1.5+.866025403*J,gt=H*H*1.5-.5,(a=(p=(Mt=p)-(St=pt*(Mt-l)+ut*((It=u)-c)+yt*((Vt=y)-m))*pt-l)*p+(u=It-St*ut-c)*u+(y=Vt-St*yt-m)*y)>_*_&&(p*=a=_/O.sqrt(a),u*=a,y*=a),Mt=l+p,It=c+u,Vt=m+y,s.addPoint(Mt,It,Vt,-pt,-ut,-yt,St,!1),It=st*vt+ht*zt+et*Nt,Vt=st*kt+ht*wt+et*gt,(St=pt*((Mt=(st=Mt=st*dt+ht*ft+et*bt)+o)-l)+ut*((It=(ht=It)+n)-c)+yt*((Vt=(et=Vt)+r)-m))<=0&&((a=(p=Mt-St*pt-l)*p+(u=It-St*ut-c)*u+(y=Vt-St*yt-m)*y)>_*_&&(p*=a=_/O.sqrt(a),u*=a,y*=a),Mt=l+p,It=c+u,Vt=m+y,s.addPoint(Mt,It,Vt,-pt,-ut,-yt,St,!1)),It=st*vt+ht*zt+et*Nt,Vt=st*kt+ht*wt+et*gt,(St=pt*((Mt=(st=Mt=st*dt+ht*ft+et*bt)+o)-l)+ut*((It=(ht=It)+n)-c)+yt*((Vt=(et=Vt)+r)-m))<=0&&((a=(p=Mt-St*pt-l)*p+(u=It-St*ut-c)*u+(y=Vt-St*yt-m)*y)>_*_&&(p*=a=_/O.sqrt(a),u*=a,y*=a),Mt=l+p,It=c+u,Vt=m+y,s.addPoint(Mt,It,Vt,-pt,-ut,-yt,St,!1));else{if(x=p,w>0?(b=p+J*D*2,v=u+W*D*2,z=y+H*D*2):(b=p-J*D*2,v=u-W*D*2,z=y-H*D*2),(Tt=(Lt=(st=l-(x-=(N=pt*(x-l)+ut*((d=u)-c)+yt*((f=y)-m))*pt))*(p=(b-=(k=pt*(b-l)+ut*(v-c)+yt*(z-m))*pt)-x)+(ht=c-(d-=N*ut))*(u=(v-=k*ut)-d)+(et=m-(f-=N*yt))*(y=(z-=k*yt)-f))*Lt-(Pt=p*p+u*u+y*y)*(st*st+ht*ht+et*et-_*_))<0)break;(M=(Lt-(Tt=O.sqrt(Tt)))/Pt)<(g=(Lt+Tt)/Pt)&&(a=g,g=M,M=a),M>1&&(M=1),g<0&&(g=0),p=x+(b-x)*g,u=d+(v-d)*g,y=f+(z-f)*g,b=x+(b-x)*M,v=d+(v-d)*M,z=f+(z-f)*M,x=p,d=u,f=y,a=N+(k-N)*g,k=N+(k-N)*M,(N=a)<0&&s.addPoint(x,d,f,-pt,-ut,-yt,N,!1),k<0&&s.addPoint(b,v,z,-pt,-ut,-yt,k,!1)}}}}}),Et.prototype=Object.assign(Object.create(Ot.prototype),{constructor:Et,detectCollision:function(t,i,s){var h,e;this.flip?(h=i,e=t):(h=t,e=i);var a,o,n,r,l,c=e.dimentions,m=h.position,p=m.x,u=m.y,y=m.z,x=e.position,d=x.x,f=x.y,b=x.z,v=h.radius,z=e.halfWidth,N=e.halfHeight,k=e.halfDepth,w=p-d,g=u-f,M=y-b,I=c[0]*w+c[1]*g+c[2]*M,V=c[3]*w+c[4]*g+c[5]*M,S=c[6]*w+c[7]*g+c[8]*M,L=0;I>z?I=z:I<-z?I=-z:L=1,V>N?V=N:V<-N?V=-N:L|=2,S>k?S=k:S<-k?S=-k:L|=4,7==L?(M=S<0?k+S:k-S,(w=I<0?z+I:z-I)<(g=V<0?N+V:N-V)?w<M?(r=w-z,I<0?(I=-z,w=c[0],g=c[1],M=c[2]):(I=z,w=-c[0],g=-c[1],M=-c[2])):(r=M-k,S<0?(S=-k,w=c[6],g=c[7],M=c[8]):(S=k,w=-c[6],g=-c[7],M=-c[8])):g<M?(r=g-N,V<0?(V=-N,w=c[3],g=c[4],M=c[5]):(V=N,w=-c[3],g=-c[4],M=-c[5])):(r=M-k,S<0?(S=-k,w=c[6],g=c[7],M=c[8]):(S=k,w=-c[6],g=-c[7],M=-c[8])),a=d+I*c[0]+V*c[3]+S*c[6],o=f+I*c[1]+V*c[4]+S*c[7],n=b+I*c[2]+V*c[5]+S*c[8],s.addPoint(p+v*w,u+v*g,y+v*M,w,g,M,r-v,this.flip)):(a=d+I*c[0]+V*c[3]+S*c[6],o=f+I*c[1]+V*c[4]+S*c[7],n=b+I*c[2]+V*c[5]+S*c[8],(r=(w=a-m.x)*w+(g=o-m.y)*g+(M=n-m.z)*M)>0&&r<v*v&&(w*=l=1/(r=O.sqrt(r)),g*=l,M*=l,s.addPoint(p+v*w,u+v*g,y+v*M,w,g,M,r-v,this.flip)))}}),Bt.prototype=Object.assign(Object.create(Ot.prototype),{constructor:Bt,detectCollision:function(t,i,s){var h,e;this.flip?(h=i,e=t):(h=t,e=i);var a=h.position,o=a.x,n=a.y,r=a.z,l=e.position,c=l.x,m=l.y,p=l.z,u=e.normalDirection.x,y=e.normalDirection.y,x=e.normalDirection.z,d=h.radius,f=e.radius,b=d+f,v=e.halfHeight,z=o-c,N=n-m,k=r-p,w=z*u+N*y+k*x;if(!(w<-v-d||w>v+d)){var g,M=c+w*u,I=m+w*y,V=p+w*x,S=o-M,L=n-I,P=r-V,T=S*S+L*L+P*P;if(!(T>b*b))T>f*f&&(S*=T=f/O.sqrt(T),L*=T,P*=T),w<-v?w=-v:w>v&&(w=v),(T=(z=(M=c+w*u+S)-o)*z+(N=(I=m+w*y+L)-n)*N+(k=(V=p+w*x+P)-r)*k)>0&&T<d*d&&(z*=g=1/(T=O.sqrt(T)),N*=g,k*=g,s.addPoint(o+z*d,n+N*d,r+k*d,z,N,k,T-d,this.flip))}}}),Ft.prototype=Object.assign(Object.create(Ot.prototype),{constructor:Ft,detectCollision:function(t,i,s){var h=t,e=i,a=h.position,o=e.position,n=o.x-a.x,r=o.y-a.y,l=o.z-a.z,c=n*n+r*r+l*l,m=h.radius,p=m+e.radius;if(c>0&&c<p*p){var u=1/(c=O.sqrt(c));n*=u,r*=u,l*=u,s.addPoint(a.x+n*m,a.y+r*m,a.z+l*m,n,r,l,c-p,!1)}}}),qt.prototype=Object.assign(Object.create(Ot.prototype),{constructor:qt,detectCollision:function(t,i,s){var h,e=this.n,a=this.p,o=this.flip?i:t,n=this.flip?t:i,r=o.radius;e.sub(o.position,n.position),e.x*=n.normal.x,e.y*=n.normal.y,e.z*=n.normal.z,(h=e.lengthSq())>0&&h<r*r&&(h=O.sqrt(h),e.copy(n.normal).negate(),a.copy(o.position).addScaledVector(e,r),s.addPointVec(a,e,h-r,this.flip))}}),Ut.prototype=Object.assign(Object.create(Ot.prototype),{constructor:Ut,detectCollision:function(t,i,s){var h,e=this.n,a=this.p,o=this.cc,n=this.flip?i:t,r=this.flip?t:i,l=n.dimentions,c=n.halfWidth,m=n.halfHeight,p=n.halfDepth,u=0;this.dix.set(l[0],l[1],l[2]),this.diy.set(l[3],l[4],l[5]),this.diz.set(l[6],l[7],l[8]),e.sub(n.position,r.position),e.x*=r.normal.x,e.y*=r.normal.y,e.z*=r.normal.z,o.set(O.dotVectors(this.dix,e),O.dotVectors(this.diy,e),O.dotVectors(this.diz,e)),o.x>c?o.x=c:o.x<-c?o.x=-c:u=1,o.y>m?o.y=m:o.y<-m?o.y=-m:u|=2,o.z>p?o.z=p:o.z<-p?o.z=-p:u|=4,7===u&&(e.set(o.x<0?c+o.x:c-o.x,o.y<0?m+o.y:m-o.y,o.z<0?p+o.z:p-o.z),e.x<e.y?e.x<e.z?(h=e.x-c,o.x<0?(o.x=-c,e.copy(this.dix)):(o.x=c,e.subEqual(this.dix))):(h=e.z-p,o.z<0?(o.z=-p,e.copy(this.diz)):(o.z=p,e.subEqual(this.diz))):e.y<e.z?(h=e.y-m,o.y<0?(o.y=-m,e.copy(this.diy)):(o.y=m,e.subEqual(this.diy))):(h=e.z-p,o.z<0?(o.z=-p,e.copy(this.diz)):(o.z=p,e.subEqual(this.diz))),a.copy(r.position).addScaledVector(e,1),s.addPointVec(a,e,h,this.flip))}}),Object.assign(Rt.prototype,{World:!0,play:function(){if(null===this.timer){var t=this;this.timer=setInterval((function(){t.step()}),this.timerate)}},stop:function(){null!==this.timer&&(clearInterval(this.timer),this.timer=null)},setGravity:function(t){this.gravity.fromArray(t)},getInfo:function(){return this.isStat?this.performance.show():""},clear:function(){for(this.stop(),this.preLoop=null,this.postLoop=null,this.randX=65535;null!==this.joints;)this.removeJoint(this.joints);for(;null!==this.contacts;)this.removeContact(this.contacts);for(;null!==this.rigidBodies;)this.removeRigidBody(this.rigidBodies)},addRigidBody:function(t){t.parent&&j("World","It is not possible to be added to more than one world one of the rigid body"),t.setParent(this);for(var i=t.shapes;null!==i;i=i.next)this.addShape(i);null!==this.rigidBodies&&((this.rigidBodies.prev=t).next=this.rigidBodies),this.rigidBodies=t,this.numRigidBodies++},removeRigidBody:function(t){var i=t;if(i.parent===this){i.awake();for(var s=i.jointLink;null!=s;){var h=s.joint;s=s.next,this.removeJoint(h)}for(var e=t.shapes;null!==e;e=e.next)this.removeShape(e);var a=i.prev,o=i.next;null!==a&&(a.next=o),null!==o&&(o.prev=a),this.rigidBodies==i&&(this.rigidBodies=o),i.prev=null,i.next=null,i.parent=null,this.numRigidBodies--}},getByName:function(t){for(var i=this.rigidBodies;null!==i;){if(i.name===t)return i;i=i.next}for(var s=this.joints;null!==s;){if(s.name===t)return s;s=s.next}return null},addShape:function(t){t.parent&&t.parent.parent||j("World","It is not possible to be added alone to shape world"),t.proxy=this.broadPhase.createProxy(t),t.updateProxy(),this.broadPhase.addProxy(t.proxy)},removeShape:function(t){this.broadPhase.removeProxy(t.proxy),t.proxy=null},addJoint:function(t){t.parent&&j("World","It is not possible to be added to more than one world one of the joint"),null!=this.joints&&((this.joints.prev=t).next=this.joints),this.joints=t,t.setParent(this),this.numJoints++,t.awake(),t.attach()},removeJoint:function(t){var i=t,s=i.prev,h=i.next;null!==s&&(s.next=h),null!==h&&(h.prev=s),this.joints==i&&(this.joints=h),i.prev=null,i.next=null,this.numJoints--,i.awake(),i.detach(),i.parent=null},addContact:function(t,i){var s;null!==this.unusedContacts?(s=this.unusedContacts,this.unusedContacts=this.unusedContacts.next):s=new ft,s.attach(t,i),s.detector=this.detectors[t.type][i.type],this.contacts&&((this.contacts.prev=s).next=this.contacts),this.contacts=s,this.numContacts++},removeContact:function(t){var i=t.prev,s=t.next;s&&(s.prev=i),i&&(i.next=s),this.contacts==t&&(this.contacts=s),t.prev=null,t.next=null,t.detach(),t.next=this.unusedContacts,this.unusedContacts=t,this.numContacts--},getContact:function(t,i){var s,h;t=t.constructor===bt?t.name:t,i=i.constructor===bt?i.name:i;for(var e=this.contacts;null!==e;){if(s=e.body1.name,h=e.body2.name,s===t&&h===i||h===t&&s===i)return e.touching?e:null;e=e.next}return null},checkContact:function(t,i){for(var s,h,e=this.contacts;null!==e;){if(s=e.body1.name||" ",h=e.body2.name||" ",s==t&&h==i||h==t&&s==i)return!!e.touching;e=e.next}},callSleep:function(t){return!!t.allowSleep&&(!(t.linearVelocity.lengthSq()>.04)&&!(t.angularVelocity.lengthSq()>.25))},step:function(){var t=this.isStat;t&&this.performance.setTime(0);for(var i=this.rigidBodies;null!==i;)i.addedToIsland=!1,i.sleeping&&i.testWakeUp(),i=i.next;t&&this.performance.setTime(1),this.broadPhase.detectPairs();for(var s=this.broadPhase.pairs,h=this.broadPhase.numPairs;h--;){var e,a,o,n=s[h];n.shape1.id<n.shape2.id?(e=n.shape1,a=n.shape2):(e=n.shape2,a=n.shape1),o=e.numContacts<a.numContacts?e.contactLink:a.contactLink;for(var r=!1;o;){if((z=o.contact).shape1==e&&z.shape2==a){z.persisting=!0,r=!0;break}o=o.next}r||this.addContact(e,a)}for(t&&this.performance.calcBroadPhase(),this.numContactPoints=0,z=this.contacts;null!==z;)if(z.persisting||!z.shape1.aabb.intersectTest(z.shape2.aabb)){var l=z.body1,c=z.body2;(l.isDynamic&&!l.sleeping||c.isDynamic&&!c.sleeping)&&z.updateManifold(),this.numContactPoints+=z.manifold.numPoints,z.persisting=!1,z.constraint.addedToIsland=!1,z=z.next}else{var m=z.next;this.removeContact(z),z=m}t&&this.performance.calcNarrowPhase();var p,u,y=1/this.timeStep;for(p=this.joints;null!==p;p=p.next)p.addedToIsland=!1;this.islandRigidBodies=[],this.islandConstraints=[],this.islandStack=[],t&&this.performance.setTime(1),this.numIslands=0;for(var x=this.rigidBodies;null!==x;x=x.next)if(!(x.addedToIsland||x.isStatic||x.sleeping))if(x.isLonely())x.isDynamic&&x.linearVelocity.addScaledVector(this.gravity,this.timeStep),this.callSleep(x)?(x.sleepTime+=this.timeStep,x.sleepTime>.5?x.sleep():x.updatePosition(this.timeStep)):(x.sleepTime=0,x.updatePosition(this.timeStep)),this.numIslands++;else{var d=0,f=0,b=1;this.islandStack[0]=x,x.addedToIsland=!0;do{if(i=this.islandStack[--b],this.islandStack[b]=null,i.sleeping=!1,this.islandRigidBodies[d++]=i,!i.isStatic){for(var v=i.contactLink;null!==v;v=v.next){var z;if(!(u=(z=v.contact).constraint).addedToIsland&&z.touching)this.islandConstraints[f++]=u,u.addedToIsland=!0,(m=v.body).addedToIsland||(this.islandStack[b++]=m,m.addedToIsland=!0)}for(var N=i.jointLink;null!==N;N=N.next)(u=N.joint).addedToIsland||(this.islandConstraints[f++]=u,u.addedToIsland=!0,!(m=N.body).addedToIsland&&m.isDynamic&&(this.islandStack[b++]=m,m.addedToIsland=!0))}}while(0!=b);for(var k=(new C).addScaledVector(this.gravity,this.timeStep),w=d;w--;)(i=this.islandRigidBodies[w]).isDynamic&&i.linearVelocity.addEqual(k);if(this.enableRandomizer)for(w=f;w--;)if(0!==w){var g=(this.randX=this.randX*this.randA+this.randB&2147483647)/2147483648*w|0;u=this.islandConstraints[w],this.islandConstraints[w]=this.islandConstraints[g],this.islandConstraints[g]=u}for(w=f;w--;)this.islandConstraints[w].preSolve(this.timeStep,y);for(var M=this.numIterations;M--;)for(w=f;w--;)this.islandConstraints[w].solve();for(w=f;w--;)this.islandConstraints[w].postSolve(),this.islandConstraints[w]=null;var I=10;for(w=d;w--;)i=this.islandRigidBodies[w],this.callSleep(i)?(i.sleepTime+=this.timeStep,i.sleepTime<I&&(I=i.sleepTime)):(i.sleepTime=0,I=0);if(I>.5)for(w=d;w--;)this.islandRigidBodies[w].sleep(),this.islandRigidBodies[w]=null;else for(w=d;w--;)this.islandRigidBodies[w].updatePosition(this.timeStep),this.islandRigidBodies[w]=null;this.numIslands++}t&&this.performance.calcEnd(),null!==this.postLoop&&this.postLoop()},remove:function(t){},add:function(t){var i=(t=t||{}).type||"box";return i.constructor===String&&(i=[i]),"joint"===i[0].substring(0,5)?this.initJoint(i[0],t):this.initBody(i,t)},initBody:function(t,i){var s=this.invScale,h=i.move||!1,e=i.kinematic||!1,a=i.pos||[0,0,0];a=a.map((function(t){return t*s}));var o=i.posShape||[0,0,0];o=o.map((function(t){return t*s}));var n=i.rot||[0,0,0];n=n.map((function(t){return t*O.degtorad}));var r=i.rotShape;r=n.map((function(t){return t*O.degtorad}));var l=void 0===i.size?[1,1,1]:i.size;1===l.length&&(l[1]=l[0]),2===l.length&&(l[2]=l[0]),l=l.map((function(t){return t*s}));var c=new Y;void 0!==i.density&&(c.density=i.density),void 0!==i.friction&&(c.friction=i.friction),void 0!==i.restitution&&(c.restitution=i.restitution),void 0!==i.belongsTo&&(c.belongsTo=i.belongsTo),void 0!==i.collidesWith&&(c.collidesWith=i.collidesWith),void 0!==i.config&&(void 0!==i.config[0]&&(c.density=i.config[0]),void 0!==i.config[1]&&(c.friction=i.config[1]),void 0!==i.config[2]&&(c.restitution=i.config[2]),void 0!==i.config[3]&&(c.belongsTo=i.config[3]),void 0!==i.config[4]&&(c.collidesWith=i.config[4]));for(var m,p,u=new bt(new C(a[0],a[1],a[2]),(new E).setFromEuler(n[0],n[1],n[2])),d=0;d<t.length;d++){switch(void 0!==o[p=3*d]&&c.relativePosition.set(o[p],o[p+1],o[p+2]),void 0!==r[p]&&c.relativeRotation.setQuat((new E).setFromEuler(r[p],r[p+1],r[p+2])),t[d]){case"sphere":m=new _(c,l[p]);break;case"cylinder":m=new J(c,l[p],l[p+1]);break;case"box":m=new R(c,l[p],l[p+1],l[p+2]);break;case"plane":m=new W(c)}u.addShape(m)}return i.neverSleep||e?u.allowSleep=!1:u.allowSleep=!0,u.isKinematic=e,h?i.massPos||i.massRot?u.setupMass(y,!1):u.setupMass(y,!0):u.setupMass(x),void 0!==i.name&&(u.name=i.name),this.addRigidBody(u),h&&(i.sleep?u.sleep():u.awake()),u},initJoint:function(t,i){var s,h,e=this.invScale,a=i.axe1||[1,0,0],o=i.axe2||[1,0,0],n=i.pos1||[0,0,0],r=i.pos2||[0,0,0];n=n.map((function(t){return t*e})),r=r.map((function(t){return t*e})),"jointDistance"===t?(s=i.min||0,h=i.max||10,s*=e,h*=e):(s=i.min||57.29578,h=i.max||0,s*=O.degtorad,h*=O.degtorad);var l=i.limit||null,c=i.spring||null,m=i.motor||null,p=new lt;p.scale=this.scale,p.invScale=this.invScale,p.allowCollision=i.collision||!1,p.localAxis1.set(a[0],a[1],a[2]),p.localAxis2.set(o[0],o[1],o[2]),p.localAnchorPoint1.set(n[0],n[1],n[2]),p.localAnchorPoint2.set(r[0],r[1],r[2]);var u,y=null,x=null;if(void 0===i.body1||void 0===i.body2)return j("World","Can\'t add joint if attach rigidbodys not define !");if(i.body1.constructor===String||i.body1.constructor===Number?y=this.getByName(i.body1):i.body1.constructor===bt&&(y=i.body1),i.body2.constructor===String||i.body2.constructor===Number?x=this.getByName(i.body2):i.body2.constructor===bt&&(x=i.body2),null===y||null===x)return j("World","Can\'t add joint attach rigidbodys not find !");switch(p.body1=y,p.body2=x,t){case"jointDistance":u=new ht(p,s,h),null!==c&&u.limitMotor.setSpring(c[0],c[1]),null!==m&&u.limitMotor.setMotor(m[0],m[1]);break;case"jointHinge":case"joint":u=new tt(p,s,h),null!==c&&u.limitMotor.setSpring(c[0],c[1]),null!==m&&u.limitMotor.setMotor(m[0],m[1]);break;case"jointPrisme":u=new ot(p,s,h);break;case"jointSlide":u=new nt(p,s,h);break;case"jointBall":u=new it(p);break;case"jointWheel":u=new rt(p),null!==l&&u.rotationalLimitMotor1.setLimit(l[0],l[1]),null!==c&&u.rotationalLimitMotor1.setSpring(c[0],c[1]),null!==m&&u.rotationalLimitMotor1.setMotor(m[0],m[1])}return u.name=i.name||"",this.addJoint(u),u}})}},s={};function h(i){if(s[i])return s[i].exports;var e=s[i]={exports:{}};return t[i](e,e.exports,h),e.exports}h.d=(t,i)=>{for(var s in i)h.o(i,s)&&!h.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},h.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),h.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{const t=h(480);var i,s,e,a,o=null,n=new Map,r=async function(t,i){self.postMessage({type:t,detail:i})},l=new Map;self.onmessage=function(h){var c;switch(e=h.data,a=h.data.detail,e.type){case"init":(o=new t.World(a.WORLD_CONFIG)).add({size:[50,10,50],pos:[0,-5,0]}),r("physics-started",{msg:"started"});break;case"step":i=a.pageBodies,o.step(),i.forEach(((t,i)=>{"kinematic"===t.is?(n.get(i).setQuaternion(t.quaternion),n.get(i).setPosition(t.position)):"dynamic"===t.is&&((s=l.get(i)).position=n.get(i).getPosition(),s.quaternion=n.get(i).getQuaternion())})),r("post-step",{bodies:l});break;case"pause":o.stop();break;case"add-body":n.set(a.BODY_ID,o.add(a.BODY_CONFIG)),l.set(a.BODY_ID,a.PAGE_BODY);break;case"remove-body":var m=n.get(a.BODY_ID);l.delete(a.BODY_ID),o.remove(m);break;case"update-body":break;case"kinemize-body":(c=n.get(a.BODY_ID)).awake(),c.isStatic=!1,c.isKinematic=!0,c.isDynamic=!1,c.allowSleep=!1;break;case"dynamize-body":(c=n.get(a.BODY_ID)).awake(),c.allowSleep=!0,c.isStatic=!1,c.isKinematic=!1,c.isDynamic=!0}}})()})();',"PhysicsWorker",void 0,s.p+"superquest-physics-lite.worker.min.js")}},477:t=>{t.exports=function(t,i,s,e){try{try{var n;try{n=new window.Blob([t])}catch(i){(n=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(t),n=n.getBlob()}var h=window.URL||window.webkitURL,a=h.createObjectURL(n),o=new window[i](a,s);return h.revokeObjectURL(a),o}catch(e){return new window[i]("data:application/javascript,".concat(encodeURIComponent(t)),s)}}catch(t){if(!e)throw Error("Inline worker is not supported");return new window[i](e,s)}}}},i={};function s(e){if(i[e])return i[e].exports;var n=i[e]={exports:{}};return t[e](n,n.exports,s),n.exports}s.n=t=>{var i=t&&t.__esModule?()=>t.default:()=>t;return s.d(i,{a:i}),i},s.d=(t,i)=>{for(var e in i)s.o(i,e)&&!s.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:i[e]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;s.g.importScripts&&(t=s.g.location+"");var i=s.g.document;if(!t&&i&&(i.currentScript&&(t=i.currentScript.src),!t)){var e=i.getElementsByTagName("script");e.length&&(t=e[e.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=t})(),s(7786),s(5218),s(8314),s(253),s(9466),s(3454)})();